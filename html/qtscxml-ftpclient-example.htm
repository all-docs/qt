<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Qt SCXML FTP Client Example | Qt SCXML</title>
<link rel="canonical" href="https://doc.qt.io/qt-6/qtscxml-ftpclient-example.html">
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="./index.htm" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtscxml-index.htm" translate="no">Qt SCXML</a></li>
                            <li><a href="./examples-qtscxml.htm" translate="no">Qt SCXML Examples</a></li>
                            <li><a>Qt SCXML FTP Client Example</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">Qt SCXML FTP Client Example</h1>
<span class="subtitle"></span>
<!-- $$$ftpclient-brief -->
<p>Implements a simple FTP client using a state machine.</p>
<!-- @@@ftpclient -->
<!-- $$$ftpclient-description -->
<div class="descr"> <a name="details"></a>
<p><i>FTP Client</i> uses Qt SCXML to implement a FTP client that can communicate with a FTP service by sending FTP control messages translated from state machine events and by translating server replies into state machine events. The data received from the FTP server is printed on the console.</p>
<p><a href="https://tools.ietf.org/html/rfc959" translate="no">RFC 959</a> specifies state charts for the command handling of the FTP client. They can be easily translated into SCXML to benefit from SCXML nested states. Connections between the client and server and data transfer are implemented by using C++. In addition, Qt signals and slots are used.</p>
<p>The state machine has the following states:</p>
<p class="centerAlign"><img alt="" src="./images/ftpclient-statechart.png"></p><ul>
<li><i>I</i> as the initial state.</li>
<li><i>B</i> for sending commands.</li>
<li><i>S</i> for success.</li>
<li><i>F</i> for failure.</li>
<li><i>W</i> for waiting for a reply.</li>
<li><i>P</i> for supplying a password upon server request.</li>
</ul>
<p>The state machine is specified in the <i>simpleftp.scxml</i> file and compiled into the <code translate="no">FtpClient</code> class that implements the logic of the FTP protocol. It reacts to user input and to replies from the control channel by changing states and sending external events. In addition, we implement a <code translate="no">FtpControlChannel</code> class and a <code translate="no">FtpDataChannel</code> class that handle TCP sockets and servers and convert line endings.</p>
<a name="running-the-example"></a>
<h4 id="running-the-example">Running the Example<a class="plink" href="#running-the-example" title="Direct link to this headline"></a></h4>
<p>To run the example from <a href="https://doc.qt.io/qtcreator/index.html" translate="no">Qt Creator</a>, open the <b>Welcome</b> mode and select the example from <b>Examples</b>. For more information, visit <a href="https://doc.qt.io/qtcreator/creator-build-example-application.html" translate="no">Building and Running an Example</a>.</p>
<a name="compiling-the-state-machine"></a>
<h4 id="compiling-the-state-machine">Compiling the State Machine<a class="plink" href="#compiling-the-state-machine" title="Direct link to this headline"></a></h4>
<p>We link against the Qt SCXML module by adding the following line to the <i>.pro</i> file:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">QT = core scxml network</pre></div>
<p>We then specify the state machine to compile:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">STATECHARTS += simpleftp.scxml</pre></div>
<p>The Qt SCXML Compiler, <code translate="no">qscxmlc</code>, is run automatically to generate <i>ftpclient.h</i> and <i>ftpclient.cpp</i>, and to add them to the <code translate="no">HEADERS</code> and <code translate="no">SOURCES</code> variables for compilation.</p>
<a name="instantiating-the-state-machine"></a>
<h4 id="instantiating-the-state-machine">Instantiating the State Machine<a class="plink" href="#instantiating-the-state-machine" title="Direct link to this headline"></a></h4>
<p>We instantiate the generated <code translate="no">FtpClient</code> class, as well as the <code translate="no">FtpDataChannel</code> and <code translate="no">FtpControlChannel</code> classes in the <i>main.cpp</i> file:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="preprocessor">#include "ftpcontrolchannel.h"</span>
<span class="preprocessor">#include "ftpdatachannel.h"</span>
    ...
<span class="type">int</span> main(<span class="type">int</span> argc<span class="operator">,</span> <span class="type">char</span> <span class="operator">*</span>argv<span class="operator">[</span><span class="operator">]</span>)
{
    ...
    <span class="type"><a href="./qcoreapplication.htm" translate="no">QCoreApplication</a></span> app(argc<span class="operator">,</span> argv);
    FtpClient ftpClient;
    FtpDataChannel dataChannel;
    FtpControlChannel controlChannel;
    ...</pre></div>
<a name="communicating-with-an-ftp-server"></a>
<h4 id="communicating-with-an-ftp-server">Communicating with an FTP Server<a class="plink" href="#communicating-with-an-ftp-server" title="Direct link to this headline"></a></h4>
<p>We print all data retrieved from the server on the console:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="operator">&amp;</span>dataChannel<span class="operator">,</span> <span class="operator">&amp;</span>FtpDataChannel<span class="operator">::</span>dataReceived<span class="operator">,</span>
                     <span class="operator">[</span><span class="operator">]</span>(<span class="keyword">const</span> <span class="type"><a href="./qbytearray.htm" translate="no">QByteArray</a></span> <span class="operator">&amp;</span>data) {
        std<span class="operator">::</span>cout <span class="operator">&lt;</span><span class="operator">&lt;</span> data<span class="operator">.</span>constData();
    });</pre></div>
<p>We translate server replies into state machine events:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="operator">&amp;</span>controlChannel<span class="operator">,</span> <span class="operator">&amp;</span>FtpControlChannel<span class="operator">::</span>reply<span class="operator">,</span> <span class="operator">&amp;</span>ftpClient<span class="operator">,</span>
                     <span class="operator">[</span><span class="operator">&amp;</span>ftpClient<span class="operator">]</span>(<span class="type">int</span> code<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>parameters) {
        ftpClient<span class="operator">.</span>submitEvent(<span class="type"><a href="./qstring.htm" translate="no">QString</a></span>(<span class="string">"reply.%1xx"</span>)
                              <span class="operator">.</span>arg(code <span class="operator">/</span> <span class="number">100</span>)<span class="operator">,</span> parameters);
    });</pre></div>
<p>We translate commands from the state machine into FTP control messages:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    ftpClient<span class="operator">.</span>connectToEvent(<span class="string">"submit.cmd"</span><span class="operator">,</span> <span class="operator">&amp;</span>controlChannel<span class="operator">,</span>
                             <span class="operator">[</span><span class="operator">&amp;</span>controlChannel<span class="operator">]</span>(<span class="keyword">const</span> <span class="type"><a href="./qscxmlevent.htm" translate="no">QScxmlEvent</a></span> <span class="operator">&amp;</span>event) {
        controlChannel<span class="operator">.</span>command(event<span class="operator">.</span>name()<span class="operator">.</span>mid(<span class="number">11</span>)<span class="operator">.</span>toUtf8()<span class="operator">,</span>
                               event<span class="operator">.</span>data()<span class="operator">.</span>toMap()<span class="operator">[</span><span class="string">"params"</span><span class="operator">]</span><span class="operator">.</span>toByteArray());
    });</pre></div>
<p>We send commands to log into the FTP server as an anonymous user, to announce a port for the data connection, and to retrive a file:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    <span class="type"><a href="./qlist.htm" translate="no">QList</a></span><span class="operator">&lt;</span>Command<span class="operator">&gt;</span> commands({
        {<span class="string">"cmd.USER"</span><span class="operator">,</span> <span class="string">"anonymous"</span>}<span class="operator">,</span><span class="comment">// login</span>
        {<span class="string">"cmd.PORT"</span><span class="operator">,</span> <span class="string">""</span>}<span class="operator">,</span>         <span class="comment">// announce port for data connection,</span>
                                  <span class="comment">// args added below.</span>
        {<span class="string">"cmd.RETR"</span><span class="operator">,</span> file}        <span class="comment">// retrieve a file</span>
    });</pre></div>
<p>We specify that the FTP client should send the next command when entering the <i>B</i> state:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    ftpClient<span class="operator">.</span>connectToState(<span class="string">"B"</span><span class="operator">,</span> <span class="type"><a href="./qscxmlstatemachine.htm" translate="no">QScxmlStateMachine</a></span><span class="operator">::</span>onEntry(<span class="operator">[</span><span class="operator">&amp;</span><span class="operator">]</span>() {
        <span class="keyword">if</span> (commands<span class="operator">.</span>isEmpty()) {
            app<span class="operator">.</span>quit();
            <span class="keyword">return</span>;
        }
        Command command <span class="operator">=</span> commands<span class="operator">.</span>takeFirst();
        <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Posting command"</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> command<span class="operator">.</span>cmd <span class="operator">&lt;</span><span class="operator">&lt;</span> command<span class="operator">.</span>args;
        ftpClient<span class="operator">.</span>submitEvent(command<span class="operator">.</span>cmd<span class="operator">,</span> command<span class="operator">.</span>args);
    }));</pre></div>
<p>We specify that the FTP client should send an empty string as a password if the server asks for one:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    ftpClient<span class="operator">.</span>connectToState(<span class="string">"P"</span><span class="operator">,</span> <span class="type"><a href="./qscxmlstatemachine.htm" translate="no">QScxmlStateMachine</a></span><span class="operator">::</span>onEntry(<span class="operator">[</span><span class="operator">&amp;</span>ftpClient<span class="operator">]</span>() {
        <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Sending password"</span>;
        ftpClient<span class="operator">.</span>submitEvent(<span class="string">"cmd.PASS"</span><span class="operator">,</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span>());
    }));</pre></div>
<p>Finally, we connect to the FTP server specified as the first argument of the method and retrieve the file specified as the second argument:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    controlChannel<span class="operator">.</span>connectToServer(server);
    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="operator">&amp;</span>controlChannel<span class="operator">,</span> <span class="operator">&amp;</span>FtpControlChannel<span class="operator">::</span>opened<span class="operator">,</span>
                     <span class="operator">[</span><span class="operator">&amp;</span><span class="operator">]</span>(<span class="keyword">const</span> <span class="type">QHostAddress</span> <span class="operator">&amp;</span>address<span class="operator">,</span> <span class="type">int</span>) {
        dataChannel<span class="operator">.</span>listen(address);
        commands<span class="operator">[</span><span class="number">1</span><span class="operator">]</span><span class="operator">.</span>args <span class="operator">=</span> dataChannel<span class="operator">.</span>portspec();
        ftpClient<span class="operator">.</span>start();
    });</pre></div>
<p>For example, the following invocation prints the specified file from the specified server: <code translate="no">ftpclient &lt;server&gt; &lt;file&gt;</code>.</p>
<p><a href="https://code.qt.io/cgit/qt/qtscxml.git/tree/examples/scxml/ftpclient?h=5.15" translate="no">Example project @ code.qt.io</a></p>
</div>
<!-- @@@ftpclient -->
</div>
<p class="copy-notice">
<acronym title="Copyright">Â©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>