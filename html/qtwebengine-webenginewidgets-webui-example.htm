<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WebEngine Widgets WebUI Example | Qt WebEngine</title>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="./index.htm" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtwebengine-index.htm" translate="no">Qt WebEngine</a></li>
                            <li><a href="./webengine-widgetexamples.htm" translate="no">Qt WebEngine Widgets Examples</a></li>
                            <li><a>WebEngine Widgets WebUI Example</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">WebEngine Widgets WebUI Example</h1>
<span class="subtitle"></span>
<!-- $$$webenginewidgets/webui-brief -->
<p>Displays HTML over a custom scheme.</p>
<!-- @@@webenginewidgets/webui -->
<!-- $$$webenginewidgets/webui-description -->
<div class="descr"> <a name="details"></a>
<p class="centerAlign"><img alt="" src="./images/webui-example.png"></p><p><i>WebUI</i> demonstrates how to implement a custom scheme in a secure way.</p>
<p>Aside from the built-in URL schemes, such as <code translate="no">http</code> and <code translate="no">qrc</code>, Qt WebEngine may be extended with <i>custom schemes</i> by creating <i>custom scheme handlers</i>. This example shows:</p>
<ul>
<li>How to create a custom scheme handler which serves HTML and handles HTML form submissions.</li>
<li>How to prevent ordinary web content from accessing the custom scheme.</li>
<li>How to prevent any other scheme from submitting HTML form data.</li>
</ul>
<a name="running-the-example"></a>
<h4 id="running-the-example">Running the Example<a class="plink" href="#running-the-example" title="Direct link to this headline"></a></h4>
<p>To run the example from <a href="http://doc.qt.io/qtcreator/index.html" translate="no">Qt Creator</a>, open the <b>Welcome</b> mode and select the example from <b>Examples</b>. For more information, visit <a href="https://doc.qt.io/qtcreator/creator-build-example-application.html" translate="no">Building and Running an Example</a>.</p>
<a name="overview"></a>
<h4 id="overview">Overview<a class="plink" href="#overview" title="Direct link to this headline"></a></h4>
<p>The example program consists of a single <a href="./qwebengineview.htm" translate="no">QWebEngineView</a> showing a simple HTML page loaded from the URL <code translate="no">webui:about</code>, over our custom scheme. Pressing the button at the bottom of the page will trigger an HTML form submission via POST to the same URL, at which point our custom scheme handler will cause the application to exit.</p>
<p>The program is divided into two parts, the <code translate="no">main</code> function for setting everything up, and the <code translate="no">WebUiHandler</code> class for implementing our custom scheme handler. The <code translate="no">main</code> function is quite short:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">int</span> main(<span class="type">int</span> argc<span class="operator">,</span> <span class="type">char</span> <span class="operator">*</span>argv<span class="operator">[</span><span class="operator">]</span>)
{
    <span class="type"><a href="./qcoreapplication.htm" translate="no">QCoreApplication</a></span><span class="operator">::</span>setOrganizationName(<span class="string">"QtExamples"</span>);
    <span class="type"><a href="./qapplication.htm" translate="no">QApplication</a></span><span class="operator">::</span>setAttribute(<span class="type"><a href="./qt.htm" translate="no">Qt</a></span><span class="operator">::</span>AA_EnableHighDpiScaling);

    WebUiHandler<span class="operator">::</span>registerUrlScheme();

    <span class="type"><a href="./qapplication.htm" translate="no">QApplication</a></span> app(argc<span class="operator">,</span> argv);

    <span class="type"><a href="./qwebengineprofile.htm" translate="no">QWebEngineProfile</a></span> profile;

    WebUiHandler handler;
    profile<span class="operator">.</span>installUrlSchemeHandler(WebUiHandler<span class="operator">::</span>schemeName<span class="operator">,</span> <span class="operator">&amp;</span>handler);

    <span class="type"><a href="./qwebenginepage.htm" translate="no">QWebEnginePage</a></span> page(<span class="operator">&amp;</span>profile);
    page<span class="operator">.</span>load(WebUiHandler<span class="operator">::</span>aboutUrl);

    <span class="type"><a href="./qwebengineview.htm" translate="no">QWebEngineView</a></span> view;
    view<span class="operator">.</span>setPage(<span class="operator">&amp;</span>page);
    view<span class="operator">.</span>setContextMenuPolicy(<span class="type"><a href="./qt.htm" translate="no">Qt</a></span><span class="operator">::</span>NoContextMenu);
    view<span class="operator">.</span>resize(<span class="number">500</span><span class="operator">,</span> <span class="number">600</span>);
    view<span class="operator">.</span>show();

    <span class="keyword">return</span> app<span class="operator">.</span>exec();
}</pre></div>
<p>Aside from the relatively standard setup of widgets, two points are noteworthy. First, we call the static method <code translate="no">WebUiHandler::registerUrlScheme()</code> to register our custom scheme with the web engine. Second, we create and install our custom scheme handler <code translate="no">WebUiHandler</code> using installUrlSchemeHandler(). The following sections describe these aspects in more detail.</p>
<a name="registering-the-scheme"></a>
<h4 id="registering-the-scheme">Registering the Scheme<a class="plink" href="#registering-the-scheme" title="Direct link to this headline"></a></h4>
<p>As custom schemes are integrated directly into the web engine, they do not necessarily need to follow the standard security rules which apply to ordinary web content. Depending on the chosen configuration, content served over a custom scheme may be given access to local resources, be set to ignore Content-Security-Policy rules, or conversely, be denied access to any other content entirely.</p>
<p>In order to take advantage of these possibilities, the custom scheme must first be registered. This means creating and configuring a <a href="./qwebengineurlscheme.htm" translate="no">QWebEngineUrlScheme</a> object and then handing it over to <a href="./qwebengineurlscheme.htm#registerScheme" translate="no">QWebEngineUrlScheme::registerScheme</a>(). The example program does exactly this in the static method <code translate="no">WebUiHandler::registerUrlScheme()</code>:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> WebUiHandler<span class="operator">::</span>registerUrlScheme()
{
    <span class="type"><a href="./qwebengineurlscheme.htm" translate="no">QWebEngineUrlScheme</a></span> webUiScheme(schemeName);
    webUiScheme<span class="operator">.</span>setFlags(<span class="type"><a href="./qwebengineurlscheme.htm" translate="no">QWebEngineUrlScheme</a></span><span class="operator">::</span>SecureScheme <span class="operator">|</span>
                         <span class="type"><a href="./qwebengineurlscheme.htm" translate="no">QWebEngineUrlScheme</a></span><span class="operator">::</span>LocalScheme <span class="operator">|</span>
                         <span class="type"><a href="./qwebengineurlscheme.htm" translate="no">QWebEngineUrlScheme</a></span><span class="operator">::</span>LocalAccessAllowed);
    <span class="type"><a href="./qwebengineurlscheme.htm" translate="no">QWebEngineUrlScheme</a></span><span class="operator">::</span>registerScheme(webUiScheme);
}</pre></div>
<p>A custom scheme needs a name, which can be set by passing it to the constructor of <code translate="no">QWebEngineUrlScheme</code> or by calling <a href="./qwebengineurlscheme.htm#setName" translate="no">QWebEngineUrlScheme::setName</a>. In the above, the name <code translate="no">webui</code> is set through the constructor. Additionally, we activate the flags <a href="./qwebengineurlscheme.htm#Flag-enum" translate="no">SecureScheme</a>, <a href="./qwebengineurlscheme.htm#Flag-enum" translate="no">LocalScheme</a> and <a href="./qwebengineurlscheme.htm#Flag-enum" translate="no">LocalAccessAllowed</a>. Since our custom scheme handler will not deliver resources received from insecure network connections, we can safely mark it as a <code translate="no">SecureScheme</code>. The <code translate="no">LocalScheme</code> flag prevents content from non-local schemes (such as <code translate="no">http</code>) from interacting with our custom scheme. Without this flag it would be possible, for example, to embed the <code translate="no">webui:about</code> page in an <code translate="no">&lt;iframe&gt;</code> element on a remotely loaded HTML page, perhaps to attempt a phishing attack. We also need the <code translate="no">LocalAccessAllowed</code> flag without which we would not be able to access the <code translate="no">webui</code> scheme from our <code translate="no">webui:about</code> page.</p>
<p>Earlier we saw that the call to <code translate="no">WebUiHandler::registerUrlScheme()</code> is made already at the top of the <code translate="no">main</code> function. This is so because custom schemes need to be registered as early as possible so that that they can be passed to all subprocesses. Specifically, custom schemes need to be registered before any other Qt WebEngine classes are instantiated by the application.</p>
<a name="handling-requests"></a>
<h4 id="handling-requests">Handling Requests<a class="plink" href="#handling-requests" title="Direct link to this headline"></a></h4>
<p>A custom scheme handler is, broadly speaking, similar to a web application served over HTTP. However, because custom schemes are integrated directly into the web engine, they have the advantage in terms of efficiency: there's no need for generating and parsing HTTP messages or for transferring data over sockets.</p>
<p>Implementing a handler means creating a subclass of <a href="./qwebengineurlschemehandler.htm" translate="no">QWebEngineUrlSchemeHandler</a>, which is just what is done by the <code translate="no">WebUiHandler</code> class of the example program:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">class</span> WebUiHandler : <span class="keyword">public</span> <span class="type"><a href="./qwebengineurlschemehandler.htm" translate="no">QWebEngineUrlSchemeHandler</a></span>
{
    Q_OBJECT
<span class="keyword">public</span>:
    <span class="keyword">explicit</span> WebUiHandler(<span class="type"><a href="./qobject.htm" translate="no">QObject</a></span> <span class="operator">*</span>parent <span class="operator">=</span> nullptr);

    <span class="type">void</span> requestStarted(<span class="type"><a href="./qwebengineurlrequestjob.htm" translate="no">QWebEngineUrlRequestJob</a></span> <span class="operator">*</span>job) override;

    <span class="keyword">static</span> <span class="type">void</span> registerUrlScheme();

    <span class="keyword">const</span> <span class="keyword">static</span> <span class="type"><a href="./qbytearray.htm" translate="no">QByteArray</a></span> schemeName;
    <span class="keyword">const</span> <span class="keyword">static</span> <span class="type"><a href="./qurl.htm" translate="no">QUrl</a></span> aboutUrl;
};</pre></div>
<p>For each request to a <code translate="no">webui</code> URL, the <code translate="no">WebUiHandler::requestStarted()</code> method will be called:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> WebUiHandler<span class="operator">::</span>requestStarted(<span class="type"><a href="./qwebengineurlrequestjob.htm" translate="no">QWebEngineUrlRequestJob</a></span> <span class="operator">*</span>job)
{
    <span class="keyword">static</span> <span class="keyword">const</span> <span class="type"><a href="./qurl.htm" translate="no">QUrl</a></span> webUiOrigin(<span class="type"><a href="./qstring.htm#QStringLiteral" translate="no">QStringLiteral</a></span>(SCHEMENAME <span class="string">":"</span>));
    <span class="keyword">static</span> <span class="keyword">const</span> <span class="type"><a href="./qbytearray.htm" translate="no">QByteArray</a></span> GET(<span class="type"><a href="./qbytearray.htm#QByteArrayLiteral" translate="no">QByteArrayLiteral</a></span>(<span class="string">"GET"</span>));
    <span class="keyword">static</span> <span class="keyword">const</span> <span class="type"><a href="./qbytearray.htm" translate="no">QByteArray</a></span> POST(<span class="type"><a href="./qbytearray.htm#QByteArrayLiteral" translate="no">QByteArrayLiteral</a></span>(<span class="string">"POST"</span>));

    <span class="type"><a href="./qbytearray.htm" translate="no">QByteArray</a></span> method <span class="operator">=</span> job<span class="operator">-</span><span class="operator">&gt;</span>requestMethod();
    <span class="type"><a href="./qurl.htm" translate="no">QUrl</a></span> url <span class="operator">=</span> job<span class="operator">-</span><span class="operator">&gt;</span>requestUrl();
    <span class="type"><a href="./qurl.htm" translate="no">QUrl</a></span> initiator <span class="operator">=</span> job<span class="operator">-</span><span class="operator">&gt;</span>initiator();

    <span class="keyword">if</span> (method <span class="operator">=</span><span class="operator">=</span> GET <span class="operator">&amp;</span><span class="operator">&amp;</span> url <span class="operator">=</span><span class="operator">=</span> aboutUrl) {
        <span class="type"><a href="./qfile.htm" translate="no">QFile</a></span> <span class="operator">*</span>file <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qfile.htm" translate="no">QFile</a></span>(<span class="type"><a href="./qstring.htm#QStringLiteral" translate="no">QStringLiteral</a></span>(<span class="string">":/about.html"</span>)<span class="operator">,</span> job);
        file<span class="operator">-</span><span class="operator">&gt;</span>open(<span class="type"><a href="./qiodevice.htm" translate="no">QIODevice</a></span><span class="operator">::</span>ReadOnly);
        job<span class="operator">-</span><span class="operator">&gt;</span>reply(<span class="type"><a href="./qbytearray.htm#QByteArrayLiteral" translate="no">QByteArrayLiteral</a></span>(<span class="string">"text/html"</span>)<span class="operator">,</span> file);
    } <span class="keyword">else</span> <span class="keyword">if</span> (method <span class="operator">=</span><span class="operator">=</span> POST <span class="operator">&amp;</span><span class="operator">&amp;</span> url <span class="operator">=</span><span class="operator">=</span> aboutUrl <span class="operator">&amp;</span><span class="operator">&amp;</span> initiator <span class="operator">=</span><span class="operator">=</span> webUiOrigin) {
        job<span class="operator">-</span><span class="operator">&gt;</span>fail(<span class="type"><a href="./qwebengineurlrequestjob.htm" translate="no">QWebEngineUrlRequestJob</a></span><span class="operator">::</span>RequestAborted);
        <span class="type"><a href="./qapplication.htm" translate="no">QApplication</a></span><span class="operator">::</span>exit();
    } <span class="keyword">else</span> {
        job<span class="operator">-</span><span class="operator">&gt;</span>fail(<span class="type"><a href="./qwebengineurlrequestjob.htm" translate="no">QWebEngineUrlRequestJob</a></span><span class="operator">::</span>UrlNotFound);
    }
}</pre></div>
<p>The <a href="./qwebengineurlrequestjob.htm" translate="no">QWebEngineUrlRequestJob</a> object <code translate="no">job</code> contains the request's attributes and provides methods for replying to the request with a response. Responses are generated asynchronously by reading them from the <a href="./qiodevice.htm" translate="no">QIODevice</a> that the application passes to <a href="./qwebengineurlrequestjob.htm#reply" translate="no">reply()</a>.</p>
<div class="admonition warning">
<p><b>Warning: </b>The <code translate="no">requestStarted()</code> method is not called from the main thread, but from the web engine's IO thread. Care must be taken to synchronize access to any resources on the main thread.</p>
</div>
<p>Aside from the usual fare of <a href="./qwebengineurlrequestjob.htm#requestMethod" translate="no">requestMethod</a> and <a href="./qwebengineurlrequestjob.htm#requestUrl" translate="no">requestUrl</a>, there is also the <a href="./qwebengineurlrequestjob.htm#initiator" translate="no">initiator</a>, holding the origin of the content which initiated the request. An empty <code translate="no">initiator</code> means the request was initiated directly by the application (via <a href="./qwebenginepage.htm#url-prop" translate="no">QWebEnginePage::setUrl</a>(), for example). The special value <code translate="no">"null"</code> corresponds to an opaque origin (a sandboxed <code translate="no">&lt;iframe&gt;</code> element, for example). Otherwise, the <code translate="no">initiator</code> will contain the URL scheme, hostname, and port of the content which initiated the request.</p>
<p>In this example, the <code translate="no">initiator</code> is used to ensure that <code translate="no">POST</code> requests to <code translate="no">webui:about</code> will only trigger the application's exit if they originate from the <code translate="no">webui</code> scheme. This prevents content loaded over other schemes from triggering the application's exit.</p>
<p><a href="https://code.qt.io/cgit/qt/qtwebengine.git/tree/examples/webenginewidgets/webui?h=5.15" translate="no">Example project @ code.qt.io</a></p>
</div>
<!-- @@@webenginewidgets/webui -->
</div>
<p class="copy-notice">
<acronym title="Copyright">Â©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>