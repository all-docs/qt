<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SQL Widget Mapper Example | Qt SQL</title>
<link rel="canonical" href="https://doc.qt.io/qt-6/qtsql-sqlwidgetmapper-example.html">
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="./index.htm" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtsql-index.htm" translate="no">Qt SQL</a></li>
                            <li><a>SQL Widget Mapper Example</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">SQL Widget Mapper Example</h1>
<span class="subtitle"></span>
<!-- $$$sqlwidgetmapper-brief -->
<p>The SQL Widget Mapper example shows how to use a map information from a database to widgets on a form.</p>
<!-- @@@sqlwidgetmapper -->
<!-- $$$sqlwidgetmapper-description -->
<div class="descr"> <a name="details"></a>
<div class="border"><p class="centerAlign"><img alt="" src="./images/sql-widget-mapper.png"></p></div><p>In the <a href="./qtwidgets-itemviews-combowidgetmapper-example.htm" translate="no">Combo Widget Mapper Example</a>, we showed how to use a named mapping between a widget mapper and a <a href="./qcombobox.htm" translate="no">QComboBox</a> widget with a special purpose model to relate values in the model to a list of choices.</p>
<p>Again, we create a <code translate="no">Window</code> class with an almost identical user interface, providing a combo box to allow their addresses to be classified as "Home", "Work" or "Other". However, instead of using a separate model to hold these address types, we use one database table to hold the example data and another to hold the address types. In this way, we store all the information in the same place.</p>
<a name="window-class-definition"></a>
<h4 id="window-class-definition">Window Class Definition<a class="plink" href="#window-class-definition" title="Direct link to this headline"></a></h4>
<p>The class provides a constructor, a slot to keep the buttons up to date, and a private function to set up the model:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">class</span> Window : <span class="keyword">public</span> <span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span>
{
    Q_OBJECT

<span class="keyword">public</span>:
    Window(<span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span> <span class="operator">*</span>parent <span class="operator">=</span> nullptr);

<span class="keyword">private</span> <span class="keyword">slots</span>:
    <span class="type">void</span> updateButtons(<span class="type">int</span> row);

<span class="keyword">private</span>:
    <span class="type">void</span> setupModel();

    <span class="type"><a href="./qlabel.htm" translate="no">QLabel</a></span> <span class="operator">*</span>nameLabel;
    <span class="type"><a href="./qlabel.htm" translate="no">QLabel</a></span> <span class="operator">*</span>addressLabel;
    <span class="type"><a href="./qlabel.htm" translate="no">QLabel</a></span> <span class="operator">*</span>typeLabel;
    <span class="type"><a href="./qlineedit.htm" translate="no">QLineEdit</a></span> <span class="operator">*</span>nameEdit;
    <span class="type"><a href="./qtextedit.htm" translate="no">QTextEdit</a></span> <span class="operator">*</span>addressEdit;
    <span class="type"><a href="./qcombobox.htm" translate="no">QComboBox</a></span> <span class="operator">*</span>typeComboBox;
    <span class="type"><a href="./qpushbutton.htm" translate="no">QPushButton</a></span> <span class="operator">*</span>nextButton;
    <span class="type"><a href="./qpushbutton.htm" translate="no">QPushButton</a></span> <span class="operator">*</span>previousButton;

    <span class="type"><a href="./qsqlrelationaltablemodel.htm" translate="no">QSqlRelationalTableModel</a></span> <span class="operator">*</span>model;
    <span class="type"><a href="./qitemselectionmodel.htm" translate="no">QItemSelectionModel</a></span> <span class="operator">*</span>selectionModel;
    <span class="type"><a href="./qdatawidgetmapper.htm" translate="no">QDataWidgetMapper</a></span> <span class="operator">*</span>mapper;
    <span class="type">int</span> typeIndex;
};</pre></div>
<p>In addition to the <a href="./qdatawidgetmapper.htm" translate="no">QDataWidgetMapper</a> object and the controls used to make up the user interface, we use a QStandardItemModel to hold our data and a <a href="./qstringlistmodel.htm" translate="no">QStringListModel</a> to hold information about the types of address that can be applied to each person's data.</p>
<a name="window-class-implementation"></a>
<h4 id="window-class-implementation">Window Class Implementation<a class="plink" href="#window-class-implementation" title="Direct link to this headline"></a></h4>
<p>The first act performed by the <code translate="no">Window</code> class constructor is to set up the model used to hold the example data. Since this is a key part of the example, we will look at this first.</p>
<p>The model is initialized in the window's <code translate="no">setupModel()</code> function. Here, we create a <a href="./qtsql-attribution-sqlite.htm#sqlite" translate="no">SQLite</a> database containing a "person" table with primary key, name, address and type fields.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> Window<span class="operator">::</span>setupModel()
{
    <span class="type"><a href="./qsqldatabase.htm" translate="no">QSqlDatabase</a></span> db <span class="operator">=</span> <span class="type"><a href="./qsqldatabase.htm" translate="no">QSqlDatabase</a></span><span class="operator">::</span>addDatabase(<span class="string">"QSQLITE"</span>);
    db<span class="operator">.</span>setDatabaseName(<span class="string">":memory:"</span>);
    <span class="keyword">if</span> (<span class="operator">!</span>db<span class="operator">.</span>open()) {
        <span class="type"><a href="./qmessagebox.htm" translate="no">QMessageBox</a></span><span class="operator">::</span>critical(<span class="number">0</span><span class="operator">,</span> tr(<span class="string">"Cannot open database"</span>)<span class="operator">,</span>
            tr(<span class="string">"Unable to establish a database connection.\n"</span>
               <span class="string">"This example needs SQLite support. Please read "</span>
               <span class="string">"the Qt SQL driver documentation for information how "</span>
               <span class="string">"to build it."</span>)<span class="operator">,</span> <span class="type"><a href="./qmessagebox.htm" translate="no">QMessageBox</a></span><span class="operator">::</span>Cancel);
        <span class="keyword">return</span>;
    }

    <span class="type"><a href="./qsqlquery.htm" translate="no">QSqlQuery</a></span> query;
    query<span class="operator">.</span>exec(<span class="string">"create table person (id int primary key, "</span>
               <span class="string">"name varchar(20), address varchar(200), typeid int)"</span>);
    query<span class="operator">.</span>exec(<span class="string">"insert into person values(1, 'Alice', "</span>
               <span class="string">"'&lt;qt&gt;123 Main Street&lt;br/&gt;Market Town&lt;/qt&gt;', 101)"</span>);
    query<span class="operator">.</span>exec(<span class="string">"insert into person values(2, 'Bob', "</span>
               <span class="string">"'&lt;qt&gt;PO Box 32&lt;br/&gt;Mail Handling Service"</span>
               <span class="string">"&lt;br/&gt;Service City&lt;/qt&gt;', 102)"</span>);
    query<span class="operator">.</span>exec(<span class="string">"insert into person values(3, 'Carol', "</span>
               <span class="string">"'&lt;qt&gt;The Lighthouse&lt;br/&gt;Remote Island&lt;/qt&gt;', 103)"</span>);
    query<span class="operator">.</span>exec(<span class="string">"insert into person values(4, 'Donald', "</span>
               <span class="string">"'&lt;qt&gt;47338 Park Avenue&lt;br/&gt;Big City&lt;/qt&gt;', 101)"</span>);
    query<span class="operator">.</span>exec(<span class="string">"insert into person values(5, 'Emma', "</span>
               <span class="string">"'&lt;qt&gt;Research Station&lt;br/&gt;Base Camp&lt;br/&gt;"</span>
               <span class="string">"Big Mountain&lt;/qt&gt;', 103)"</span>);</pre></div>
<p>On each row of the table, we insert default values for these fields, including values for the address types that correspond to the address types are stored in a separate table.</p>
<div class="border"><p class="centerAlign"><img alt="" src="./images/widgetmapper-sql-mapping-table.png"></p></div><p>We create an "addresstype" table containing the identifiers used in the "person" table and the corresponding strings:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    query<span class="operator">.</span>exec(<span class="string">"create table addresstype (id int, description varchar(20))"</span>);
    query<span class="operator">.</span>exec(<span class="string">"insert into addresstype values(101, 'Home')"</span>);
    query<span class="operator">.</span>exec(<span class="string">"insert into addresstype values(102, 'Work')"</span>);
    query<span class="operator">.</span>exec(<span class="string">"insert into addresstype values(103, 'Other')"</span>);

    model <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qsqlrelationaltablemodel.htm" translate="no">QSqlRelationalTableModel</a></span>(<span class="keyword">this</span>);
    model<span class="operator">-</span><span class="operator">&gt;</span>setTable(<span class="string">"person"</span>);
    model<span class="operator">-</span><span class="operator">&gt;</span>setEditStrategy(<span class="type"><a href="./qsqltablemodel.htm" translate="no">QSqlTableModel</a></span><span class="operator">::</span>OnManualSubmit);

    typeIndex <span class="operator">=</span> model<span class="operator">-</span><span class="operator">&gt;</span>fieldIndex(<span class="string">"typeid"</span>);

    model<span class="operator">-</span><span class="operator">&gt;</span>setRelation(typeIndex<span class="operator">,</span>
           <span class="type"><a href="./qsqlrelation.htm" translate="no">QSqlRelation</a></span>(<span class="string">"addresstype"</span><span class="operator">,</span> <span class="string">"id"</span><span class="operator">,</span> <span class="string">"description"</span>));
    model<span class="operator">-</span><span class="operator">&gt;</span>select();
}</pre></div>
<p>The "typeid" field in the "person" table is related to the contents of the "addresstype" table via a relation in a <a href="./qsqlrelationaltablemodel.htm" translate="no">QSqlRelationalTableModel</a>. This kind of model performs all the necessary work to store the data in a database and also allows any relations to be used as models in their own right.</p>
<p>In this case, we have defined a relation for the "typeid" field in the "person" table that relates it to the "id" field in the "addresstype" table and which causes the contents of the "description" field to be used wherever the "typeid" is presented to the user. (See the <a href="./qsqlrelationaltablemodel.htm#setRelation" translate="no">QSqlRelationalTableModel::setRelation</a>() documentation for details.)</p>
<div class="border"><p class="centerAlign"><img alt="" src="./images/widgetmapper-sql-mapping.png"></p></div><p>The constructor of the <code translate="no">Window</code> class can be explained in three parts. In the first part, we set up the model used to hold the data, then we set up the widgets used for the user interface:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">Window<span class="operator">::</span>Window(<span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span> <span class="operator">*</span>parent)
    : <span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span>(parent)
{
    setupModel();

    nameLabel <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qlabel.htm" translate="no">QLabel</a></span>(tr(<span class="string">"Na&amp;me:"</span>));
    nameEdit <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qlineedit.htm" translate="no">QLineEdit</a></span>();
    addressLabel <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qlabel.htm" translate="no">QLabel</a></span>(tr(<span class="string">"&amp;Address:"</span>));
    addressEdit <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qtextedit.htm" translate="no">QTextEdit</a></span>();
    typeLabel <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qlabel.htm" translate="no">QLabel</a></span>(tr(<span class="string">"&amp;Type:"</span>));
    typeComboBox <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qcombobox.htm" translate="no">QComboBox</a></span>();
    nextButton <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qpushbutton.htm" translate="no">QPushButton</a></span>(tr(<span class="string">"&amp;Next"</span>));
    previousButton <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qpushbutton.htm" translate="no">QPushButton</a></span>(tr(<span class="string">"&amp;Previous"</span>));

    nameLabel<span class="operator">-</span><span class="operator">&gt;</span>setBuddy(nameEdit);
    addressLabel<span class="operator">-</span><span class="operator">&gt;</span>setBuddy(addressEdit);
    typeLabel<span class="operator">-</span><span class="operator">&gt;</span>setBuddy(typeComboBox);</pre></div>
<p>We obtain a model for the combo box from the main model, based on the relation we set up for the "typeid" field. The call to the combo box's <a href="./qcombobox.htm#modelColumn-prop" translate="no">setModelColumn()</a> selects the field in the field in the model to display.</p>
<p>Note that this approach is similar to the one used in the <a href="./qtwidgets-itemviews-combowidgetmapper-example.htm" translate="no">Combo Widget Mapper Example</a> in that we set up a model for the combo box. However, in this case, we obtain a model based on a relation in the <a href="./qsqlrelationaltablemodel.htm" translate="no">QSqlRelationalTableModel</a> rather than create a separate one.</p>
<p>Next, we set up the widget mapper, relating each input widget to a field in the model:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    <span class="type"><a href="./qsqltablemodel.htm" translate="no">QSqlTableModel</a></span> <span class="operator">*</span>relModel <span class="operator">=</span> model<span class="operator">-</span><span class="operator">&gt;</span>relationModel(typeIndex);
    typeComboBox<span class="operator">-</span><span class="operator">&gt;</span>setModel(relModel);
    typeComboBox<span class="operator">-</span><span class="operator">&gt;</span>setModelColumn(relModel<span class="operator">-</span><span class="operator">&gt;</span>fieldIndex(<span class="string">"description"</span>));

    mapper <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qdatawidgetmapper.htm" translate="no">QDataWidgetMapper</a></span>(<span class="keyword">this</span>);
    mapper<span class="operator">-</span><span class="operator">&gt;</span>setModel(model);
    mapper<span class="operator">-</span><span class="operator">&gt;</span>setItemDelegate(<span class="keyword">new</span> <span class="type"><a href="./qsqlrelationaldelegate.htm" translate="no">QSqlRelationalDelegate</a></span>(<span class="keyword">this</span>));
    mapper<span class="operator">-</span><span class="operator">&gt;</span>addMapping(nameEdit<span class="operator">,</span> model<span class="operator">-</span><span class="operator">&gt;</span>fieldIndex(<span class="string">"name"</span>));
    mapper<span class="operator">-</span><span class="operator">&gt;</span>addMapping(addressEdit<span class="operator">,</span> model<span class="operator">-</span><span class="operator">&gt;</span>fieldIndex(<span class="string">"address"</span>));
    mapper<span class="operator">-</span><span class="operator">&gt;</span>addMapping(typeComboBox<span class="operator">,</span> typeIndex);</pre></div>
<p>For the combo box, we already know the index of the field in the model from the <code translate="no">setupModel()</code> function. We use a <a href="./qsqlrelationaldelegate.htm" translate="no">QSqlRelationalDelegate</a> as a proxy between the mapper and the input widgets to match up the "typeid" values in the model with those in the combo box's model and populate the combo box with descriptions rather than integer values.</p>
<p>As a result, the user is able to select an item from the combo box, and the associated value is written back to the model.</p>
<p>The rest of the constructor is very similar to that of the <a href="./qtwidgets-itemviews-simplewidgetmapper-example.htm" translate="no">Simple Widget Mapper Example</a>:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    connect(previousButton<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qpushbutton.htm" translate="no">QPushButton</a></span><span class="operator">::</span>clicked<span class="operator">,</span>
            mapper<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qdatawidgetmapper.htm" translate="no">QDataWidgetMapper</a></span><span class="operator">::</span>toPrevious);
    connect(nextButton<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qpushbutton.htm" translate="no">QPushButton</a></span><span class="operator">::</span>clicked<span class="operator">,</span>
            mapper<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qdatawidgetmapper.htm" translate="no">QDataWidgetMapper</a></span><span class="operator">::</span>toNext);
    connect(mapper<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qdatawidgetmapper.htm" translate="no">QDataWidgetMapper</a></span><span class="operator">::</span>currentIndexChanged<span class="operator">,</span>
            <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>Window<span class="operator">::</span>updateButtons);

    <span class="type"><a href="./qgridlayout.htm" translate="no">QGridLayout</a></span> <span class="operator">*</span>layout <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qgridlayout.htm" translate="no">QGridLayout</a></span>();
    layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(nameLabel<span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">1</span>);
    layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(nameEdit<span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">1</span>);
    layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(previousButton<span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">2</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">1</span>);
    layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(addressLabel<span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">1</span>);
    layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(addressEdit<span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">2</span><span class="operator">,</span> <span class="number">1</span>);
    layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(nextButton<span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">2</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">1</span>);
    layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(typeLabel<span class="operator">,</span> <span class="number">3</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">1</span>);
    layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(typeComboBox<span class="operator">,</span> <span class="number">3</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">1</span>);
    setLayout(layout);

    setWindowTitle(tr(<span class="string">"SQL Widget Mapper"</span>));
    mapper<span class="operator">-</span><span class="operator">&gt;</span>toFirst();
}</pre></div>
<p>We show the implementation of the <code translate="no">updateButtons()</code> slot for completeness:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> Window<span class="operator">::</span>updateButtons(<span class="type">int</span> row)
{
    previousButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(row <span class="operator">&gt;</span> <span class="number">0</span>);
    nextButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(row <span class="operator">&lt;</span> model<span class="operator">-</span><span class="operator">&gt;</span>rowCount() <span class="operator">-</span> <span class="number">1</span>);
}</pre></div>
<a name="summary-and-further-reading"></a>
<h4 id="summary-and-further-reading">Summary and Further Reading<a class="plink" href="#summary-and-further-reading" title="Direct link to this headline"></a></h4>
<p>The use of a separate model for the combo box and a special delegate for the widget mapper allows us to present a menu of choices to the user. Although the choices are stored in the same database as the user's data, they are held in a separate table. Using this approach, we can reconstructed complete records at a later time while using database features appropriately.</p>
<p>If SQL models are not being used, it is still possible to use more than one model to present choices to the user. This is covered by the <a href="./qtwidgets-itemviews-combowidgetmapper-example.htm" translate="no">Combo Widget Mapper Example</a>.</p>
<p><a href="https://code.qt.io/cgit/qt/qtbase.git/tree/examples/sql/sqlwidgetmapper?h=5.15" translate="no">Example project @ code.qt.io</a></p>
</div>
<!-- @@@sqlwidgetmapper -->
</div>
<p class="copy-notice">
<acronym title="Copyright">Â©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>