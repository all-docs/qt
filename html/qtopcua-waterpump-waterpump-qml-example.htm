<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Qt Quick Waterpump Example | Qt OPC UA</title>
<link rel="canonical" href="https://doc.qt.io/qt-6/qtopcua-waterpump-waterpump-qml-example.html">
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="http://doc.qt.io/QtForAutomation/index.html" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtopcua-index.htm" translate="no">Qt OPC UA</a></li>
                            <li><a href="./qtopcua-examples.htm" translate="no">Qt OPC UA Examples</a></li>
                            <li><a>Qt Quick Waterpump Example</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">Qt Quick Waterpump Example</h1>
<span class="subtitle"></span>
<!-- $$$waterpump/waterpump-qml-brief -->
<p>Interacting with an OPC UA server to build a QML-based HMI for a simple machine.</p>
<!-- @@@waterpump/waterpump-qml -->
<!-- $$$waterpump/waterpump-qml-description -->
<div class="descr"> <a name="details"></a>
<p><i>Qt Quick Waterpump</i> shows how to use Qt OPC UA QML API to interact with an OPC UA server to build a QML based HMI for a simple machine.</p>
<a name="building-the-server"></a>
<h4 id="building-the-server">Building the Server<a class="plink" href="#building-the-server" title="Direct link to this headline"></a></h4>
<p>Before you can use the waterpump examples, you need to build the simulation server. The simulator server project resides next to the waterpump examples. You can open and build it in QtCreator or from the terminal as usual.</p>
<a name="the-simulation"></a>
<h4 id="the-simulation">The Simulation<a class="plink" href="#the-simulation" title="Direct link to this headline"></a></h4>
<p>The OPC UA server included in this example runs a simulation of a machine containing two tanks, a water pump and a valve. Water can be pumped from the first tank into the second tank and then be flushed from the second tank by opening the valve. Both operations have a user-configurable setpoint which controls how much water is pumped to or flushed from the second tank.</p>
<p>The following nodes exist on the server:</p>
<div class="table"><table class="generic">
<thead><tr class="qt-style"><th><a href="./qml-qtopcua-nodeid.htm" translate="no">NodeId</a></th><th>Function</th></tr></thead>
<tbody><tr class="odd" valign="top"><td>ns=2;s=Machine</td><td>The folder containing the method and variable nodes for the machine</td></tr>
<tr class="even" valign="top"><td>ns=2;s=Machine.State</td><td>The state of the machine</td></tr>
<tr class="odd" valign="top"><td>ns=2;s=Machine.Tank1.PercentFilled</td><td>The current fill status of the first tank</td></tr>
<tr class="even" valign="top"><td>ns=2;s=Machine.Tank2.PercentFilled</td><td>The current fill status of the second tank</td></tr>
<tr class="odd" valign="top"><td>ns=2;s=Machine.Tank2.TargetPercent</td><td>The setpoint for pumping and flushing</td></tr>
<tr class="even" valign="top"><td>ns=2;s=Machine.Tank2.ValveState</td><td>The state of the valve of the second tank</td></tr>
<tr class="odd" valign="top"><td>ns=2;s=Machine.Designation</td><td>A human readable designation of the machine for display purposes</td></tr>
<tr class="even" valign="top"><td>ns=2;s=Machine.Start</td><td>Call this method to start the pump</td></tr>
<tr class="odd" valign="top"><td>ns=2;s=Machine.Stop</td><td>Call this method to stop the pump</td></tr>
<tr class="even" valign="top"><td>ns=2;s=Machine.FlushTank2</td><td>Call this method to flush tank 2</td></tr>
</tbody></table></div>
<a name="implementation"></a>
<h4 id="implementation">Implementation<a class="plink" href="#implementation" title="Direct link to this headline"></a></h4>
<p>This example uses QML items to read and write values as well as method calls. All operations are asynchronous and handled by QML in the background.</p>
<p>A QML item represents the machine and its components. This item does not have any graphical interface and only provides access to the properties of the machine. It has two tanks which are instances of a separate <code translate="no">Tank</code> component.</p>
<a name="properties"></a>
<h5 id="properties">Properties<a class="plink" href="#properties" title="Direct link to this headline"></a></h5>
<p>The machine item exposes all properties and subitems as properties.</p>
<div class="pre"><pre class="cpp" translate="no">    ...
    readonly property <span class="type">alias</span> <span class="name">tank1</span>: <span class="name">tank1</span>
    readonly property <span class="type">alias</span> <span class="name">tank2</span>: <span class="name">tank2</span>
    readonly property <span class="type">alias</span> <span class="name">state</span>: <span class="name">machineState</span>.<span class="name">value</span>
    readonly property <span class="type">alias</span> <span class="name">tank2PercentFilled</span>: <span class="name">tank2</span>.<span class="name">percentFilled</span>
    readonly property <span class="type">alias</span> <span class="name">tank2valveState</span>: <span class="name">tank2</span>.<span class="name">valveState</span>
    readonly property <span class="type">alias</span> <span class="name">designation</span>: <span class="name">designation</span>.<span class="name">value</span>
    property <span class="type">alias</span> <span class="name">resetMethod</span>: <span class="name">resetMethod</span>
    property <span class="type">alias</span> <span class="name">startMethod</span>: <span class="name">startMethod</span>
    property <span class="type">alias</span> <span class="name">stopMethod</span>: <span class="name">stopMethod</span>
    property <span class="type">alias</span> <span class="name">flushMethod</span>: <span class="name">flushMethod</span>
    ...</pre></div>
<a name="asynchronous-handlers"></a>
<h5 id="asynchronous-handlers">Asynchronous Handlers<a class="plink" href="#asynchronous-handlers" title="Direct link to this headline"></a></h5>
<p>The asynchronous parts of the API are handled by QML automatically because signals are emitted for every property change by default.</p>
<p>For example, the button to flush the second tank is enabled only if the backend is connected to the server, the machine is idle, and the tank level is above the setpoint. On click, the <code translate="no">flushTank2()</code> method is called on the server.</p>
<div class="pre"><pre class="cpp" translate="no">    <span class="type">Tank2Unit</span> {
        <span class="name">flushButtonEnabled</span>: <span class="name">connection</span>.<span class="name">connected</span> <span class="operator">&amp;&amp;</span> <span class="name">machine</span>.<span class="name">state</span> <span class="operator">===</span> <span class="name">Machine</span>.<span class="name">MachineState</span>.<span class="name">Idle</span> <span class="operator">&amp;&amp;</span> <span class="name">machine</span>.<span class="name">tank2</span>.<span class="name">percentFilled</span> <span class="operator">&gt;</span> <span class="name">machine</span>.<span class="name">tank2</span>.<span class="name">targetPercent</span>
        <span class="name">percentFilled</span>: <span class="name">machine</span>.<span class="name">tank2</span>.<span class="name">percentFilled</span>
        <span class="name">valveState</span>: <span class="name">machine</span>.<span class="name">tank2valveState</span></pre></div>
<a name="usage"></a>
<h4 id="usage">Usage<a class="plink" href="#usage" title="Direct link to this headline"></a></h4>
<p>The server is started automatically by the HMI application. After connecting to the server by clicking the <b translate="no">Connect</b> button, drag the slider to set a setpoint, then click <b translate="no">Start</b> to start pumping water from the first tank to the second tank. After setting a setpoint lower than the current value of the second tank, a click on <b translate="no">Flush</b> opens the valve.</p>
<p>If there is no water left, click <b translate="no">Reset simulation</b> to refill the first tank.</p>
<p class="centerAlign"><img alt="" src="./images/tankexample.jpg"></p><p>Files:</p>
<ul>
<li><a href="./qtopcua-waterpump-waterpump-qml-main-cpp.htm" translate="no">waterpump/waterpump-qml/main.cpp</a></li>
<li><a href="./qtopcua-waterpump-waterpump-qml-qml-qrc.htm" translate="no">waterpump/waterpump-qml/qml.qrc</a></li>
<li><a href="./qtopcua-waterpump-waterpump-qml-waterpump-qml-pro.htm" translate="no">waterpump/waterpump-qml/waterpump-qml.pro</a></li>
</ul>
</div>
<!-- @@@waterpump/waterpump-qml -->
</div>
<p class="copy-notice">
<acronym title="Copyright">Â©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>