<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Router Example | Qt KNX</title>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="http://doc.qt.io/QtForAutomation/index.html" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtknx-index.htm" translate="no">Qt KNX</a></li>
                            <li><a href="./qtknx-examples.htm" translate="no">Qt KNX Examples</a></li>
                            <li><a>Router Example</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left nosidebar">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    
<div class="context">
<h1 class="title">Router Example</h1>
<span class="subtitle"></span>
<div class="pre"><pre class="cpp prettyprint" translate="no"><input id="ec_toggle" type="checkbox"><label for="ec_toggle"></label><div id="ec_expand"><span class="comment">/****************************************************************************
**
** Copyright (C) 2018 The Qt Company Ltd.
** Contact: https://www.qt.io/licensing/
**
** This file is part of the examples of the Qt Knx module.
**
** $QT_BEGIN_LICENSE:BSD$
** Commercial License Usage
** Licensees holding valid commercial Qt licenses may use this file in
** accordance with the commercial license agreement provided with the
** Software or, alternatively, in accordance with the terms contained in
** a written agreement between you and The Qt Company. For licensing terms
** and conditions see https://www.qt.io/terms-conditions. For further
** information use the contact form at https://www.qt.io/contact-us.
**
** BSD License Usage
** Alternatively, you may use this file under the terms of the BSD license
** as follows:
**
** "Redistribution and use in source and binary forms, with or without
** modification, are permitted provided that the following conditions are
** met:
**   * Redistributions of source code must retain the above copyright
**     notice, this list of conditions and the following disclaimer.
**   * Redistributions in binary form must reproduce the above copyright
**     notice, this list of conditions and the following disclaimer in
**     the documentation and/or other materials provided with the
**     distribution.
**   * Neither the name of The Qt Company Ltd nor the names of its
**     contributors may be used to endorse or promote products derived
**     from this software without specific prior written permission.
**
**
** THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
** "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
** LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
** A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
** OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
** SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
** LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
** DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
** THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
** (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
** OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE."
**
** $QT_END_LICENSE$
**
****************************************************************************/</span></div>

<span class="preprocessor">#include &lt;QtCore/qcoreapplication.h&gt;</span>
<span class="preprocessor">#include &lt;QtCore/qcommandlineparser.h&gt;</span>
<span class="preprocessor">#include &lt;QtCore/qdebug.h&gt;</span>
<span class="preprocessor">#include &lt;QtCore/qdatetime.h&gt;</span>

<span class="preprocessor">#include &lt;QtKnx/qknxnetiprouter.h&gt;</span>
<span class="preprocessor">#include &lt;QtKnx/qknxlinklayerframebuilder.h&gt;</span>
<span class="preprocessor">#include &lt;QtKnx/qknxnetiprouter.h&gt;</span>
<span class="preprocessor">#include &lt;QtKnx/qknxnetiproutingbusy.h&gt;</span>
<span class="preprocessor">#include &lt;QtKnx/qknxnetiproutingindication.h&gt;</span>
<span class="preprocessor">#include &lt;QtKnx/qknxnetiproutinglostmessage.h&gt;</span>

<span class="preprocessor">#include &lt;QtNetwork/qhostaddress.h&gt;</span>
<span class="preprocessor">#include &lt;QtNetwork/qnetworkinterface.h&gt;</span>
<span class="preprocessor">#include &lt;QtNetwork/qnetworkdatagram.h&gt;</span>
<span class="preprocessor">#include &lt;QtNetwork/qudpsocket.h&gt;</span>

<span class="preprocessor">#ifdef Q_OS_WIN</span>
<span class="preprocessor"># include &lt;QtCore/QWinEventNotifier&gt;</span>
<span class="preprocessor"># include &lt;windows.h&gt;</span>
<span class="preprocessor">#else</span>
<span class="preprocessor"># include &lt;QtCore/QSocketNotifier&gt;</span>
<span class="preprocessor"># include &lt;unistd.h&gt;</span>
<span class="preprocessor">#endif</span>

<span class="type">void</span> startRouter(<span class="type"><a href="./qknxnetiprouter.htm" translate="no">QKnxNetIpRouter</a></span> <span class="operator">&amp;</span>router<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qcommandlineparser.htm" translate="no">QCommandLineParser</a></span> <span class="operator">&amp;</span>cliParser)
{
    router<span class="operator">.</span>start();

    <span class="keyword">if</span> (router<span class="operator">.</span>error() <span class="operator">!</span><span class="operator">=</span> <span class="type"><a href="./qknxnetiprouter.htm" translate="no">QKnxNetIpRouter</a></span><span class="operator">::</span>Error<span class="operator">::</span>None)
        <span class="keyword">return</span>;

    <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Network interface used: "</span>
                      <span class="operator">&lt;</span><span class="operator">&lt;</span> router<span class="operator">.</span>interfaceAffinity()<span class="operator">.</span>name() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"("</span>
                      <span class="operator">&lt;</span><span class="operator">&lt;</span> router<span class="operator">.</span>interfaceAffinity()<span class="operator">.</span>addressEntries()<span class="operator">.</span>first()<span class="operator">.</span>ip()
                      <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">")"</span>;
    <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Multicast address: "</span>
                      <span class="operator">&lt;</span><span class="operator">&lt;</span> router<span class="operator">.</span>multicastAddress();
    <span class="keyword">if</span> (cliParser<span class="operator">.</span>isSet(<span class="string">"receiver"</span>)) {
        <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Working as a receiver of KNX Routing messages."</span>;
        <span class="keyword">return</span>;
    }

    <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Type 'quit' to stop the application."</span>;
    <span class="keyword">if</span> (cliParser<span class="operator">.</span>isSet(<span class="string">"indication"</span>)) {
        <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Type the hexadecimal content of the indication "</span>
                             <span class="string">"and hit enter. Setting no content by default "</span>
                             <span class="string">"uses 1100b4e000000002010000."</span>;
    } <span class="keyword">else</span> {
        <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Hit enter for sending the message"</span>;
    }
}

<span class="type">void</span> setupRouterCLI(<span class="type"><a href="./qknxnetiprouter.htm" translate="no">QKnxNetIpRouter</a></span> <span class="operator">&amp;</span>router<span class="operator">,</span>
                    <span class="keyword">const</span> <span class="type"><a href="./qcommandlineparser.htm" translate="no">QCommandLineParser</a></span> <span class="operator">&amp;</span>cliParser<span class="operator">,</span>
                    <span class="type"><a href="./qtextstream.htm" translate="no">QTextStream</a></span> <span class="operator">&amp;</span> input<span class="operator">,</span>
<span class="preprocessor">#ifdef Q_OS_WIN</span>
                    <span class="type"><a href="./qwineventnotifier.htm" translate="no">QWinEventNotifier</a></span> <span class="operator">&amp;</span>notifier)
{
    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="operator">&amp;</span>notifier<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qwineventnotifier.htm" translate="no">QWinEventNotifier</a></span><span class="operator">::</span>activated<span class="operator">,</span> <span class="operator">[</span><span class="operator">&amp;</span><span class="operator">]</span>(HANDLE) {
<span class="preprocessor">#else</span>
                    <span class="type"><a href="./qsocketnotifier.htm" translate="no">QSocketNotifier</a></span> <span class="operator">&amp;</span>notifier)
{
    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="operator">&amp;</span>notifier<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qsocketnotifier.htm" translate="no">QSocketNotifier</a></span><span class="operator">::</span>activated<span class="operator">,</span> <span class="operator">[</span><span class="operator">&amp;</span><span class="operator">]</span>(<span class="type">int</span>) {
<span class="preprocessor">#endif</span>
        <span class="keyword">auto</span> tmp <span class="operator">=</span> input<span class="operator">.</span>readLine()<span class="operator">.</span>toLatin1();
        <span class="keyword">if</span> (tmp <span class="operator">=</span><span class="operator">=</span> <span class="string">"quit"</span>) {
            router<span class="operator">.</span>stop();
            <span class="keyword">return</span>;
        }

        <span class="keyword">if</span> (cliParser<span class="operator">.</span>isSet(<span class="string">"indication"</span>)) {
            <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">auto</span> bytes <span class="operator">=</span> <span class="type"><a href="./qknxbytearray.htm" translate="no">QKnxByteArray</a></span><span class="operator">::</span>fromHex(<span class="string">"1100b4e000000002010000"</span>);
            <span class="keyword">auto</span> frame <span class="operator">=</span> <span class="type"><a href="./qknxlinklayerframe.htm" translate="no">QKnxLinkLayerFrame</a></span><span class="operator">::</span>builder()
                <span class="operator">.</span>setData(tmp<span class="operator">.</span>isEmpty() <span class="operator">?</span> bytes : <span class="type"><a href="./qknxbytearray.htm" translate="no">QKnxByteArray</a></span><span class="operator">::</span>fromHex(tmp))
                <span class="operator">.</span>setMedium(<span class="type"><a href="./qknx.htm" translate="no">QKnx</a></span><span class="operator">::</span>MediumType<span class="operator">::</span>NetIP)
                <span class="operator">.</span>createFrame();
            <span class="keyword">auto</span> indication <span class="operator">=</span> <span class="type"><a href="./qknxnetiproutingindicationproxy.htm" translate="no">QKnxNetIpRoutingIndicationProxy</a></span><span class="operator">::</span>builder()
                              <span class="operator">.</span>setCemi(frame)
                              <span class="operator">.</span>create();
            router<span class="operator">.</span>sendRoutingIndication(indication);
        } <span class="keyword">else</span> <span class="keyword">if</span> (cliParser<span class="operator">.</span>isSet(<span class="string">"busy"</span>)) {
            <span class="keyword">auto</span> routingBusyFrame <span class="operator">=</span> <span class="type"><a href="./qknxnetiproutingbusyproxy.htm" translate="no">QKnxNetIpRoutingBusyProxy</a></span><span class="operator">::</span>builder()
                <span class="operator">.</span>setDeviceState(<span class="type">QKnxNetIp</span><span class="operator">::</span>DeviceState<span class="operator">::</span>IpFault)
                <span class="operator">.</span>setRoutingBusyWaitTime(cliParser<span class="operator">.</span>value(<span class="string">"BusyWaitTime"</span>)<span class="operator">.</span>toUInt())
                <span class="operator">.</span>setRoutingBusyControl(cliParser<span class="operator">.</span>value(<span class="string">"BusyControlField"</span>)<span class="operator">.</span>toUInt())
                <span class="operator">.</span>create();
            router<span class="operator">.</span>sendRoutingBusy(routingBusyFrame);
        } <span class="keyword">else</span> <span class="keyword">if</span> (cliParser<span class="operator">.</span>isSet(<span class="string">"lost"</span>)) {
            <span class="keyword">auto</span> routingLostFrame <span class="operator">=</span> <span class="type"><a href="./qknxnetiproutinglostmessageproxy.htm" translate="no">QKnxNetIpRoutingLostMessageProxy</a></span><span class="operator">::</span>builder()
                <span class="operator">.</span>setDeviceState(<span class="type">QKnxNetIp</span><span class="operator">::</span>DeviceState<span class="operator">::</span>IpFault)
                <span class="operator">.</span>setLostMessageCount(<span class="number">0xffff</span>)
                <span class="operator">.</span>create();
            router<span class="operator">.</span>sendRoutingLostMessage(routingLostFrame);
        }
    });
}

<span class="type">void</span> setupRouterSignalHandlers(<span class="type"><a href="./qknxnetiprouter.htm" translate="no">QKnxNetIpRouter</a></span> <span class="operator">&amp;</span>router<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qnetworkinterface.htm" translate="no">QNetworkInterface</a></span> <span class="operator">&amp;</span>iface<span class="operator">,</span>
                 <span class="keyword">const</span> <span class="type"><a href="./qhostaddress.htm" translate="no">QHostAddress</a></span> <span class="operator">&amp;</span>multicastAddress)
{
    router<span class="operator">.</span>setInterfaceAffinity(iface);
    Q_ASSERT(router<span class="operator">.</span>interfaceAffinity()<span class="operator">.</span>index() <span class="operator">=</span><span class="operator">=</span> iface<span class="operator">.</span>index());
    router<span class="operator">.</span>setMulticastAddress(multicastAddress);

    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="operator">&amp;</span>router<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qknxnetiprouter.htm" translate="no">QKnxNetIpRouter</a></span><span class="operator">::</span>stateChanged<span class="operator">,</span>
                     <span class="operator">[</span><span class="operator">&amp;</span><span class="operator">]</span>(<span class="type"><a href="./qknxnetiprouter.htm" translate="no">QKnxNetIpRouter</a></span><span class="operator">::</span>State state) {
        <span class="keyword">if</span> (state <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="./qknxnetiprouter.htm" translate="no">QKnxNetIpRouter</a></span><span class="operator">::</span>State<span class="operator">::</span>Routing)
            <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote()  <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="type"><a href="./qtime.htm" translate="no">QTime</a></span><span class="operator">::</span>currentTime()<span class="operator">.</span>toString()
                               <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">": Router is in Routing state."</span>;
        <span class="keyword">else</span> <span class="keyword">if</span> (state <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="./qknxnetiprouter.htm" translate="no">QKnxNetIpRouter</a></span><span class="operator">::</span>State<span class="operator">::</span>Failure)
            <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote()  <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="type"><a href="./qtime.htm" translate="no">QTime</a></span><span class="operator">::</span>currentTime()<span class="operator">.</span>toString()
                               <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">": Error: "</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> router<span class="operator">.</span>errorString();
        <span class="keyword">else</span> <span class="keyword">if</span> (state <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="./qknxnetiprouter.htm" translate="no">QKnxNetIpRouter</a></span><span class="operator">::</span>State<span class="operator">::</span>NeighborBusy)
            <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="type"><a href="./qtime.htm" translate="no">QTime</a></span><span class="operator">::</span>currentTime()<span class="operator">.</span>toString()
                              <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">": Neighbor router is busy. Busy timer started"</span>;
        <span class="keyword">else</span> <span class="keyword">if</span> (state <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="./qknxnetiprouter.htm" translate="no">QKnxNetIpRouter</a></span><span class="operator">::</span>State<span class="operator">::</span>Stop)
            <span class="type"><a href="./qcoreapplication.htm" translate="no">QCoreApplication</a></span><span class="operator">::</span>quit();
    });

    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="operator">&amp;</span>router<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qknxnetiprouter.htm" translate="no">QKnxNetIpRouter</a></span><span class="operator">::</span>routingIndicationReceived<span class="operator">,</span>
                     <span class="operator">[</span><span class="operator">]</span>(<span class="type"><a href="./qknxnetipframe.htm" translate="no">QKnxNetIpFrame</a></span> frame) {
        <span class="type"><a href="./qknxnetiproutingindicationproxy.htm" translate="no">QKnxNetIpRoutingIndicationProxy</a></span> indication(frame);
        <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Received routing indication"</span>
                          <span class="operator">&lt;</span><span class="operator">&lt;</span> indication<span class="operator">.</span>isValid();
    });

    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="operator">&amp;</span>router<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qknxnetiprouter.htm" translate="no">QKnxNetIpRouter</a></span><span class="operator">::</span>routingBusyReceived<span class="operator">,</span>
                     <span class="operator">[</span><span class="operator">]</span>(<span class="type"><a href="./qknxnetipframe.htm" translate="no">QKnxNetIpFrame</a></span> frame) {
        <span class="type"><a href="./qknxnetiproutingbusyproxy.htm" translate="no">QKnxNetIpRoutingBusyProxy</a></span> busy(frame);
        <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Received routing busy, wait time: "</span>
                          <span class="operator">&lt;</span><span class="operator">&lt;</span> busy<span class="operator">.</span>routingBusyWaitTime() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">" busy control field: "</span>
                          <span class="operator">&lt;</span><span class="operator">&lt;</span> busy<span class="operator">.</span>routingBusyControl();
    });

    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="operator">&amp;</span>router<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qknxnetiprouter.htm" translate="no">QKnxNetIpRouter</a></span><span class="operator">::</span>routingLostCountReceived<span class="operator">,</span>
                     <span class="operator">[</span><span class="operator">]</span>(<span class="type"><a href="./qknxnetipframe.htm" translate="no">QKnxNetIpFrame</a></span> frame) {
        <span class="type"><a href="./qknxnetiproutinglostmessageproxy.htm" translate="no">QKnxNetIpRoutingLostMessageProxy</a></span> lost(frame);
        <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Received routing lost count"</span>
                          <span class="operator">&lt;</span><span class="operator">&lt;</span> lost<span class="operator">.</span>deviceState();
    });

    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="operator">&amp;</span>router<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qknxnetiprouter.htm" translate="no">QKnxNetIpRouter</a></span><span class="operator">::</span>routingIndicationSent<span class="operator">,</span>
                     <span class="operator">[</span><span class="operator">]</span>(<span class="type"><a href="./qknxnetipframe.htm" translate="no">QKnxNetIpFrame</a></span> frame) {
        <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Sent routing indication"</span>;
        Q_UNUSED(frame);
    });

    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="operator">&amp;</span>router<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qknxnetiprouter.htm" translate="no">QKnxNetIpRouter</a></span><span class="operator">::</span>routingBusySent<span class="operator">,</span>
                     <span class="operator">[</span><span class="operator">]</span>(<span class="type"><a href="./qknxnetipframe.htm" translate="no">QKnxNetIpFrame</a></span> frame) {
        <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Sent routing busy"</span>;
        Q_UNUSED(frame);
    });

    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="operator">&amp;</span>router<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qknxnetiprouter.htm" translate="no">QKnxNetIpRouter</a></span><span class="operator">::</span>routingLostCountSent<span class="operator">,</span>
                     <span class="operator">[</span><span class="operator">]</span>(<span class="type"><a href="./qknxnetipframe.htm" translate="no">QKnxNetIpFrame</a></span> frame) {
        <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Sent routing lost count"</span>;
        Q_UNUSED(frame);
    });
}

<span class="type">int</span> main(<span class="type">int</span> argc<span class="operator">,</span> <span class="type">char</span> <span class="operator">*</span>argv<span class="operator">[</span><span class="operator">]</span>)
{
    <span class="type"><a href="./qcoreapplication.htm" translate="no">QCoreApplication</a></span> a(argc<span class="operator">,</span> argv);

    <span class="type"><a href="./qcommandlineparser.htm" translate="no">QCommandLineParser</a></span> cliParser;
    cliParser<span class="operator">.</span>addHelpOption();

    cliParser<span class="operator">.</span>addOptions({
        { { <span class="string">"n"</span><span class="operator">,</span> <span class="string">"interface"</span> }<span class="operator">,</span> <span class="string">"Set the network interface name that "</span>
        <span class="string">"the KNXnet/Ip routing interface will use."</span><span class="operator">,</span> <span class="string">"InterfaceName"</span><span class="operator">,</span> <span class="string">"eth0"</span> }<span class="operator">,</span>
        { { <span class="string">"m"</span><span class="operator">,</span> <span class="string">"multicastAddress"</span> }<span class="operator">,</span> <span class="string">"Sets the multicast address that "</span>
        <span class="string">"the KNXnet/Ip routing interface will use for sending routing messages."</span><span class="operator">,</span>
        <span class="string">"multicastAddress"</span><span class="operator">,</span> <span class="string">"224.0.23.12"</span> }<span class="operator">,</span>
        { { <span class="string">"i"</span><span class="operator">,</span> <span class="string">"indication"</span> }<span class="operator">,</span> <span class="string">"Sends routing indication messages"</span> }<span class="operator">,</span>
        { { <span class="string">"b"</span><span class="operator">,</span> <span class="string">"busy"</span> }<span class="operator">,</span> <span class="string">"Sends routing busy messages"</span> }<span class="operator">,</span>
        { <span class="string">"busyControlField"</span><span class="operator">,</span> <span class="string">"Sets the busy control field of busy messages."</span><span class="operator">,</span>
        <span class="string">"busyControlField"</span><span class="operator">,</span> <span class="string">"0"</span> }<span class="operator">,</span>
        { <span class="string">"busyWaitTime"</span><span class="operator">,</span> <span class="string">"Sets the wait time for busy messages."</span><span class="operator">,</span>
        <span class="string">"busyWaitTime"</span><span class="operator">,</span> <span class="string">"10000"</span> }<span class="operator">,</span>
        { { <span class="string">"l"</span><span class="operator">,</span> <span class="string">"lost"</span> }<span class="operator">,</span> <span class="string">"Sends routing lost messages"</span> }<span class="operator">,</span>
        { { <span class="string">"r"</span><span class="operator">,</span> <span class="string">"receiver"</span> }<span class="operator">,</span> <span class="string">"Only work as a KNXnet/IP routing message receiver"</span> }<span class="operator">,</span>
    });
    cliParser<span class="operator">.</span>process(a);

    <span class="type"><a href="./qnetworkinterface.htm" translate="no">QNetworkInterface</a></span> iface { <span class="type"><a href="./qnetworkinterface.htm" translate="no">QNetworkInterface</a></span><span class="operator">::</span>interfaceFromName(cliParser<span class="operator">.</span>value(<span class="string">"interface"</span>)) };
    <span class="keyword">if</span> (<span class="operator">!</span>iface<span class="operator">.</span>isValid()) {
        <span class="keyword">auto</span> interfaces <span class="operator">=</span> iface<span class="operator">.</span>allInterfaces();
        <span class="type"><a href="./qlist.htm" translate="no">QList</a></span><span class="operator">&lt;</span><span class="type"><a href="./qnetworkinterface.htm" translate="no">QNetworkInterface</a></span><span class="operator">&gt;</span><span class="operator">::</span>iterator found <span class="operator">=</span> std<span class="operator">::</span>find_if(
            interfaces<span class="operator">.</span>begin()<span class="operator">,</span> interfaces<span class="operator">.</span>end()<span class="operator">,</span> <span class="operator">[</span><span class="operator">]</span>(<span class="keyword">const</span> <span class="type"><a href="./qnetworkinterface.htm" translate="no">QNetworkInterface</a></span> <span class="operator">&amp;</span>i) {
                <span class="keyword">return</span> i<span class="operator">.</span>type() <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="./qnetworkinterface.htm" translate="no">QNetworkInterface</a></span><span class="operator">::</span>Ethernet;
            }
        );
        <span class="keyword">if</span> (found <span class="operator">=</span><span class="operator">=</span>  iface<span class="operator">.</span>allInterfaces()<span class="operator">.</span>end()) {
            <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"No valid network interface given and no Ethernet adapter found."</span>;
            cliParser<span class="operator">.</span>showHelp();
        }
        iface <span class="operator">=</span> <span class="keyword">static_cast</span><span class="operator">&lt;</span><span class="type"><a href="./qnetworkinterface.htm" translate="no">QNetworkInterface</a></span><span class="operator">&gt;</span>(<span class="operator">*</span>found);
    }

    <span class="type"><a href="./qhostaddress.htm" translate="no">QHostAddress</a></span> multicastAddress <span class="operator">=</span> <span class="type"><a href="./qhostaddress.htm" translate="no">QHostAddress</a></span>(cliParser<span class="operator">.</span>value(<span class="string">"multicastAddress"</span>));
    <span class="keyword">if</span> (<span class="operator">!</span>multicastAddress<span class="operator">.</span>isMulticast()) {
        <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Multicast address invalid."</span>;
        cliParser<span class="operator">.</span>showHelp();
    }
    <span class="keyword">if</span> (<span class="operator">!</span>cliParser<span class="operator">.</span>isSet(<span class="string">"indication"</span>)
        <span class="operator">&amp;</span><span class="operator">&amp;</span> <span class="operator">!</span>cliParser<span class="operator">.</span>isSet(<span class="string">"busy"</span>)
        <span class="operator">&amp;</span><span class="operator">&amp;</span> <span class="operator">!</span>cliParser<span class="operator">.</span>isSet(<span class="string">"lost"</span>)
        <span class="operator">&amp;</span><span class="operator">&amp;</span> <span class="operator">!</span>cliParser<span class="operator">.</span>isSet(<span class="string">"receiver"</span>)) {
        <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Missing parameter that specifies the types of "</span>
                             <span class="string">"messages to send."</span>;
        cliParser<span class="operator">.</span>showHelp();
    }

    <span class="type"><a href="./qknxnetiprouter.htm" translate="no">QKnxNetIpRouter</a></span> router;
    setupRouterSignalHandlers(router<span class="operator">,</span> iface<span class="operator">,</span> multicastAddress);

    <span class="type"><a href="./qtextstream.htm" translate="no">QTextStream</a></span> input(stdin<span class="operator">,</span> <span class="type"><a href="./qiodevice.htm" translate="no">QIODevice</a></span><span class="operator">::</span>ReadOnly);
<span class="preprocessor">#ifdef Q_OS_WIN</span>
    <span class="type"><a href="./qwineventnotifier.htm" translate="no">QWinEventNotifier</a></span> notifier(GetStdHandle(STD_INPUT_HANDLE));
<span class="preprocessor">#else</span>
    <span class="type"><a href="./qsocketnotifier.htm" translate="no">QSocketNotifier</a></span> notifier(STDIN_FILENO<span class="operator">,</span> <span class="type"><a href="./qsocketnotifier.htm" translate="no">QSocketNotifier</a></span><span class="operator">::</span>Read);
<span class="preprocessor">#endif</span>
    <span class="keyword">if</span> (<span class="operator">!</span>cliParser<span class="operator">.</span>isSet(<span class="string">"receiver"</span>)) {
        setupRouterCLI(router<span class="operator">,</span> cliParser<span class="operator">,</span> input<span class="operator">,</span> notifier);
    }
    startRouter(router<span class="operator">,</span> cliParser);
    <span class="keyword">return</span> a<span class="operator">.</span>exec();
}</pre></div>
</div>
                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>