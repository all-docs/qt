<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Echo Plugin Example | Qt Widgets</title>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="./index.htm" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtwidgets-index.htm" translate="no">Qt Widgets</a></li>
                            <li><a>Echo Plugin Example</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">Echo Plugin Example</h1>
<span class="subtitle"></span>
<!-- $$$tools/echoplugin-brief -->
<p>This example shows how to create a Qt plugin.</p>
<!-- @@@tools/echoplugin -->
<!-- $$$tools/echoplugin-description -->
<div class="descr"> <a name="details"></a>
<p class="centerAlign"><img alt="" src="./images/echopluginexample.png"></p><p>There are two kinds of plugins in Qt: plugins that extend Qt itself and plugins that extend applications written in Qt. In this example, we show the procedure of implementing plugins that extend applications. When you create a plugin you declare an interface, which is a class with only pure virtual functions. This interface is inherited by the class that implements the plugin. The class is stored in a shared library and can therefore be loaded by applications at run-time. When loaded, the plugin is dynamically cast to the interface using Qt's <a href="./metaobjects.htm" translate="no">meta-object system</a>. The plugin <a href="./plugins-howto.htm" translate="no">overview document</a> gives a high-level introduction to plugins.</p>
<p>We have implemented a plugin, the <code translate="no">EchoPlugin</code>, which implements the <code translate="no">EchoInterface</code>. The interface consists of <code translate="no">echo()</code>, which takes a <a href="./qstring.htm" translate="no">QString</a> as argument. The <code translate="no">EchoPlugin</code> returns the string unaltered (i.e., it works as the familiar echo command found in both Unix and Windows).</p>
<p>We test the plugin in <code translate="no">EchoWindow</code>: when you push the <a href="./qpushbutton.htm" translate="no">QPushButton</a> (as seen in the image above), the application sends the text in the <a href="./qlineedit.htm" translate="no">QLineEdit</a> to the plugin, which echoes it back to the application. The answer from the plugin is displayed in the <a href="./qlabel.htm" translate="no">QLabel</a>.</p>
<a name="echowindow-class-definition"></a>
<h4 id="echowindow-class-definition">EchoWindow Class Definition<a class="plink" href="#echowindow-class-definition" title="Direct link to this headline"></a></h4>
<p>The <code translate="no">EchoWindow</code> class lets us test the <code translate="no">EchoPlugin</code> through a GUI.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">class</span> EchoWindow : <span class="keyword">public</span> <span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span>
{
    Q_OBJECT

<span class="keyword">public</span>:
    EchoWindow();

<span class="keyword">private</span> <span class="keyword">slots</span>:
    <span class="type">void</span> sendEcho();

<span class="keyword">private</span>:
    <span class="type">void</span> createGUI();
    bool loadPlugin();

    EchoInterface <span class="operator">*</span>echoInterface;
    <span class="type"><a href="./qlineedit.htm" translate="no">QLineEdit</a></span> <span class="operator">*</span>lineEdit;
    <span class="type"><a href="./qlabel.htm" translate="no">QLabel</a></span> <span class="operator">*</span>label;
    <span class="type"><a href="./qpushbutton.htm" translate="no">QPushButton</a></span> <span class="operator">*</span>button;
    <span class="type"><a href="./qgridlayout.htm" translate="no">QGridLayout</a></span> <span class="operator">*</span>layout;
};</pre></div>
<p>We load the plugin in <code translate="no">loadPlugin()</code> and cast it to <code translate="no">EchoInterface</code>. When the user clicks the <code translate="no">button</code> we take the text in <code translate="no">lineEdit</code> and call the interface's <code translate="no">echo()</code> with it.</p>
<a name="echowindow-class-implementation"></a>
<h4 id="echowindow-class-implementation">EchoWindow Class Implementation<a class="plink" href="#echowindow-class-implementation" title="Direct link to this headline"></a></h4>
<p>We start with a look at the constructor:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">EchoWindow<span class="operator">::</span>EchoWindow()
{
    createGUI();
    setLayout(layout);
    setWindowTitle(<span class="string">"Echo Plugin Example"</span>);

    <span class="keyword">if</span> (<span class="operator">!</span>loadPlugin()) {
        <span class="type"><a href="./qmessagebox.htm" translate="no">QMessageBox</a></span><span class="operator">::</span>information(<span class="keyword">this</span><span class="operator">,</span> <span class="string">"Error"</span><span class="operator">,</span> <span class="string">"Could not load the plugin"</span>);
        lineEdit<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>);
        button<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>);
    }
}</pre></div>
<p>We create the widgets and set a title for the window. We then load the plugin. <code translate="no">loadPlugin()</code> returns false if the plugin could not be loaded, in which case we disable the widgets. If you wish a more detailed error message, you can use <a href="./qpluginloader.htm#errorString" translate="no">errorString()</a>; we will look more closely at <a href="./qpluginloader.htm" translate="no">QPluginLoader</a> later.</p>
<p>Here is the implementation of <code translate="no">sendEcho()</code>:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> EchoWindow<span class="operator">::</span>sendEcho()
{
    <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> text <span class="operator">=</span> echoInterface<span class="operator">-</span><span class="operator">&gt;</span>echo(lineEdit<span class="operator">-</span><span class="operator">&gt;</span>text());
    label<span class="operator">-</span><span class="operator">&gt;</span>setText(text);
}</pre></div>
<p>This slot is called when the user pushes <code translate="no">button</code> or presses enter in <code translate="no">lineEdit</code>. We call <code translate="no">echo()</code> of the echo interface. In our example this is the <code translate="no">EchoPlugin</code>, but it could be any plugin that inherit the <code translate="no">EchoInterface</code>. We take the <a href="./qstring.htm" translate="no">QString</a> returned from <code translate="no">echo()</code> and display it in the <code translate="no">label</code>.</p>
<p>Here is the implementation of <code translate="no">createGUI()</code>:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> EchoWindow<span class="operator">::</span>createGUI()
{
    lineEdit <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qlineedit.htm" translate="no">QLineEdit</a></span>;
    label <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qlabel.htm" translate="no">QLabel</a></span>;
    label<span class="operator">-</span><span class="operator">&gt;</span>setFrameStyle(<span class="type"><a href="./qframe.htm" translate="no">QFrame</a></span><span class="operator">::</span>Box <span class="operator">|</span> <span class="type"><a href="./qframe.htm" translate="no">QFrame</a></span><span class="operator">::</span>Plain);
    button <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qpushbutton.htm" translate="no">QPushButton</a></span>(tr(<span class="string">"Send Message"</span>));

    connect(lineEdit<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qlineedit.htm" translate="no">QLineEdit</a></span><span class="operator">::</span>editingFinished<span class="operator">,</span>
            <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>EchoWindow<span class="operator">::</span>sendEcho);
    connect(button<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qpushbutton.htm" translate="no">QPushButton</a></span><span class="operator">::</span>clicked<span class="operator">,</span>
            <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>EchoWindow<span class="operator">::</span>sendEcho);

    layout <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qgridlayout.htm" translate="no">QGridLayout</a></span>;
    layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(<span class="keyword">new</span> <span class="type"><a href="./qlabel.htm" translate="no">QLabel</a></span>(tr(<span class="string">"Message:"</span>))<span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">0</span>);
    layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(lineEdit<span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">1</span>);
    layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(<span class="keyword">new</span> <span class="type"><a href="./qlabel.htm" translate="no">QLabel</a></span>(tr(<span class="string">"Answer:"</span>))<span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">0</span>);
    layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(label<span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">1</span>);
    layout<span class="operator">-</span><span class="operator">&gt;</span>addWidget(button<span class="operator">,</span> <span class="number">2</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="type"><a href="./qt.htm" translate="no">Qt</a></span><span class="operator">::</span>AlignRight);
    layout<span class="operator">-</span><span class="operator">&gt;</span>setSizeConstraint(<span class="type"><a href="./qlayout.htm" translate="no">QLayout</a></span><span class="operator">::</span>SetFixedSize);
}</pre></div>
<p>We create the widgets and lay them out in a grid layout. We connect the label and line edit to our <code translate="no">sendEcho()</code> slot.</p>
<p>Here is the <code translate="no">loadPlugin()</code> function:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">bool EchoWindow<span class="operator">::</span>loadPlugin()
{
    <span class="type"><a href="./qdir.htm" translate="no">QDir</a></span> pluginsDir(<span class="type"><a href="./qcoreapplication.htm" translate="no">QCoreApplication</a></span><span class="operator">::</span>applicationDirPath());
<span class="preprocessor">#if defined(Q_OS_WIN)</span>
    <span class="keyword">if</span> (pluginsDir<span class="operator">.</span>dirName()<span class="operator">.</span>toLower() <span class="operator">=</span><span class="operator">=</span> <span class="string">"debug"</span> <span class="operator">|</span><span class="operator">|</span> pluginsDir<span class="operator">.</span>dirName()<span class="operator">.</span>toLower() <span class="operator">=</span><span class="operator">=</span> <span class="string">"release"</span>)
        pluginsDir<span class="operator">.</span>cdUp();
<span class="preprocessor">#elif defined(Q_OS_MAC)</span>
    <span class="keyword">if</span> (pluginsDir<span class="operator">.</span>dirName() <span class="operator">=</span><span class="operator">=</span> <span class="string">"MacOS"</span>) {
        pluginsDir<span class="operator">.</span>cdUp();
        pluginsDir<span class="operator">.</span>cdUp();
        pluginsDir<span class="operator">.</span>cdUp();
    }
<span class="preprocessor">#endif</span>
    pluginsDir<span class="operator">.</span>cd(<span class="string">"plugins"</span>);
    <span class="keyword">const</span> <span class="type"><a href="./qstringlist.htm" translate="no">QStringList</a></span> entries <span class="operator">=</span> pluginsDir<span class="operator">.</span>entryList(<span class="type"><a href="./qdir.htm" translate="no">QDir</a></span><span class="operator">::</span>Files);
    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>fileName : entries) {
        <span class="type"><a href="./qpluginloader.htm" translate="no">QPluginLoader</a></span> pluginLoader(pluginsDir<span class="operator">.</span>absoluteFilePath(fileName));
        <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span> <span class="operator">*</span>plugin <span class="operator">=</span> pluginLoader<span class="operator">.</span>instance();
        <span class="keyword">if</span> (plugin) {
            echoInterface <span class="operator">=</span> qobject_cast<span class="operator">&lt;</span>EchoInterface <span class="operator">*</span><span class="operator">&gt;</span>(plugin);
            <span class="keyword">if</span> (echoInterface)
                <span class="keyword">return</span> <span class="keyword">true</span>;
            pluginLoader<span class="operator">.</span>unload();
        }
    }

    <span class="keyword">return</span> <span class="keyword">false</span>;
}</pre></div>
<p>Access to plugins at run-time is provided by <a href="./qpluginloader.htm" translate="no">QPluginLoader</a>. You supply it with the filename of the shared library the plugin is stored in and call <a href="./qpluginloader.htm#instance" translate="no">instance()</a>, which loads and returns the root component of the plugin (i.e., it resolves the type of the plugin and creates a <a href="./qobject.htm" translate="no">QObject</a> instance of it). If the plugin was not successfully loaded, it will be null, so we return false. If it was loaded correctly, we can cast the plugin to our <code translate="no">EchoInterface</code> and return true. In the case that the plugin loaded does not implement the <code translate="no">EchoInterface</code>, <code translate="no">instance()</code> will return null, but this cannot happen in our example. Notice that the location of the plugin is not the same for all platforms.</p>
<a name="echointerface-class-definition"></a>
<h4 id="echointerface-class-definition">EchoInterface Class Definition<a class="plink" href="#echointerface-class-definition" title="Direct link to this headline"></a></h4>
<p>The <code translate="no">EchoInterface</code> defines the functions that the plugin will provide. An interface is a class that only consists of pure virtual functions. If non virtual functions were present in the class you would get misleading compile errors in the moc files.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">class</span> EchoInterface
{
<span class="keyword">public</span>:
    <span class="keyword">virtual</span> <span class="operator">~</span>EchoInterface() <span class="operator">=</span> <span class="keyword">default</span>;
    <span class="keyword">virtual</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> echo(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>message) <span class="operator">=</span> <span class="number">0</span>;
};

<span class="preprocessor">#define EchoInterface_iid "org.qt-project.Qt.Examples.EchoInterface"</span>

Q_DECLARE_INTERFACE(EchoInterface<span class="operator">,</span> EchoInterface_iid)</pre></div>
<p>We declare <code translate="no">echo()</code>. In our <code translate="no">EchoPlugin</code> we use this method to return, or echo, <i translate="no">message</i>.</p>
<p>We use the <a href="./qtplugin.htm#Q_DECLARE_INTERFACE" translate="no">Q_DECLARE_INTERFACE</a> macro to let <a href="./metaobjects.htm" translate="no">Qt's meta object system</a> aware of the interface. We do this so that it will be possible to identify plugins that implements the interface at run-time. The second argument is a string that must identify the interface in a unique way.</p>
<a name="echoplugin-class-definition"></a>
<h4 id="echoplugin-class-definition">EchoPlugin Class Definition<a class="plink" href="#echoplugin-class-definition" title="Direct link to this headline"></a></h4>
<p>We inherit both <a href="./qobject.htm" translate="no">QObject</a> and <code translate="no">EchoInterface</code> to make this class a plugin. The <a href="./qobject.htm#Q_INTERFACES" translate="no">Q_INTERFACES</a> macro tells Qt which interfaces the class implements. In our case we only implement the <code translate="no">EchoInterface</code>. If a class implements more than one interface, they are given as a space separated list. The <a href="./qtplugin.htm#Q_PLUGIN_METADATA" translate="no">Q_PLUGIN_METADATA</a> macro is included next to the <a href="./qobject.htm#Q_OBJECT" translate="no">Q_OBJECT</a> macro. It contains the plugins IID and a filename pointing to a json file containing the metadata for the plugin. The json file is compiled into the plugin and does not need to be installed.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">class</span> EchoPlugin : <span class="keyword">public</span> <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">,</span> EchoInterface
{
    Q_OBJECT
    Q_PLUGIN_METADATA(IID <span class="string">"org.qt-project.Qt.Examples.EchoInterface"</span> FILE <span class="string">"echoplugin.json"</span>)
    Q_INTERFACES(EchoInterface)

<span class="keyword">public</span>:
    <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> echo(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>message) override;
};</pre></div>
<a name="echoplugin-class-implementation"></a>
<h4 id="echoplugin-class-implementation">EchoPlugin Class Implementation<a class="plink" href="#echoplugin-class-implementation" title="Direct link to this headline"></a></h4>
<p>Here is the implementation of <code translate="no">echo()</code>:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type"><a href="./qstring.htm" translate="no">QString</a></span> EchoPlugin<span class="operator">::</span>echo(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>message)
{
    <span class="keyword">return</span> message;
}</pre></div>
<p>We simply return the functions parameter.</p>
<a name="the-main-function"></a>
<h4 id="the-main-function">The <code translate="no">main()</code> function<a class="plink" href="#the-main-function" title="Direct link to this headline"></a></h4>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">int</span> main(<span class="type">int</span> argv<span class="operator">,</span> <span class="type">char</span> <span class="operator">*</span>args<span class="operator">[</span><span class="operator">]</span>)
{
    <span class="type"><a href="./qapplication.htm" translate="no">QApplication</a></span> app(argv<span class="operator">,</span> args);

    EchoWindow window;
    window<span class="operator">.</span>show();

    <span class="keyword">return</span> app<span class="operator">.</span>exec();
}</pre></div>
<p>We create an <code translate="no">EchoWindow</code> and display it as a top-level window.</p>
<a name="the-profiles"></a>
<h4 id="the-profiles">The Profiles<a class="plink" href="#the-profiles" title="Direct link to this headline"></a></h4>
<p>When creating plugins the profiles need to be adjusted. We show here what changes need to be done.</p>
<p>The profile in the echoplugin directory uses the <code translate="no">subdirs</code> template and simply includes includes to directories in which the echo window and echo plugin lives:</p>
<div class="pre"><pre class="cpp" translate="no">TEMPLATE    = subdirs
SUBDIRS     = echowindow \
              plugin</pre></div>
<p>The profile for the echo window does not need any plugin specific settings. We move on to the plugin profile:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">TEMPLATE        = lib
CONFIG         += plugin
QT             += widgets
INCLUDEPATH    += ../echowindow
HEADERS         = echoplugin.h
SOURCES         = echoplugin.cpp
TARGET          = $$qtLibraryTarget(echoplugin)
DESTDIR         = ../plugins</pre></div>
<p>We need to set the TEMPLATE as we now want to make a library instead of an executable. We also need to tell qmake that we are creating a plugin. The <code translate="no">EchoInterface</code> that the plugin implements lives in the <code translate="no">echowindow</code> directory, so we need to add that directory to the include path. We set the TARGET of the project, which is the name of the library file in which the plugin will be stored; qmake appends the appropriate file extension depending on the platform. By convention the target should have the same name as the plugin (set with Q_EXPORT_PLUGIN2)</p>
<a name="further-reading-and-examples"></a>
<h4 id="further-reading-and-examples">Further Reading and Examples<a class="plink" href="#further-reading-and-examples" title="Direct link to this headline"></a></h4>
<p>The <a href="./qtplugin.htm" translate="no">Defining Plugins</a> page presents an overview of the macros needed to create plugins.</p>
<p>We give an example of a plugin that extends Qt in the <a href="./qtwidgets-tools-styleplugin-example.htm" translate="no">style plugin</a> example. The <a href="./qtwidgets-tools-plugandpaint-app-example.htm" translate="no">plug and paint</a> example shows how to create static plugins.</p>
<p><a href="https://code.qt.io/cgit/qt/qtbase.git/tree/examples/widgets/tools/echoplugin?h=5.15" translate="no">Example project @ code.qt.io</a></p>
</div>
<!-- @@@tools/echoplugin -->
</div>
<p class="copy-notice">
<acronym title="Copyright">Â©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>