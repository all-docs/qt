<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Example 1: Direct Connection using a Static Source | Qt Remote Objects</title>
<link rel="canonical" href="https://doc.qt.io/qt-6/remoteobjects-example-static-source.html">
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="./index.htm" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtremoteobjects-index.htm" translate="no">Qt Remote Objects</a></li>
                            <li><a>Example 1: Direct Connection using a Static Source</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">Example 1: Direct Connection using a Static Source</h1>
<span class="subtitle"></span>
<!-- $$$remoteobjects-example-static-source-description -->
<div class="descr"> <a name="details"></a>
<ol class="1" type="1"><li><b>Create a source object</b><p>To create this <a href="./qtremoteobjects-source.htm#source" translate="no">Source</a> object, first we create the definition file, <code translate="no">simpleswitch.rep</code>. This file describes the properties and methods for the object and is input to the Qt Remote Objects Compiler <a href="./qtremoteobjects-repc.htm" translate="no">repc</a>. This file only defines interfaces that are necessary to expose to the <a href="./qtremoteobjects-replica.htm#replica" translate="no">Replicas</a>.</p>
<p><code translate="no">simpleswitch.rep</code></p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">class</span> SimpleSwitch
{
    PROP(bool currState<span class="operator">=</span><span class="keyword">false</span>);
    SLOT(server_slot(bool clientState));
};</pre></div>
<p>In <code translate="no">simpleswitch.rep</code>,</p>
<ul>
<li><code translate="no">currState</code> holds the current state of the switch.</li>
<li><code translate="no">server_slot()</code> allows us to interact with the source - it will be connected to the <code translate="no">echoSwitchState(bool newstate)</code> signal.</li>
</ul>
<p>For repc to process this file, add the following line to your <code translate="no">.pro</code> file:</p>
<div class="pre"><pre class="cpp" translate="no">REPC_SOURCE <span class="operator">=</span> simpleswitch<span class="operator">.</span>rep</pre></div>
<p>The <code translate="no">REPC_SOURCE</code> variable is only relevant for the Qt Remote Object module, so you need to add it to your project as well:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">QT       <span class="operator">+</span><span class="operator">=</span> remoteobjects</pre></div>
<p>repc creates the <code translate="no">rep_SimpleSwitch_source.h</code> header in the build directory that you specify. For more information, see <a href="./qtremoteobjects-source.htm#source" translate="no">Source</a>.</p>
<p>repc creates three helper classes for use with QtRO. For this example, we use the basic: <code translate="no">SimpleSwitchSimpleSource</code>. It's an abstract class, defined in <code translate="no">rep_SimpleSwitch_source.h</code>. We derive from it to define our SimpleSwitch implementation class as shown below:</p>
<p><code translate="no">simpleswitch.h</code></p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="preprocessor">#ifndef SIMPLESWITCH_H</span>
<span class="preprocessor">#define SIMPLESWITCH_H</span>

<span class="preprocessor">#include "rep_SimpleSwitch_source.h"</span>

<span class="keyword">class</span> SimpleSwitch : <span class="keyword">public</span> SimpleSwitchSimpleSource
{
    Q_OBJECT
<span class="keyword">public</span>:
    SimpleSwitch(<span class="type"><a href="./qobject.htm" translate="no">QObject</a></span> <span class="operator">*</span>parent <span class="operator">=</span> nullptr);
    <span class="operator">~</span>SimpleSwitch();
    <span class="keyword">virtual</span> <span class="type">void</span> server_slot(bool clientState);
<span class="keyword">public</span> Q_SLOTS:
    <span class="type">void</span> timeout_slot();
<span class="keyword">private</span>:
    <span class="type"><a href="./qtimer.htm" translate="no">QTimer</a></span> <span class="operator">*</span>stateChangeTimer;
};

<span class="preprocessor">#endif</span></pre></div>
<p>In <code translate="no">simpleswitch.h</code>,</p>
<ul>
<li><code translate="no">stateChangeTimer</code> is a <a href="./qtimer.htm" translate="no">QTimer</a> that is used to toggle the state of our SimpleSwitch.</li>
<li><code translate="no">timeout_slot()</code> is connected to <code translate="no">stateChangeTimer</code>'s timeout() signal.</li>
<li><code translate="no">server_slot()</code> -- which is called automatically on the source whenever any replica calls their version of the slot -- outputs the received value.</li>
<li><code translate="no">currStateChanged(bool)</code>, defined in the <a href="./qtremoteobjects-repc.htm" translate="no">repc</a>-generated <code translate="no">rep_SimpleSwitch_source.h</code>, is emitted whenever <code translate="no">currState</code> toggles. In this example, we ignore the signal on the source side, and handle it later on the replica side.</li>
</ul>
<p>The definition of our <code translate="no">SwitchState</code> class is shown below:</p>
<p><code translate="no">simpleswitch.cpp</code></p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="preprocessor">#include "simpleswitch.h"</span>

<span class="comment">// constructor</span>
SimpleSwitch<span class="operator">::</span>SimpleSwitch(<span class="type"><a href="./qobject.htm" translate="no">QObject</a></span> <span class="operator">*</span>parent) : SimpleSwitchSimpleSource(parent)
{
    stateChangeTimer <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qtimer.htm" translate="no">QTimer</a></span>(<span class="keyword">this</span>); <span class="comment">// Initialize timer</span>
    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(stateChangeTimer<span class="operator">,</span> <span class="operator">&amp;</span>SimpleSwitch<span class="operator">::</span>timeout<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>SimpleSwitch<span class="operator">::</span>timeout_slot); <span class="comment">// connect timeout() signal from stateChangeTimer to timeout_slot() of simpleSwitch</span>
    stateChangeTimer<span class="operator">-</span><span class="operator">&gt;</span>start(<span class="number">2000</span>); <span class="comment">// Start timer and set timout to 2 seconds</span>
    <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Source Node Started"</span>;
}

<span class="comment">//destructor</span>
SimpleSwitch<span class="operator">::</span><span class="operator">~</span>SimpleSwitch()
{
    stateChangeTimer<span class="operator">-</span><span class="operator">&gt;</span>stop();
}

<span class="type">void</span> SimpleSwitch<span class="operator">::</span>server_slot(bool clientState)
{
    <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Replica state is "</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> clientState; <span class="comment">// print switch state echoed back by client</span>
}

<span class="type">void</span> SimpleSwitch<span class="operator">::</span>timeout_slot()
{
    <span class="comment">// slot called on timer timeout</span>
    <span class="keyword">if</span> (currState()) <span class="comment">// check if current state is true, currState() is defined in repc generated rep_SimpleSwitch_source.h</span>
        setCurrState(<span class="keyword">false</span>); <span class="comment">// set state to false</span>
    <span class="keyword">else</span>
        setCurrState(<span class="keyword">true</span>); <span class="comment">// set state to true</span>
    <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Source State is "</span><span class="operator">&lt;</span><span class="operator">&lt;</span>currState();

}</pre></div>
</li>
<li><b>Create a registry</b><p>Because this example uses a direct connection between nodes, we can omit this step.</p>
</li>
<li><b>Create a host node</b><p>The host node is created as shown below:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type"><a href="./qremoteobjecthost.htm" translate="no">QRemoteObjectHost</a></span> srcNode(<span class="type"><a href="./qurl.htm" translate="no">QUrl</a></span>(<span class="type"><a href="./qstring.htm#QStringLiteral" translate="no">QStringLiteral</a></span>(<span class="string">"local:switch"</span>)));</pre></div>
</li>
<li><b>Host source object and remoting</b><p>The following statements instantiate the <a href="./qtremoteobjects-source.htm#source" translate="no">Source</a> object and pass it on to the host to enable "remoting", which is the process of making an object visible to the QtRO network:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">SimpleSwitch srcSwitch; <span class="comment">// create simple switch</span>
srcNode<span class="operator">.</span>enableRemoting(<span class="operator">&amp;</span>srcSwitch); <span class="comment">// enable remoting</span></pre></div>
<p>The contents of <code translate="no">main.cpp</code> file that implements the steps described above are as follows:</p>
<p><code translate="no">main.cpp</code></p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="preprocessor">#include &lt;QCoreApplication&gt;</span>
<span class="preprocessor">#include "simpleswitch.h"</span>

<span class="type">int</span> main(<span class="type">int</span> argc<span class="operator">,</span> <span class="type">char</span> <span class="operator">*</span>argv<span class="operator">[</span><span class="operator">]</span>)
{
    <span class="type"><a href="./qcoreapplication.htm" translate="no">QCoreApplication</a></span> a(argc<span class="operator">,</span> argv);

    SimpleSwitch srcSwitch; <span class="comment">// create simple switch</span>

    <span class="type"><a href="./qremoteobjecthost.htm" translate="no">QRemoteObjectHost</a></span> srcNode(<span class="type"><a href="./qurl.htm" translate="no">QUrl</a></span>(<span class="type"><a href="./qstring.htm#QStringLiteral" translate="no">QStringLiteral</a></span>(<span class="string">"local:switch"</span>))); <span class="comment">// create host node without Registry</span>
    srcNode<span class="operator">.</span>enableRemoting(<span class="operator">&amp;</span>srcSwitch); <span class="comment">// enable remoting/sharing</span>

    <span class="keyword">return</span> a<span class="operator">.</span>exec();
}</pre></div>
<p>Compile and run this source-side project. The output, without any replicas created, should look as shown below with the switch state toggling between <code translate="no">true</code> and <code translate="no">false</code> every two seconds.</p>
<p class="centerAlign"><img alt="&quot;Example 1: Server Output&quot;" src="./images/DirectConnectServerOutput.png"></p></li>
</ol>
<p>The subsequent steps are for creating the replica side of the network, which in this example gets the state of switch from the <a href="./qtremoteobjects-source.htm#source" translate="no">Source</a> and echoes it back.</p>
<a name="replica-code"></a>
<h3 id="replica-code">Replica Code<a class="plink" href="#replica-code" title="Direct link to this headline"></a></h3>
<ol class="1" type="1"><li><b>Use repc to add a replica to your project</b><p>We use the same API definition file as we did on the source side, <code translate="no">SimpleSwitch.rep</code>, to create a <a href="./qtremoteobjects-replica.htm#replica" translate="no">Replica</a> header file using the <a href="./qtremoteobjects-repc.htm" translate="no">repc</a>. Include the following line in your client side <code translate="no">.pro</code> file, specifying a <code translate="no">.rep</code> file input:</p>
<div class="pre"><pre class="cpp" translate="no">REPC_REPLICA <span class="operator">=</span> simpleswitch<span class="operator">.</span>rep</pre></div>
<p>The <a href="./qtremoteobjects-repc.htm" translate="no">repc</a> tool generates a <code translate="no">rep_SimpleSwitch_replica.h</code> file in the build directory. For more information, see <a href="./qtremoteobjects-replica.htm#replica" translate="no">Replica</a>.</p>
</li>
<li><b>Create a node to connect with the source's host node</b><p>The following code instantiates the second node on the network and connects it with the source host node:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type"><a href="./qremoteobjectnode.htm" translate="no">QRemoteObjectNode</a></span> repNode; <span class="comment">// create remote object node</span>
repNode<span class="operator">.</span>connectToNode(<span class="type"><a href="./qurl.htm" translate="no">QUrl</a></span>(<span class="type"><a href="./qstring.htm#QStringLiteral" translate="no">QStringLiteral</a></span>(<span class="string">"local:switch"</span>))); <span class="comment">// connect with remote host node</span></pre></div>
</li>
<li><b>Call the node's <a href="./qremoteobjectnode.htm#acquire" translate="no">acquire()</a> to create a pointer to a replica</b><p>First, we instantiate a replica:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type"><a href="./qsharedpointer.htm" translate="no">QSharedPointer</a></span><span class="operator">&lt;</span>SimpleSwitchReplica<span class="operator">&gt;</span> ptr;
ptr<span class="operator">.</span>reset(repNode<span class="operator">.</span>acquire<span class="operator">&lt;</span>SimpleSwitchReplica<span class="operator">&gt;</span>()); <span class="comment">// acquire replica of source from host node</span></pre></div>
<div class="admonition note">
<p><b>Note: </b><a href="./qremoteobjectnode.htm#acquire" translate="no">acquire()</a> returns a pointer to the replica, but doesn't manage its lifetime. This example shows the recommended process of wrapping the returned pointer in a <a href="./qsharedpointer.htm" translate="no">QSharedPointer</a> or <a href="./qscopedpointer.htm" translate="no">QScopedPointer</a> to ensure that the pointer is always deleted properly.</p>
</div>
<p><code translate="no">main.cpp</code> implements the steps described above and instantiates our object:</p>
<p><code translate="no">main.cpp</code></p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="preprocessor">#include &lt;QCoreApplication&gt;</span>
<span class="preprocessor">#include "client.h"</span>

<span class="type">int</span> main(<span class="type">int</span> argc<span class="operator">,</span> <span class="type">char</span> <span class="operator">*</span>argv<span class="operator">[</span><span class="operator">]</span>)
{
    <span class="type"><a href="./qcoreapplication.htm" translate="no">QCoreApplication</a></span> a(argc<span class="operator">,</span> argv);

    <span class="type"><a href="./qsharedpointer.htm" translate="no">QSharedPointer</a></span><span class="operator">&lt;</span>SimpleSwitchReplica<span class="operator">&gt;</span> ptr; <span class="comment">// shared pointer to hold source replica</span>

    <span class="type"><a href="./qremoteobjectnode.htm" translate="no">QRemoteObjectNode</a></span> repNode; <span class="comment">// create remote object node</span>
    repNode<span class="operator">.</span>connectToNode(<span class="type"><a href="./qurl.htm" translate="no">QUrl</a></span>(<span class="type"><a href="./qstring.htm#QStringLiteral" translate="no">QStringLiteral</a></span>(<span class="string">"local:switch"</span>))); <span class="comment">// connect with remote host node</span>

    ptr<span class="operator">.</span>reset(repNode<span class="operator">.</span>acquire<span class="operator">&lt;</span>SimpleSwitchReplica<span class="operator">&gt;</span>()); <span class="comment">// acquire replica of source from host node</span>

    Client rswitch(ptr); <span class="comment">// create client switch object and pass reference of replica to it</span>

    <span class="keyword">return</span> a<span class="operator">.</span>exec();
}</pre></div>
<p>The complete declaration and definition for the <code translate="no">Client</code> class is as follows:</p>
<p><code translate="no">client.h</code></p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="preprocessor">#ifndef _CLIENT_H</span>
<span class="preprocessor">#define _CLIENT_H</span>

<span class="preprocessor">#include &lt;QObject&gt;</span>
<span class="preprocessor">#include &lt;QSharedPointer&gt;</span>

<span class="preprocessor">#include "rep_SimpleSwitch_replica.h"</span>

<span class="keyword">class</span> Client : <span class="keyword">public</span> <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span>
{
    Q_OBJECT
<span class="keyword">public</span>:
    Client(<span class="type"><a href="./qsharedpointer.htm" translate="no">QSharedPointer</a></span><span class="operator">&lt;</span>SimpleSwitchReplica<span class="operator">&gt;</span> ptr);
    <span class="operator">~</span>Client();
    <span class="type">void</span> initConnections();<span class="comment">// Function to connect signals and slots of source and client</span>

Q_SIGNALS:
    <span class="type">void</span> echoSwitchState(bool switchState);<span class="comment">// this signal is connected with server_slot(..) on the source object and echoes back switch state received from source</span>

<span class="keyword">public</span> Q_SLOTS:
    <span class="type">void</span> recSwitchState_slot(); <span class="comment">// slot to receive source state</span>
<span class="keyword">private</span>:
    bool clientSwitchState; <span class="comment">// holds received server switch state</span>
    <span class="type"><a href="./qsharedpointer.htm" translate="no">QSharedPointer</a></span><span class="operator">&lt;</span>SimpleSwitchReplica<span class="operator">&gt;</span> reptr;<span class="comment">// holds reference to replica</span>

 };

<span class="preprocessor">#endif</span></pre></div>
<p><code translate="no">client.cpp</code></p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="preprocessor">#include "client.h"</span>

<span class="comment">// constructor</span>
Client<span class="operator">::</span>Client(<span class="type"><a href="./qsharedpointer.htm" translate="no">QSharedPointer</a></span><span class="operator">&lt;</span>SimpleSwitchReplica<span class="operator">&gt;</span> ptr) :
    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span>(nullptr)<span class="operator">,</span>reptr(ptr)
{
    initConnections();
    <span class="comment">//We can connect to SimpleSwitchReplica Signals/Slots</span>
    <span class="comment">//directly because our Replica was generated by repc.</span>
}

<span class="comment">//destructor</span>
Client<span class="operator">::</span><span class="operator">~</span>Client()
{
}

<span class="type">void</span> Client<span class="operator">::</span>initConnections()
{
    <span class="comment">// initialize connections between signals and slots</span>

    <span class="comment">// connect source replica signal currStateChanged() with client's recSwitchState() slot to receive source's current state</span>
    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(reptr<span class="operator">.</span>data()<span class="operator">,</span> <span class="operator">&amp;</span>SimpleSwitchReplica<span class="operator">::</span>currStateChanged<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>Client<span class="operator">::</span>recSwitchState_slot);
    <span class="comment">// connect client's echoSwitchState(..) signal with replica's server_slot(..) to echo back received state</span>
    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>Client<span class="operator">::</span>echoSwitchState<span class="operator">,</span> reptr<span class="operator">.</span>data()<span class="operator">,</span> <span class="operator">&amp;</span>SimpleSwitchReplica<span class="operator">::</span>server_slot);
}

<span class="type">void</span> Client<span class="operator">::</span>recSwitchState_slot()
{
    <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Received source state "</span><span class="operator">&lt;</span><span class="operator">&lt;</span>reptr<span class="operator">.</span>data()<span class="operator">-</span><span class="operator">&gt;</span>currState();
    clientSwitchState <span class="operator">=</span> reptr<span class="operator">.</span>data()<span class="operator">-</span><span class="operator">&gt;</span>currState();
    Q_EMIT echoSwitchState(clientSwitchState); <span class="comment">// Emit signal to echo received state back to server</span>
}</pre></div>
<p>Compiling and running this example together with the source-side example generates the following output:</p>
<p class="centerAlign"><img alt="&quot;Direct Connect Server Client Communication output&quot;" src="./images/DirectConnectClientServerOutput.png"></p></li>
</ol>
</div>
<!-- @@@remoteobjects-example-static-source -->
</div>
<p class="copy-notice">
<acronym title="Copyright">Â©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>