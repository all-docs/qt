<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Part 6 - Loading and Saving | Qt Widgets</title>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="./index.htm" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtwidgets-index.htm" translate="no">Qt Widgets</a></li>
                            <li><a>Part 6 - Loading and Saving</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">Part 6 - Loading and Saving</h1>
<span class="subtitle"></span>
<!-- $$$tutorials/addressbook/part6-brief -->
<p>Describes how to add save and load functionality.</p>
<!-- @@@tutorials/addressbook/part6 -->
<!-- $$$tutorials/addressbook/part6-description -->
<div class="descr"> <a name="details"></a>
<p>This part covers the Qt file handling features we use to write loading and saving routines for the address book.</p>
<p class="centerAlign"><img alt="" src="./images/addressbook-tutorial-part6-screenshot.png"></p><p>Although browsing and searching the contact list are useful features, our address book is not complete until we can save existing contacts and load them again at a later time.</p>
<p>Qt provides a number of classes for <a href="./io.htm" translate="no">input and output</a>, but we have chosen to use two which are simple to use in combination: <a href="./qfile.htm" translate="no">QFile</a> and <a href="./qdatastream.htm" translate="no">QDataStream</a>.</p>
<p>A <a href="./qfile.htm" translate="no">QFile</a> object represents a file on disk that can be read from and written to. <a href="./qfile.htm" translate="no">QFile</a> is a subclass of the more general <a href="./qiodevice.htm" translate="no">QIODevice</a> class which represents many different kinds of devices.</p>
<p>A <a href="./qdatastream.htm" translate="no">QDataStream</a> object is used to serialize binary data so that it can be stored in a <a href="./qiodevice.htm" translate="no">QIODevice</a> and retrieved again later. Reading from a <a href="./qiodevice.htm" translate="no">QIODevice</a> and writing to it is as simple as opening the stream - with the respective device as a parameter - and reading from or writing to it.</p>
<a name="defining-the-addressbook-class"></a>
<h4 id="defining-the-addressbook-class">Defining the AddressBook Class<a class="plink" href="#defining-the-addressbook-class" title="Direct link to this headline"></a></h4>
<p>We declare two public slots, <code translate="no">saveToFile()</code> and <code translate="no">loadFromFile()</code>, as well as two <a href="./qpushbutton.htm" translate="no">QPushButton</a> objects, <code translate="no">loadButton</code> and <code translate="no">saveButton</code>.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    <span class="type">void</span> saveToFile();
    <span class="type">void</span> loadFromFile();
    ...
    <span class="type"><a href="./qpushbutton.htm" translate="no">QPushButton</a></span> <span class="operator">*</span>loadButton;
    <span class="type"><a href="./qpushbutton.htm" translate="no">QPushButton</a></span> <span class="operator">*</span>saveButton;</pre></div>
<a name="implementing-the-addressbook-class"></a>
<h4 id="implementing-the-addressbook-class">Implementing the AddressBook Class<a class="plink" href="#implementing-the-addressbook-class" title="Direct link to this headline"></a></h4>
<p>In our constructor, we instantiate <code translate="no">loadButton</code> and <code translate="no">saveButton</code>. Ideally, it would be more user-friendly to set the push buttons' labels to "Load contacts from a file" and "Save contacts to a file". However, due to the size of our other push buttons, we set the labels to <b translate="no">Load...</b> and <b translate="no">Save...</b>. Fortunately, Qt provides a simple way to set tooltips with <a href="./qwidget.htm#toolTip-prop" translate="no">setToolTip()</a> and we use it in the following way for our push buttons:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    loadButton<span class="operator">-</span><span class="operator">&gt;</span>setToolTip(tr(<span class="string">"Load contacts from a file"</span>));
    ...
    saveButton<span class="operator">-</span><span class="operator">&gt;</span>setToolTip(tr(<span class="string">"Save contacts to a file"</span>));</pre></div>
<p>Although it is not shown here, just like the other features we implemented, we add the push buttons to the layout panel on the right, <code translate="no">buttonLayout1</code>, and we connect the push buttons' <a href="./qabstractbutton.htm#clicked" translate="no">clicked()</a> signals to their respective slots.</p>
<p>For the saving feature, we first obtain <code translate="no">fileName</code> using <a href="./qfiledialog.htm#getSaveFileName" translate="no">QFileDialog::getSaveFileName</a>(). This is a convenience function provided by <a href="./qfiledialog.htm" translate="no">QFileDialog</a>, which pops up a modal file dialog and allows the user to enter a file name or select any existing <code translate="no">.abk</code> file. The <code translate="no">.abk</code> file is our Address Book extension that we create when we save contacts.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> AddressBook<span class="operator">::</span>saveToFile()
{
    <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> fileName <span class="operator">=</span> <span class="type"><a href="./qfiledialog.htm" translate="no">QFileDialog</a></span><span class="operator">::</span>getSaveFileName(<span class="keyword">this</span><span class="operator">,</span>
        tr(<span class="string">"Save Address Book"</span>)<span class="operator">,</span> <span class="string">""</span><span class="operator">,</span>
        tr(<span class="string">"Address Book (*.abk);;All Files (*)"</span>));</pre></div>
<p>The file dialog that pops up is displayed in the screenshot below:</p>
<p class="centerAlign"><img alt="" src="./images/addressbook-tutorial-part6-save.png"></p><p>If <code translate="no">fileName</code> is not empty, we create a <a href="./qfile.htm" translate="no">QFile</a> object, <code translate="no">file</code>, with <code translate="no">fileName</code>. <a href="./qfile.htm" translate="no">QFile</a> works with <a href="./qdatastream.htm" translate="no">QDataStream</a> as <a href="./qfile.htm" translate="no">QFile</a> is a <a href="./qiodevice.htm" translate="no">QIODevice</a>.</p>
<p>Next, we attempt to open the file in <a href="./qiodevice.htm#OpenModeFlag-enum" translate="no">WriteOnly</a> mode. If this is unsuccessful, we display a <a href="./qmessagebox.htm" translate="no">QMessageBox</a> to inform the user.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    <span class="keyword">if</span> (fileName<span class="operator">.</span>isEmpty())
        <span class="keyword">return</span>;
    <span class="keyword">else</span> {
        <span class="type"><a href="./qfile.htm" translate="no">QFile</a></span> file(fileName);
        <span class="keyword">if</span> (<span class="operator">!</span>file<span class="operator">.</span>open(<span class="type"><a href="./qiodevice.htm" translate="no">QIODevice</a></span><span class="operator">::</span>WriteOnly)) {
            <span class="type"><a href="./qmessagebox.htm" translate="no">QMessageBox</a></span><span class="operator">::</span>information(<span class="keyword">this</span><span class="operator">,</span> tr(<span class="string">"Unable to open file"</span>)<span class="operator">,</span>
                file<span class="operator">.</span>errorString());
            <span class="keyword">return</span>;
        }</pre></div>
<p>Otherwise, we instantiate a <a href="./qdatastream.htm" translate="no">QDataStream</a> object, <code translate="no">out</code>, to write the open file. <a href="./qdatastream.htm" translate="no">QDataStream</a> requires that the same version of the stream is used for reading and writing. We ensure that this is the case by setting the version used to the <a href="./qdatastream.htm#Version-enum" translate="no">version introduced with Qt 4.5</a> before serializing the data to <code translate="no">file</code>.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">        <span class="type"><a href="./qdatastream.htm" translate="no">QDataStream</a></span> out(<span class="operator">&amp;</span>file);
        out<span class="operator">.</span>setVersion(<span class="type"><a href="./qdatastream.htm" translate="no">QDataStream</a></span><span class="operator">::</span>Qt_4_5);
        out <span class="operator">&lt;</span><span class="operator">&lt;</span> contacts;
    }
}</pre></div>
<p>For the loading feature, we also obtain <code translate="no">fileName</code> using <a href="./qfiledialog.htm#getOpenFileName" translate="no">QFileDialog::getOpenFileName</a>(). This function, the counterpart to <a href="./qfiledialog.htm#getSaveFileName" translate="no">QFileDialog::getSaveFileName</a>(), also pops up the modal file dialog and allows the user to enter a file name or select any existing <code translate="no">.abk</code> file to load it into the address book.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> AddressBook<span class="operator">::</span>loadFromFile()
{
    <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> fileName <span class="operator">=</span> <span class="type"><a href="./qfiledialog.htm" translate="no">QFileDialog</a></span><span class="operator">::</span>getOpenFileName(<span class="keyword">this</span><span class="operator">,</span>
        tr(<span class="string">"Open Address Book"</span>)<span class="operator">,</span> <span class="string">""</span><span class="operator">,</span>
        tr(<span class="string">"Address Book (*.abk);;All Files (*)"</span>));</pre></div>
<p>On Windows, for example, this function pops up a native file dialog, as shown in the following screenshot.</p>
<p class="centerAlign"><img alt="" src="./images/addressbook-tutorial-part6-load.png"></p><p>If <code translate="no">fileName</code> is not empty, again, we use a <a href="./qfile.htm" translate="no">QFile</a> object, <code translate="no">file</code>, and attempt to open it in <a href="./qiodevice.htm#OpenModeFlag-enum" translate="no">ReadOnly</a> mode. Similar to our implementation of <code translate="no">saveToFile()</code>, if this attempt is unsuccessful, we display a <a href="./qmessagebox.htm" translate="no">QMessageBox</a> to inform the user.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    <span class="keyword">if</span> (fileName<span class="operator">.</span>isEmpty())
        <span class="keyword">return</span>;
    <span class="keyword">else</span> {

        <span class="type"><a href="./qfile.htm" translate="no">QFile</a></span> file(fileName);

        <span class="keyword">if</span> (<span class="operator">!</span>file<span class="operator">.</span>open(<span class="type"><a href="./qiodevice.htm" translate="no">QIODevice</a></span><span class="operator">::</span>ReadOnly)) {
            <span class="type"><a href="./qmessagebox.htm" translate="no">QMessageBox</a></span><span class="operator">::</span>information(<span class="keyword">this</span><span class="operator">,</span> tr(<span class="string">"Unable to open file"</span>)<span class="operator">,</span>
                file<span class="operator">.</span>errorString());
            <span class="keyword">return</span>;
        }

        <span class="type"><a href="./qdatastream.htm" translate="no">QDataStream</a></span> in(<span class="operator">&amp;</span>file);
        in<span class="operator">.</span>setVersion(<span class="type"><a href="./qdatastream.htm" translate="no">QDataStream</a></span><span class="operator">::</span>Qt_4_5);
        contacts<span class="operator">.</span>clear();   <span class="comment">// clear existing contacts</span>
        in <span class="operator">&gt;</span><span class="operator">&gt;</span> contacts;</pre></div>
<p>Otherwise, we instantiate a <a href="./qdatastream.htm" translate="no">QDataStream</a> object, <code translate="no">in</code>, set its version as above and read the serialized data into the <code translate="no">contacts</code> data structure. The <code translate="no">contacts</code> object is emptied before data is read into it to simplify the file reading process. A more advanced method would be to read the contacts into a temporary <a href="./qmap.htm" translate="no">QMap</a> object, and copy over non-duplicate contacts into <code translate="no">contacts</code>.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">        <span class="keyword">if</span> (contacts<span class="operator">.</span>isEmpty()) {
            <span class="type"><a href="./qmessagebox.htm" translate="no">QMessageBox</a></span><span class="operator">::</span>information(<span class="keyword">this</span><span class="operator">,</span> tr(<span class="string">"No contacts in file"</span>)<span class="operator">,</span>
                tr(<span class="string">"The file you are attempting to open contains no contacts."</span>));
        } <span class="keyword">else</span> {
            <span class="type"><a href="./qmap.htm" translate="no">QMap</a></span><span class="operator">&lt;</span><span class="type"><a href="./qstring.htm" translate="no">QString</a></span><span class="operator">,</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span><span class="operator">&gt;</span><span class="operator">::</span>iterator i <span class="operator">=</span> contacts<span class="operator">.</span>begin();
            nameLine<span class="operator">-</span><span class="operator">&gt;</span>setText(i<span class="operator">.</span>key());
            addressText<span class="operator">-</span><span class="operator">&gt;</span>setText(i<span class="operator">.</span>value());
        }
    }

    updateInterface(NavigationMode);
}</pre></div>
<p>To display the contacts that have been read from the file, we must first validate the data obtained to ensure that the file we read from actually contains address book contacts. If it does, we display the first contact; otherwise, we display a <a href="./qmessagebox.htm" translate="no">QMessageBox</a> to inform the user about the problem. Lastly, we update the interface to enable and disable the push buttons accordingly.</p>
<p><a href="https://code.qt.io/cgit/qt/qtbase.git/tree/examples/widgets/tutorials/addressbook/part6?h=5.15" translate="no">Example project @ code.qt.io</a></p>
</div>
<!-- @@@tutorials/addressbook/part6 -->
</div>
<p class="copy-notice">
<acronym title="Copyright">Â©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>