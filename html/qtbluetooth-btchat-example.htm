<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bluetooth Chat Example | Qt Bluetooth</title>
<link rel="canonical" href="https://doc.qt.io/qt-6/qtbluetooth-btchat-example.html">
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="./index.htm" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtbluetooth-index.htm" translate="no">Qt Bluetooth</a></li>
                            <li><a>Bluetooth Chat Example</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">Bluetooth Chat Example</h1>
<span class="subtitle"></span>
<!-- $$$btchat-brief -->
<p>An example showing communication through Bluetooth.</p>
<!-- @@@btchat -->
<!-- $$$btchat-description -->
<div class="descr"> <a name="details"></a>
<p>The Bluetooth Chat example shows how to use the <a href="./qtbluetooth-index.htm" translate="no">Qt Bluetooth</a> API to communicate with another application on a remote device using Bluetooth.</p>
<p class="centerAlign"><img alt="" src="./images/btchat-example.png"></p><p>The Bluetooth Chat example implements a simple chat program between multiple parties. The application always acts as both a server and a client eliminating the need to determine who should connect to whom.</p>
<a name="running-the-example"></a>
<h4 id="running-the-example">Running the Example<a class="plink" href="#running-the-example" title="Direct link to this headline"></a></h4>
<p>To run the example from <a href="https://doc.qt.io/qtcreator/index.html" translate="no">Qt Creator</a>, open the <b>Welcome</b> mode and select the example from <b>Examples</b>. For more information, visit <a href="https://doc.qt.io/qtcreator/creator-build-example-application.html" translate="no">Building and Running an Example</a>.</p>
<a name="chat-server"></a>
<h4 id="chat-server">Chat Server<a class="plink" href="#chat-server" title="Direct link to this headline"></a></h4>
<p>The chat server is implemented by the ChatServer class. The ChatServer class is declared as:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">class</span> ChatServer : <span class="keyword">public</span> <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span>
{
    Q_OBJECT

<span class="keyword">public</span>:
    <span class="keyword">explicit</span> ChatServer(<span class="type"><a href="./qobject.htm" translate="no">QObject</a></span> <span class="operator">*</span>parent <span class="operator">=</span> nullptr);
    <span class="operator">~</span>ChatServer();

    <span class="type">void</span> startServer(<span class="keyword">const</span> <span class="type"><a href="./qbluetoothaddress.htm" translate="no">QBluetoothAddress</a></span> <span class="operator">&amp;</span>localAdapter <span class="operator">=</span> <span class="type"><a href="./qbluetoothaddress.htm" translate="no">QBluetoothAddress</a></span>());
    <span class="type">void</span> stopServer();

<span class="keyword">public</span> <span class="keyword">slots</span>:
    <span class="type">void</span> sendMessage(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>message);

<span class="keyword">signals</span>:
    <span class="type">void</span> messageReceived(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>sender<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>message);
    <span class="type">void</span> clientConnected(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>name);
    <span class="type">void</span> clientDisconnected(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>name);

<span class="keyword">private</span> <span class="keyword">slots</span>:
    <span class="type">void</span> clientConnected();
    <span class="type">void</span> clientDisconnected();
    <span class="type">void</span> readSocket();

<span class="keyword">private</span>:
    <span class="type"><a href="./qbluetoothserver.htm" translate="no">QBluetoothServer</a></span> <span class="operator">*</span>rfcommServer <span class="operator">=</span> nullptr;
    <span class="type"><a href="./qbluetoothserviceinfo.htm" translate="no">QBluetoothServiceInfo</a></span> serviceInfo;
    <span class="type"><a href="./qlist.htm" translate="no">QList</a></span><span class="operator">&lt;</span><span class="type"><a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a></span> <span class="operator">*</span><span class="operator">&gt;</span> clientSockets;
};</pre></div>
<p>The first thing the chat server needs to do is create an instance of QRfcommServer to listen for incoming Bluetooth connections. Our clientConnected() slot will be called whenever a new connection is created.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">rfcommServer <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qbluetoothserver.htm" translate="no">QBluetoothServer</a></span>(<span class="type"><a href="./qbluetoothserviceinfo.htm" translate="no">QBluetoothServiceInfo</a></span><span class="operator">::</span>RfcommProtocol<span class="operator">,</span> <span class="keyword">this</span>);
connect(rfcommServer<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qbluetoothserver.htm" translate="no">QBluetoothServer</a></span><span class="operator">::</span>newConnection<span class="operator">,</span>
        <span class="keyword">this</span><span class="operator">,</span> <span class="type">QOverload</span><span class="operator">&lt;</span><span class="operator">&gt;</span><span class="operator">::</span>of(<span class="operator">&amp;</span>ChatServer<span class="operator">::</span>clientConnected));
bool result <span class="operator">=</span> rfcommServer<span class="operator">-</span><span class="operator">&gt;</span>listen(localAdapter);
<span class="keyword">if</span> (<span class="operator">!</span>result) {
    <a href="./qtglobal.htm#qWarning" translate="no">qWarning</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Cannot bind chat server to"</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> localAdapter<span class="operator">.</span>toString();
    <span class="keyword">return</span>;
}</pre></div>
<p>The chat server is only useful if others know that it is there. To enable other devices to discover it, a record describing the service needs to be published in the systems SDP (Service Discovery Protocol) database. The <a href="./qbluetoothserviceinfo.htm" translate="no">QBluetoothServiceInfo</a> class encapsulates a service record.</p>
<p>We will publish a service record that contains some textural descriptions of the services, a UUID that uniquely identifies the service, the discoverability attribute, and connection parameters.</p>
<p>The textural description of the service is stored in the ServiceName, ServiceDescription, and ServiceProvider attributes.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">serviceInfo<span class="operator">.</span>setAttribute(<span class="type"><a href="./qbluetoothserviceinfo.htm" translate="no">QBluetoothServiceInfo</a></span><span class="operator">::</span>ServiceName<span class="operator">,</span> tr(<span class="string">"Bt Chat Server"</span>));
serviceInfo<span class="operator">.</span>setAttribute(<span class="type"><a href="./qbluetoothserviceinfo.htm" translate="no">QBluetoothServiceInfo</a></span><span class="operator">::</span>ServiceDescription<span class="operator">,</span>
                         tr(<span class="string">"Example bluetooth chat server"</span>));
serviceInfo<span class="operator">.</span>setAttribute(<span class="type"><a href="./qbluetoothserviceinfo.htm" translate="no">QBluetoothServiceInfo</a></span><span class="operator">::</span>ServiceProvider<span class="operator">,</span> tr(<span class="string">"qt-project.org"</span>));</pre></div>
<p>Bluetooth uses UUIDs as unique identifiers. The chat service uses a randomly generated UUID.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">static</span> <span class="keyword">const</span> QLatin1String serviceUuid(<span class="string">"e8e10f95-1a70-4b27-9ccf-02010264e9c8"</span>);
serviceInfo<span class="operator">.</span>setServiceUuid(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span>(serviceUuid));</pre></div>
<p>A Bluetooth service is only discoverable if it is in the PublicBrowseGroup.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type"><a href="./qbluetoothserviceinfo.htm" translate="no">QBluetoothServiceInfo</a></span><span class="operator">::</span>Sequence publicBrowse;
publicBrowse <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span><span class="operator">::</span>fromValue(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span>(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span><span class="operator">::</span>PublicBrowseGroup));
serviceInfo<span class="operator">.</span>setAttribute(<span class="type"><a href="./qbluetoothserviceinfo.htm" translate="no">QBluetoothServiceInfo</a></span><span class="operator">::</span>BrowseGroupList<span class="operator">,</span>
                         publicBrowse);</pre></div>
<p>The ProtocolDescriptorList attribute is used to publish the connection parameters that the remote device requires to connect to our service. Here we specify that the Rfcomm protocol is used and set the port number to the port that our rfcommServer instance is listening to.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type"><a href="./qbluetoothserviceinfo.htm" translate="no">QBluetoothServiceInfo</a></span><span class="operator">::</span>Sequence protocolDescriptorList;
<span class="type"><a href="./qbluetoothserviceinfo.htm" translate="no">QBluetoothServiceInfo</a></span><span class="operator">::</span>Sequence protocol;
protocol <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span><span class="operator">::</span>fromValue(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span>(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span><span class="operator">::</span>L2cap));
protocolDescriptorList<span class="operator">.</span>append(<span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span><span class="operator">::</span>fromValue(protocol));
protocol<span class="operator">.</span>clear();
protocol <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span><span class="operator">::</span>fromValue(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span>(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span><span class="operator">::</span>Rfcomm))
         <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span><span class="operator">::</span>fromValue(<span class="type"><a href="./qtglobal.htm#quint8-typedef" translate="no">quint8</a></span>(rfcommServer<span class="operator">-</span><span class="operator">&gt;</span>serverPort()));
protocolDescriptorList<span class="operator">.</span>append(<span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span><span class="operator">::</span>fromValue(protocol));
serviceInfo<span class="operator">.</span>setAttribute(<span class="type"><a href="./qbluetoothserviceinfo.htm" translate="no">QBluetoothServiceInfo</a></span><span class="operator">::</span>ProtocolDescriptorList<span class="operator">,</span>
                         protocolDescriptorList);</pre></div>
<p>Finally, we register the service record with the system.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">serviceInfo<span class="operator">.</span>registerService(localAdapter);</pre></div>
<p>As mentioned earlier, incoming connections are handled in the clientConnected() slot where pending connections are connected to the readyRead() and disconnected() signals. The signals notify others that a new client has connected.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> ChatServer<span class="operator">::</span>clientConnected()
{
    <span class="type"><a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a></span> <span class="operator">*</span>socket <span class="operator">=</span> rfcommServer<span class="operator">-</span><span class="operator">&gt;</span>nextPendingConnection();
    <span class="keyword">if</span> (<span class="operator">!</span>socket)
        <span class="keyword">return</span>;

    connect(socket<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a></span><span class="operator">::</span>readyRead<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>ChatServer<span class="operator">::</span>readSocket);
    connect(socket<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a></span><span class="operator">::</span>disconnected<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="type">QOverload</span><span class="operator">&lt;</span><span class="operator">&gt;</span><span class="operator">::</span>of(<span class="operator">&amp;</span>ChatServer<span class="operator">::</span>clientDisconnected));
    clientSockets<span class="operator">.</span>append(socket);
    <span class="keyword">emit</span> clientConnected(socket<span class="operator">-</span><span class="operator">&gt;</span>peerName());
}</pre></div>
<p>The readSocket() slot is called whenever data is ready to be read from a client socket. The slot reads individual lines from the socket, converts them from UTF-8, and emits the messageReceived() signal.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> ChatServer<span class="operator">::</span>readSocket()
{
    <span class="type"><a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a></span> <span class="operator">*</span>socket <span class="operator">=</span> qobject_cast<span class="operator">&lt;</span><span class="type"><a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a></span> <span class="operator">*</span><span class="operator">&gt;</span>(sender());
    <span class="keyword">if</span> (<span class="operator">!</span>socket)
        <span class="keyword">return</span>;

    <span class="keyword">while</span> (socket<span class="operator">-</span><span class="operator">&gt;</span>canReadLine()) {
        <span class="type"><a href="./qbytearray.htm" translate="no">QByteArray</a></span> line <span class="operator">=</span> socket<span class="operator">-</span><span class="operator">&gt;</span>readLine()<span class="operator">.</span>trimmed();
        <span class="keyword">emit</span> messageReceived(socket<span class="operator">-</span><span class="operator">&gt;</span>peerName()<span class="operator">,</span>
                             <span class="type"><a href="./qstring.htm" translate="no">QString</a></span><span class="operator">::</span>fromUtf8(line<span class="operator">.</span>constData()<span class="operator">,</span> line<span class="operator">.</span>length()));
    }
}</pre></div>
<p>The clientDisconnected() slot is called whenever a client disconnects from the service. The slot emits a signal to notify others that a client has disconnected, and deletes the socket.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> ChatServer<span class="operator">::</span>clientDisconnected()
{
    <span class="type"><a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a></span> <span class="operator">*</span>socket <span class="operator">=</span> qobject_cast<span class="operator">&lt;</span><span class="type"><a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a></span> <span class="operator">*</span><span class="operator">&gt;</span>(sender());
    <span class="keyword">if</span> (<span class="operator">!</span>socket)
        <span class="keyword">return</span>;

    <span class="keyword">emit</span> clientDisconnected(socket<span class="operator">-</span><span class="operator">&gt;</span>peerName());

    clientSockets<span class="operator">.</span>removeOne(socket);

    socket<span class="operator">-</span><span class="operator">&gt;</span>deleteLater();
}</pre></div>
<p>The sendMessage() slot is used to send a message to all connected clients. The message is converted into UTF-8 and appended with a newline before being sent to all clients.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> ChatServer<span class="operator">::</span>sendMessage(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>message)
{
    <span class="type"><a href="./qbytearray.htm" translate="no">QByteArray</a></span> text <span class="operator">=</span> message<span class="operator">.</span>toUtf8() <span class="operator">+</span> <span class="char">'\n'</span>;

    <span class="keyword">for</span> (<span class="type"><a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a></span> <span class="operator">*</span>socket : qAsConst(clientSockets))
        socket<span class="operator">-</span><span class="operator">&gt;</span>write(text);
}</pre></div>
<p>When the chat server is stopped the service record is removed from the system SDP database, all connected client sockets are deleted, and the QRfcommServer instance is deleted.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> ChatServer<span class="operator">::</span>stopServer()
{
    <span class="comment">// Unregister service</span>
    serviceInfo<span class="operator">.</span>unregisterService();

    <span class="comment">// Close sockets</span>
    <a href="./qtalgorithms.htm#qDeleteAll" translate="no">qDeleteAll</a>(clientSockets);

    <span class="comment">// Close server</span>
    <span class="keyword">delete</span> rfcommServer;
    rfcommServer <span class="operator">=</span> nullptr;
}</pre></div>
<a name="chat-client"></a>
<h4 id="chat-client">Chat Client<a class="plink" href="#chat-client" title="Direct link to this headline"></a></h4>
<p>The chat client is implemented by the ChatClient class. The ChatClient class is declared as:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">class</span> ChatClient : <span class="keyword">public</span> <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span>
{
    Q_OBJECT

<span class="keyword">public</span>:
    <span class="keyword">explicit</span> ChatClient(<span class="type"><a href="./qobject.htm" translate="no">QObject</a></span> <span class="operator">*</span>parent <span class="operator">=</span> nullptr);
    <span class="operator">~</span>ChatClient();

    <span class="type">void</span> startClient(<span class="keyword">const</span> <span class="type"><a href="./qbluetoothserviceinfo.htm" translate="no">QBluetoothServiceInfo</a></span> <span class="operator">&amp;</span>remoteService);
    <span class="type">void</span> stopClient();

<span class="keyword">public</span> <span class="keyword">slots</span>:
    <span class="type">void</span> sendMessage(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>message);

<span class="keyword">signals</span>:
    <span class="type">void</span> messageReceived(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>sender<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>message);
    <span class="type">void</span> connected(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>name);
    <span class="type">void</span> disconnected();
    <span class="type">void</span> socketErrorOccurred(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>errorString);

<span class="keyword">private</span> <span class="keyword">slots</span>:
    <span class="type">void</span> readSocket();
    <span class="type">void</span> connected();
    <span class="type">void</span> onSocketErrorOccurred(<span class="type"><a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a></span><span class="operator">::</span>SocketError);

<span class="keyword">private</span>:
    <span class="type"><a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a></span> <span class="operator">*</span>socket <span class="operator">=</span> nullptr;
};</pre></div>
<p>The client creates a new <a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a> and connects to the remote service described by the <i>remoteService</i> parameter. Slots are connected to the sockets readyRead(), connected() and disconnected() signals.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> ChatClient<span class="operator">::</span>startClient(<span class="keyword">const</span> <span class="type"><a href="./qbluetoothserviceinfo.htm" translate="no">QBluetoothServiceInfo</a></span> <span class="operator">&amp;</span>remoteService)
{
    <span class="keyword">if</span> (socket)
        <span class="keyword">return</span>;

    <span class="comment">// Connect to service</span>
    socket <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a></span>(<span class="type"><a href="./qbluetoothserviceinfo.htm" translate="no">QBluetoothServiceInfo</a></span><span class="operator">::</span>RfcommProtocol);
    <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Create socket"</span>;
    socket<span class="operator">-</span><span class="operator">&gt;</span>connectToService(remoteService);
    <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"ConnectToService done"</span>;

    connect(socket<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a></span><span class="operator">::</span>readyRead<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>ChatClient<span class="operator">::</span>readSocket);
    connect(socket<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a></span><span class="operator">::</span>connected<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="type">QOverload</span><span class="operator">&lt;</span><span class="operator">&gt;</span><span class="operator">::</span>of(<span class="operator">&amp;</span>ChatClient<span class="operator">::</span>connected));
    connect(socket<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a></span><span class="operator">::</span>disconnected<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>ChatClient<span class="operator">::</span>disconnected);
    connect(socket<span class="operator">,</span> <span class="type">QOverload</span><span class="operator">&lt;</span><span class="type"><a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a></span><span class="operator">::</span>SocketError<span class="operator">&gt;</span><span class="operator">::</span>of(<span class="operator">&amp;</span><span class="type"><a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a></span><span class="operator">::</span>error)<span class="operator">,</span>
            <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>ChatClient<span class="operator">::</span>onSocketErrorOccurred);

}</pre></div>
<p>On successful socket connection we emit a signal to notify others.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> ChatClient<span class="operator">::</span>connected()
{
    <span class="keyword">emit</span> connected(socket<span class="operator">-</span><span class="operator">&gt;</span>peerName());
}</pre></div>
<p>Similarly to the chat server, the readSocket() slot is called when data is available from the socket. Lines are read individually and converted from UTF-8. The messageReceived() signal is emitted.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> ChatClient<span class="operator">::</span>readSocket()
{
    <span class="keyword">if</span> (<span class="operator">!</span>socket)
        <span class="keyword">return</span>;

    <span class="keyword">while</span> (socket<span class="operator">-</span><span class="operator">&gt;</span>canReadLine()) {
        <span class="type"><a href="./qbytearray.htm" translate="no">QByteArray</a></span> line <span class="operator">=</span> socket<span class="operator">-</span><span class="operator">&gt;</span>readLine();
        <span class="keyword">emit</span> messageReceived(socket<span class="operator">-</span><span class="operator">&gt;</span>peerName()<span class="operator">,</span>
                             <span class="type"><a href="./qstring.htm" translate="no">QString</a></span><span class="operator">::</span>fromUtf8(line<span class="operator">.</span>constData()<span class="operator">,</span> line<span class="operator">.</span>length()));
    }
}</pre></div>
<p>The sendMessage() slot is used to send a message to the remote device. The message is converted to UTF-8 and a newline is appended.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> ChatClient<span class="operator">::</span>sendMessage(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>message)
{
    <span class="type"><a href="./qbytearray.htm" translate="no">QByteArray</a></span> text <span class="operator">=</span> message<span class="operator">.</span>toUtf8() <span class="operator">+</span> <span class="char">'\n'</span>;
    socket<span class="operator">-</span><span class="operator">&gt;</span>write(text);
}</pre></div>
<p>To disconnect from the remote chat service, the <a href="./qbluetoothsocket.htm" translate="no">QBluetoothSocket</a> instance is deleted.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> ChatClient<span class="operator">::</span>stopClient()
{
    <span class="keyword">delete</span> socket;
    socket <span class="operator">=</span> nullptr;
}</pre></div>
<a name="chat-dialog"></a>
<h4 id="chat-dialog">Chat Dialog<a class="plink" href="#chat-dialog" title="Direct link to this headline"></a></h4>
<p>The main window of this example is the chat dialog, implemented in the Chat class. This class displays a chat session between a single ChatServer and zero or more ChatClients. The Chat class is declared as:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">class</span> Chat : <span class="keyword">public</span> <span class="type">QDialog</span>
{
    Q_OBJECT

<span class="keyword">public</span>:
    <span class="keyword">explicit</span> Chat(<span class="type">QWidget</span> <span class="operator">*</span>parent <span class="operator">=</span> nullptr);
    <span class="operator">~</span>Chat();

<span class="keyword">signals</span>:
    <span class="type">void</span> sendMessage(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>message);

<span class="keyword">private</span> <span class="keyword">slots</span>:
    <span class="type">void</span> connectClicked();
    <span class="type">void</span> sendClicked();

    <span class="type">void</span> showMessage(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>sender<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>message);

    <span class="type">void</span> clientConnected(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>name);
    <span class="type">void</span> clientDisconnected(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>name);
    <span class="type">void</span> clientDisconnected();
    <span class="type">void</span> connected(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>name);
    <span class="type">void</span> reactOnSocketError(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>error);

    <span class="type">void</span> newAdapterSelected();

<span class="keyword">private</span>:
    <span class="type">int</span> adapterFromUserSelection() <span class="keyword">const</span>;
    <span class="type">int</span> currentAdapterIndex <span class="operator">=</span> <span class="number">0</span>;
    Ui_Chat <span class="operator">*</span>ui;

    ChatServer <span class="operator">*</span>server;
    <span class="type"><a href="./qlist.htm" translate="no">QList</a></span><span class="operator">&lt;</span>ChatClient <span class="operator">*</span><span class="operator">&gt;</span> clients;
    <span class="type"><a href="./qlist.htm" translate="no">QList</a></span><span class="operator">&lt;</span><span class="type"><a href="./qbluetoothhostinfo.htm" translate="no">QBluetoothHostInfo</a></span><span class="operator">&gt;</span> localAdapters;

    <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> localName;
};</pre></div>
<p>First we construct the user interface</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">ui<span class="operator">-</span><span class="operator">&gt;</span>setupUi(<span class="keyword">this</span>);

connect(ui<span class="operator">-</span><span class="operator">&gt;</span>quitButton<span class="operator">,</span> <span class="operator">&amp;</span><span class="type">QPushButton</span><span class="operator">::</span>clicked<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>Chat<span class="operator">::</span>accept);
connect(ui<span class="operator">-</span><span class="operator">&gt;</span>connectButton<span class="operator">,</span> <span class="operator">&amp;</span><span class="type">QPushButton</span><span class="operator">::</span>clicked<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>Chat<span class="operator">::</span>connectClicked);
connect(ui<span class="operator">-</span><span class="operator">&gt;</span>sendButton<span class="operator">,</span> <span class="operator">&amp;</span><span class="type">QPushButton</span><span class="operator">::</span>clicked<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>Chat<span class="operator">::</span>sendClicked);</pre></div>
<p>We create an instance of the ChatServer and respond to its clientConnected(), clientDiconnected(), and messageReceived() signals.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">server <span class="operator">=</span> <span class="keyword">new</span> ChatServer(<span class="keyword">this</span>);
connect(server<span class="operator">,</span> <span class="type">QOverload</span><span class="operator">&lt;</span><span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span><span class="operator">&gt;</span><span class="operator">::</span>of(<span class="operator">&amp;</span>ChatServer<span class="operator">::</span>clientConnected)<span class="operator">,</span>
        <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>Chat<span class="operator">::</span>clientConnected);
connect(server<span class="operator">,</span> <span class="type">QOverload</span><span class="operator">&lt;</span><span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span><span class="operator">&gt;</span><span class="operator">::</span>of(<span class="operator">&amp;</span>ChatServer<span class="operator">::</span>clientDisconnected)<span class="operator">,</span>
        <span class="keyword">this</span><span class="operator">,</span>  <span class="type">QOverload</span><span class="operator">&lt;</span><span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span><span class="operator">&gt;</span><span class="operator">::</span>of(<span class="operator">&amp;</span>Chat<span class="operator">::</span>clientDisconnected));
connect(server<span class="operator">,</span> <span class="operator">&amp;</span>ChatServer<span class="operator">::</span>messageReceived<span class="operator">,</span>
        <span class="keyword">this</span><span class="operator">,</span>  <span class="operator">&amp;</span>Chat<span class="operator">::</span>showMessage);
connect(<span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>Chat<span class="operator">::</span>sendMessage<span class="operator">,</span> server<span class="operator">,</span> <span class="operator">&amp;</span>ChatServer<span class="operator">::</span>sendMessage);
server<span class="operator">-</span><span class="operator">&gt;</span>startServer();</pre></div>
<p>In response to the clientConnected() and clientDisconnected() signals of the ChatServer, we display the typical "X has joined chat." and "Y has left." messages in the chat session.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> Chat<span class="operator">::</span>clientConnected(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>name)
{
    ui<span class="operator">-</span><span class="operator">&gt;</span>chat<span class="operator">-</span><span class="operator">&gt;</span>insertPlainText(<span class="type"><a href="./qstring.htm" translate="no">QString</a></span><span class="operator">::</span>fromLatin1(<span class="string">"%1 has joined chat.\n"</span>)<span class="operator">.</span>arg(name));
}

<span class="type">void</span> Chat<span class="operator">::</span>clientDisconnected(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>name)
{
    ui<span class="operator">-</span><span class="operator">&gt;</span>chat<span class="operator">-</span><span class="operator">&gt;</span>insertPlainText(<span class="type"><a href="./qstring.htm" translate="no">QString</a></span><span class="operator">::</span>fromLatin1(<span class="string">"%1 has left.\n"</span>)<span class="operator">.</span>arg(name));
}</pre></div>
<p>Incoming messages from clients connected to the ChatServer are handled in the showMessage() slot. The message text tagged with the remote device name is displayed in the chat session.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> Chat<span class="operator">::</span>showMessage(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>sender<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>message)
{
    ui<span class="operator">-</span><span class="operator">&gt;</span>chat<span class="operator">-</span><span class="operator">&gt;</span>insertPlainText(<span class="type"><a href="./qstring.htm" translate="no">QString</a></span><span class="operator">::</span>fromLatin1(<span class="string">"%1: %2\n"</span>)<span class="operator">.</span>arg(sender<span class="operator">,</span> message));
    ui<span class="operator">-</span><span class="operator">&gt;</span>chat<span class="operator">-</span><span class="operator">&gt;</span>ensureCursorVisible();
}</pre></div>
<p>In response to the connect button being clicked, the application starts service discovery and presents a list of discovered chat services on remote devices. A ChatClient for the service is selected by the user.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> Chat<span class="operator">::</span>connectClicked()
{
    ui<span class="operator">-</span><span class="operator">&gt;</span>connectButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>);

    <span class="comment">// scan for services</span>
    <span class="keyword">const</span> <span class="type"><a href="./qbluetoothaddress.htm" translate="no">QBluetoothAddress</a></span> adapter <span class="operator">=</span> localAdapters<span class="operator">.</span>isEmpty() <span class="operator">?</span>
                                           <span class="type"><a href="./qbluetoothaddress.htm" translate="no">QBluetoothAddress</a></span>() :
                                           localAdapters<span class="operator">.</span>at(currentAdapterIndex)<span class="operator">.</span>address();

    RemoteSelector remoteSelector(adapter);
<span class="preprocessor">#ifdef Q_OS_ANDROID</span>
    <span class="keyword">if</span> (<span class="type">QtAndroid</span><span class="operator">::</span>androidSdkVersion() <span class="operator">&gt;</span><span class="operator">=</span> <span class="number">23</span>)
        remoteSelector<span class="operator">.</span>startDiscovery(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span>(reverseUuid));
    <span class="keyword">else</span>
        remoteSelector<span class="operator">.</span>startDiscovery(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span>(serviceUuid));
<span class="preprocessor">#else</span>
    remoteSelector<span class="operator">.</span>startDiscovery(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span>(serviceUuid));
<span class="preprocessor">#endif</span>
    <span class="keyword">if</span> (remoteSelector<span class="operator">.</span>exec() <span class="operator">=</span><span class="operator">=</span> <span class="type">QDialog</span><span class="operator">::</span>Accepted) {
        <span class="type"><a href="./qbluetoothserviceinfo.htm" translate="no">QBluetoothServiceInfo</a></span> service <span class="operator">=</span> remoteSelector<span class="operator">.</span>service();

        <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Connecting to service 2"</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> service<span class="operator">.</span>serviceName()
                 <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"on"</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> service<span class="operator">.</span>device()<span class="operator">.</span>name();

        <span class="comment">// Create client</span>
        <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Going to create client"</span>;
        ChatClient <span class="operator">*</span>client <span class="operator">=</span> <span class="keyword">new</span> ChatClient(<span class="keyword">this</span>);
<a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Connecting..."</span>;

        connect(client<span class="operator">,</span> <span class="operator">&amp;</span>ChatClient<span class="operator">::</span>messageReceived<span class="operator">,</span>
                <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>Chat<span class="operator">::</span>showMessage);
        connect(client<span class="operator">,</span> <span class="operator">&amp;</span>ChatClient<span class="operator">::</span>disconnected<span class="operator">,</span>
                <span class="keyword">this</span><span class="operator">,</span> <span class="type">QOverload</span><span class="operator">&lt;</span><span class="operator">&gt;</span><span class="operator">::</span>of(<span class="operator">&amp;</span>Chat<span class="operator">::</span>clientDisconnected));
        connect(client<span class="operator">,</span> <span class="type">QOverload</span><span class="operator">&lt;</span><span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span><span class="operator">&gt;</span><span class="operator">::</span>of(<span class="operator">&amp;</span>ChatClient<span class="operator">::</span>connected)<span class="operator">,</span>
                <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>Chat<span class="operator">::</span>connected);
        connect(client<span class="operator">,</span> <span class="operator">&amp;</span>ChatClient<span class="operator">::</span>socketErrorOccurred<span class="operator">,</span>
                <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>Chat<span class="operator">::</span>reactOnSocketError);
        connect(<span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>Chat<span class="operator">::</span>sendMessage<span class="operator">,</span> client<span class="operator">,</span> <span class="operator">&amp;</span>ChatClient<span class="operator">::</span>sendMessage);
<a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Start client"</span>;
        client<span class="operator">-</span><span class="operator">&gt;</span>startClient(service);

        clients<span class="operator">.</span>append(client);
    }

    ui<span class="operator">-</span><span class="operator">&gt;</span>connectButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">true</span>);
}</pre></div>
<p>In reponse to the connected() signals from ChatClient, we display the a "Joined chat with X." message in the chat session.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> Chat<span class="operator">::</span>connected(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>name)
{
    ui<span class="operator">-</span><span class="operator">&gt;</span>chat<span class="operator">-</span><span class="operator">&gt;</span>insertPlainText(<span class="type"><a href="./qstring.htm" translate="no">QString</a></span><span class="operator">::</span>fromLatin1(<span class="string">"Joined chat with %1.\n"</span>)<span class="operator">.</span>arg(name));
}</pre></div>
<p>Messages are sent to all remote devices via the ChatServer and ChatClient instances by emitting the sendMessage() signal.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> Chat<span class="operator">::</span>sendClicked()
{
    ui<span class="operator">-</span><span class="operator">&gt;</span>sendButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>);
    ui<span class="operator">-</span><span class="operator">&gt;</span>sendText<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>);

    showMessage(localName<span class="operator">,</span> ui<span class="operator">-</span><span class="operator">&gt;</span>sendText<span class="operator">-</span><span class="operator">&gt;</span>text());
    <span class="keyword">emit</span> sendMessage(ui<span class="operator">-</span><span class="operator">&gt;</span>sendText<span class="operator">-</span><span class="operator">&gt;</span>text());

    ui<span class="operator">-</span><span class="operator">&gt;</span>sendText<span class="operator">-</span><span class="operator">&gt;</span>clear();

    ui<span class="operator">-</span><span class="operator">&gt;</span>sendText<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">true</span>);
    ui<span class="operator">-</span><span class="operator">&gt;</span>sendButton<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">true</span>);
}</pre></div>
<p>We need to clean up ChatClient instances when the remote device forces a disconnect.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> Chat<span class="operator">::</span>clientDisconnected()
{
    ChatClient <span class="operator">*</span>client <span class="operator">=</span> qobject_cast<span class="operator">&lt;</span>ChatClient <span class="operator">*</span><span class="operator">&gt;</span>(sender());
    <span class="keyword">if</span> (client) {
        clients<span class="operator">.</span>removeOne(client);
        client<span class="operator">-</span><span class="operator">&gt;</span>deleteLater();
    }
}</pre></div>
<p><a href="https://code.qt.io/cgit/qt/qtconnectivity.git/tree/examples/bluetooth/btchat?h=5.15" translate="no">Example project @ code.qt.io</a></p>
</div>
<!-- @@@btchat -->
</div>
<p class="copy-notice">
<acronym title="Copyright">Â©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>