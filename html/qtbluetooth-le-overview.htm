<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bluetooth Low Energy Overview | Qt Bluetooth</title>
<link rel="canonical" href="https://doc.qt.io/qt-6/qtbluetooth-le-overview.html">
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="./index.htm" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtbluetooth-index.htm" translate="no">Qt Bluetooth</a></li>
                            <li><a>Bluetooth Low Energy Overview</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">Bluetooth Low Energy Overview</h1>
<span class="subtitle"></span>
<!-- $$$qtbluetooth-le-overview.html-description -->
<div class="descr"> <a name="details"></a>
<p>The Qt Bluetooth Low Energy API for the central role was introduced by Qt 5.4. Since Qt 5.5 that part of the API is final and a compatibility guarantee is given for future releases. Since Qt 5.7, additional API supporting the peripheral role was added as a Technology Preview, with the backend implemented for Linux/<a href="./qtbluetooth-attribution-bluez.htm" translate="no">BlueZ</a>, iOS and macOS.</p>
<a name="what-is-bluetooth-low-energy"></a>
<h2 id="what-is-bluetooth-low-energy">What Is Bluetooth Low Energy<a class="plink" href="#what-is-bluetooth-low-energy" title="Direct link to this headline"></a></h2>
<p>Bluetooth Low Energy, also known as Bluetooth Smart, is a wireless computer network technology, which was officially introduced in 2011. It works on the same 2.4 GHz frequency as ”classic” Bluetooth. The main difference is, as stated by its technology name, low energy consumption. It provides an opportunity for Bluetooth Low Energy devices to operate for months, even years, on coin-cell batteries. The technology was introduced by <a href="https://www.bluetooth.org/en-us/specification/adopted-specifications" translate="no">Bluetooth v4.0</a>. Devices which support this technology are called Bluetooth Smart Ready Devices. The key features of the technology are:</p>
<ul>
<li>Ultra-low peak, average and idle mode power consumption</li>
<li>Ability to run for years on standard, coin-cell batteries</li>
<li>Low cost</li>
<li>Multi-vendor interoperability</li>
<li>Enhanced range</li>
</ul>
<p>Bluetooth Low Energy uses a client-server architecture. The server (also known as peripheral) offers services such as temperature or heart rate and advertises them. The client (known as central device) connects to the server and reads the values advertised by the server. An example might be an apartment with Bluetooth Smart Ready sensors such as a thermostat, humidity or pressure sensor. Those sensors are peripheral devices advertising the environment values of the apartment. At the same time a mobile phone or computer might connect to those sensors, retrieve their values and present them as part of a larger environment control application to the user.</p>
<a name="basic-service-structure"></a>
<h2 id="basic-service-structure">Basic Service Structure<a class="plink" href="#basic-service-structure" title="Direct link to this headline"></a></h2>
<p>Bluetooth Low Energy is based on two protocols: ATT (Attribute Protocol) and GATT (Generic Attribute Profile). They specify the communication layers used by every Bluetooth Smart Ready device.</p>
<a name="att-protocol"></a>
<h3 id="att-protocol">ATT Protocol<a class="plink" href="#att-protocol" title="Direct link to this headline"></a></h3>
<p>The basic building block of ATT is an <i>attribute</i>. Each attribute consists of three elements:</p>
<ul>
<li>a value - the payload or desirable piece of information</li>
<li>a UUID - the type of attribute (used by GATT)</li>
<li>a 16-bit handle - a unique identifier for the attribute</li>
</ul>
<p>The server stores the attributes and the client uses the ATT protocol to read and write values on the server.</p>
<a name="gatt-profile"></a>
<h3 id="gatt-profile">GATT Profile<a class="plink" href="#gatt-profile" title="Direct link to this headline"></a></h3>
<p>GATT defines grouping for a set of attributes by applying a meaning to predefined UUIDs. The table below shows an example service exposing a heart rate on a particular day. The actual values are stored inside the two characteristics:</p>
<div class="table"><table class="generic">
<thead><tr class="qt-style"><th>Handle</th><th>UUID</th><th>Value</th><th>Description</th></tr></thead>
<tbody><tr class="odd" valign="top"><td>0x0001</td><td>0x2800</td><td>UUID 0x180D</td><td>Begin Heart Rate service</td></tr>
<tr class="even" valign="top"><td>0x0002</td><td>0x2803</td><td>UUID 0x2A37, Value handle: 0x0003</td><td>Characteristic of type <i>Heart Rate Measurement (HRM)</i></td></tr>
<tr class="odd" valign="top"><td>0x0003</td><td>0x2A37</td><td>65 bpm</td><td>Heart rate value</td></tr>
<tr class="even" valign="top"><td>0x0004</td><td>0x2803</td><td>UUID 0x2A08, Value handle: 0x0005</td><td>Characteristic of type Date Time</td></tr>
<tr class="odd" valign="top"><td>0x0005</td><td>0x2A08</td><td>18/08/2014 11:00</td><td>Date and Time of the measurement</td></tr>
<tr class="even" valign="top"><td>0x0006</td><td>0x2800</td><td>UUID xxxxxx</td><td>Begin next service</td></tr>
<tr class="odd" valign="top"><td>...</td><td>...</td><td>...</td><td>...</td></tr>
</tbody></table></div>
<p>GATT specifies that the above used UUID <code translate="no">0x2800</code> marks the begin of a service definition. Every attribute following <code translate="no">0x2800</code> is part of the service until the next <code translate="no">0x2800</code> or the end is encountered. In similar ways the well known UUID <code translate="no">0x2803</code> states that a characteristic is to be found and each of the characteristics has a type defining the nature of the value. The example above uses the UUIDs <code translate="no">0x2A08</code> (Date Time) and <code translate="no">0x2A37</code> (Heart Rate Measurement). Each of the above UUIDs is defined by the <a href="https://bluetooth.org" translate="no">Bluetooth Special Interest Group</a>. and can be found in the <a href="https://developer.bluetooth.org/gatt/Pages/default.aspx" translate="no">GATT specification</a>. While it is advisable to use pre-defined UUIDs where available it is entirely possible to use new and not yet used UUIDs for characteristic and service types.</p>
<p>In general, each service may consist of one or more characteristics. A characteristic contains data and can be further described by descriptors, which provide additional information or means of manipulating the characteristic. All services, characteristics and descriptors are recognized by their 128-bit UUID. Finally, it is possible to include services inside of services (see picture below).</p>
<p class="centerAlign"><img alt="" src="./images/peripheral-structure.png"></p><a name="using-qt-bluetooth-low-energy-api"></a>
<h2 id="using-qt-bluetooth-low-energy-api">Using Qt Bluetooth Low Energy API<a class="plink" href="#using-qt-bluetooth-low-energy-api" title="Direct link to this headline"></a></h2>
<p>This section describes how to use the Bluetooth Low Energy API provided by Qt. On the client side, the API permits creating connections to peripheral devices, discovering their services, as well as reading and writing data stored on the device. On the server side, it allows to set up services, advertise them, and get notified when the client writes characteristics. The example code below is taken from the <a href="./qtbluetooth-heartrate-game-example.htm" translate="no">Heart Rate Game</a> and <a href="./qtbluetooth-heartrate-server-example.htm" translate="no">Heart Rate Server</a> examples.</p>
<a name="establishing-a-connection"></a>
<h3 id="establishing-a-connection">Establishing a Connection<a class="plink" href="#establishing-a-connection" title="Direct link to this headline"></a></h3>
<p>To be able to read and write the characteristics of the Bluetooth Low Energy peripheral device, it is necessary to find and connect the device. This requires the peripheral device to advertise its presence and services. We start the device discovery with the help of the <a href="./qbluetoothdevicediscoveryagent.htm" translate="no">QBluetoothDeviceDiscoveryAgent</a> class. We connect to its <a href="./qbluetoothdevicediscoveryagent.htm#deviceDiscovered" translate="no">QBluetoothDeviceDiscoveryAgent::deviceDiscovered</a>() signal and start the search with <a href="./qbluetoothdevicediscoveryagent.htm#start" translate="no">start()</a>:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">m_deviceDiscoveryAgent <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qbluetoothdevicediscoveryagent.htm" translate="no">QBluetoothDeviceDiscoveryAgent</a></span>(<span class="keyword">this</span>);
m_deviceDiscoveryAgent<span class="operator">-</span><span class="operator">&gt;</span>setLowEnergyDiscoveryTimeout(<span class="number">5000</span>);

connect(m_deviceDiscoveryAgent<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qbluetoothdevicediscoveryagent.htm" translate="no">QBluetoothDeviceDiscoveryAgent</a></span><span class="operator">::</span>deviceDiscovered<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>DeviceFinder<span class="operator">::</span>addDevice);
connect(m_deviceDiscoveryAgent<span class="operator">,</span> <span class="keyword">static_cast</span><span class="operator">&lt;</span><span class="type">void</span> (<span class="type"><a href="./qbluetoothdevicediscoveryagent.htm" translate="no">QBluetoothDeviceDiscoveryAgent</a></span><span class="operator">::</span><span class="operator">*</span>)(<span class="type"><a href="./qbluetoothdevicediscoveryagent.htm" translate="no">QBluetoothDeviceDiscoveryAgent</a></span><span class="operator">::</span>Error)<span class="operator">&gt;</span>(<span class="operator">&amp;</span><span class="type"><a href="./qbluetoothdevicediscoveryagent.htm" translate="no">QBluetoothDeviceDiscoveryAgent</a></span><span class="operator">::</span>error)<span class="operator">,</span>
        <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>DeviceFinder<span class="operator">::</span>scanError);

connect(m_deviceDiscoveryAgent<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qbluetoothdevicediscoveryagent.htm" translate="no">QBluetoothDeviceDiscoveryAgent</a></span><span class="operator">::</span>finished<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>DeviceFinder<span class="operator">::</span>scanFinished);
connect(m_deviceDiscoveryAgent<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qbluetoothdevicediscoveryagent.htm" translate="no">QBluetoothDeviceDiscoveryAgent</a></span><span class="operator">::</span>canceled<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>DeviceFinder<span class="operator">::</span>scanFinished);
m_deviceDiscoveryAgent<span class="operator">-</span><span class="operator">&gt;</span>start(<span class="type"><a href="./qbluetoothdevicediscoveryagent.htm" translate="no">QBluetoothDeviceDiscoveryAgent</a></span><span class="operator">::</span>LowEnergyMethod);</pre></div>
<p>Since we are only interested in Low Energy devices we filter the device type within the receiving slot. The device type can be ascertained using the <a href="./qbluetoothdeviceinfo.htm#coreConfigurations" translate="no">QBluetoothDeviceInfo::coreConfigurations</a>() flag:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> DeviceFinder<span class="operator">::</span>addDevice(<span class="keyword">const</span> <span class="type"><a href="./qbluetoothdeviceinfo.htm" translate="no">QBluetoothDeviceInfo</a></span> <span class="operator">&amp;</span>device)
{
    <span class="comment">// If device is LowEnergy-device, add it to the list</span>
    <span class="keyword">if</span> (device<span class="operator">.</span>coreConfigurations() <span class="operator">&amp;</span> <span class="type"><a href="./qbluetoothdeviceinfo.htm" translate="no">QBluetoothDeviceInfo</a></span><span class="operator">::</span>LowEnergyCoreConfiguration) {
        m_devices<span class="operator">.</span>append(<span class="keyword">new</span> DeviceInfo(device));
        setInfo(tr(<span class="string">"Low Energy device found. Scanning more..."</span>));
    }
    <span class="comment">//...</span>
}</pre></div>
<p>Once the address of the peripheral device is known we use the <a href="./qlowenergycontroller.htm" translate="no">QLowEnergyController</a> class. This class is the entry point for all Bluetooth Low Energy development. The constructor of the class accepts the remote device's <a href="./qbluetoothaddress.htm" translate="no">QBluetoothAddress</a>. Finally we set up the customary slots and directly connect to the device using <a href="./qlowenergycontroller.htm#connectToDevice" translate="no">connectToDevice()</a>:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">m_control <span class="operator">=</span> <span class="type"><a href="./qlowenergycontroller.htm" translate="no">QLowEnergyController</a></span><span class="operator">::</span>createCentral(m_currentDevice<span class="operator">-</span><span class="operator">&gt;</span>getDevice()<span class="operator">,</span> <span class="keyword">this</span>);
connect(m_control<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qlowenergycontroller.htm" translate="no">QLowEnergyController</a></span><span class="operator">::</span>serviceDiscovered<span class="operator">,</span>
        <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>DeviceHandler<span class="operator">::</span>serviceDiscovered);
connect(m_control<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qlowenergycontroller.htm" translate="no">QLowEnergyController</a></span><span class="operator">::</span>discoveryFinished<span class="operator">,</span>
        <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>DeviceHandler<span class="operator">::</span>serviceScanDone);

connect(m_control<span class="operator">,</span> <span class="keyword">static_cast</span><span class="operator">&lt;</span><span class="type">void</span> (<span class="type"><a href="./qlowenergycontroller.htm" translate="no">QLowEnergyController</a></span><span class="operator">::</span><span class="operator">*</span>)(<span class="type"><a href="./qlowenergycontroller.htm" translate="no">QLowEnergyController</a></span><span class="operator">::</span>Error)<span class="operator">&gt;</span>(<span class="operator">&amp;</span><span class="type"><a href="./qlowenergycontroller.htm" translate="no">QLowEnergyController</a></span><span class="operator">::</span>error)<span class="operator">,</span>
        <span class="keyword">this</span><span class="operator">,</span> <span class="operator">[</span><span class="keyword">this</span><span class="operator">]</span>(<span class="type"><a href="./qlowenergycontroller.htm" translate="no">QLowEnergyController</a></span><span class="operator">::</span>Error error) {
    Q_UNUSED(error);
    setError(<span class="string">"Cannot connect to remote device."</span>);
});
connect(m_control<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qlowenergycontroller.htm" translate="no">QLowEnergyController</a></span><span class="operator">::</span>connected<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">[</span><span class="keyword">this</span><span class="operator">]</span>() {
    setInfo(<span class="string">"Controller connected. Search services..."</span>);
    m_control<span class="operator">-</span><span class="operator">&gt;</span>discoverServices();
});
connect(m_control<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qlowenergycontroller.htm" translate="no">QLowEnergyController</a></span><span class="operator">::</span>disconnected<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">[</span><span class="keyword">this</span><span class="operator">]</span>() {
    setError(<span class="string">"LowEnergy controller disconnected"</span>);
});

<span class="comment">// Connect</span>
m_control<span class="operator">-</span><span class="operator">&gt;</span>connectToDevice();</pre></div>
<a name="service-search"></a>
<h3 id="service-search">Service Search<a class="plink" href="#service-search" title="Direct link to this headline"></a></h3>
<p>The above code snippet how the application initiates the service discovery once the connection has been established.</p>
<p>The <code translate="no">serviceDiscovered()</code> slot below is triggered as a result of the <a href="./qlowenergycontroller.htm#serviceDiscovered" translate="no">QLowEnergyController::serviceDiscovered</a>() signal and provides an intermittent progress report. Since we are talking about the heart listener app which monitors HeartRate devices in the vicinity we ignore any service that is not of type <a href="./qbluetoothuuid.htm#ServiceClassUuid-enum" translate="no">QBluetoothUuid::HeartRate</a>.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> DeviceHandler<span class="operator">::</span>serviceDiscovered(<span class="keyword">const</span> <span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span> <span class="operator">&amp;</span>gatt)
{
    <span class="keyword">if</span> (gatt <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span>(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span><span class="operator">::</span>HeartRate)) {
        setInfo(<span class="string">"Heart Rate service discovered. Waiting for service scan to be done..."</span>);
        m_foundHeartRateService <span class="operator">=</span> <span class="keyword">true</span>;
    }
}</pre></div>
<p>Eventually the <a href="./qlowenergycontroller.htm#discoveryFinished" translate="no">QLowEnergyController::discoveryFinished</a>() signal is emitted to indicate the successful completion of the service discovery. Provided a HeartRate service was found, a <a href="./qlowenergyservice.htm" translate="no">QLowEnergyService</a> instance is created to represent the service. The returned service object provides the required signals for update notifications and the discovery of service details is triggered using <a href="./qlowenergyservice.htm#discoverDetails" translate="no">QLowEnergyService::discoverDetails</a>():</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    <span class="comment">// If heartRateService found, create new service</span>
    <span class="keyword">if</span> (m_foundHeartRateService)
        m_service <span class="operator">=</span> m_control<span class="operator">-</span><span class="operator">&gt;</span>createServiceObject(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span>(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span><span class="operator">::</span>HeartRate)<span class="operator">,</span> <span class="keyword">this</span>);

    <span class="keyword">if</span> (m_service) {
        connect(m_service<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qlowenergyservice.htm" translate="no">QLowEnergyService</a></span><span class="operator">::</span>stateChanged<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>DeviceHandler<span class="operator">::</span>serviceStateChanged);
        connect(m_service<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qlowenergyservice.htm" translate="no">QLowEnergyService</a></span><span class="operator">::</span>characteristicChanged<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>DeviceHandler<span class="operator">::</span>updateHeartRateValue);
        connect(m_service<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qlowenergyservice.htm" translate="no">QLowEnergyService</a></span><span class="operator">::</span>descriptorWritten<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>DeviceHandler<span class="operator">::</span>confirmedDescriptorWrite);
        m_service<span class="operator">-</span><span class="operator">&gt;</span>discoverDetails();
    } <span class="keyword">else</span> {
        setError(<span class="string">"Heart Rate Service not found."</span>);
    }</pre></div>
<p>During the detail search the service's <a href="./qlowenergyservice.htm#state" translate="no">state()</a> transitions from <a href="./qlowenergyservice.htm#ServiceState-enum" translate="no">DiscoveryRequired</a> to <a href="./qlowenergyservice.htm#ServiceState-enum" translate="no">DiscoveringServices</a> and eventually ends with <a href="./qlowenergyservice.htm#ServiceState-enum" translate="no">ServiceDiscovered</a>:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> DeviceHandler<span class="operator">::</span>serviceStateChanged(<span class="type"><a href="./qlowenergyservice.htm" translate="no">QLowEnergyService</a></span><span class="operator">::</span>ServiceState s)
{
    <span class="keyword">switch</span> (s) {
    <span class="keyword">case</span> <span class="type"><a href="./qlowenergyservice.htm" translate="no">QLowEnergyService</a></span><span class="operator">::</span>DiscoveringServices:
        setInfo(tr(<span class="string">"Discovering services..."</span>));
        <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="type"><a href="./qlowenergyservice.htm" translate="no">QLowEnergyService</a></span><span class="operator">::</span>ServiceDiscovered:
    {
        setInfo(tr(<span class="string">"Service discovered."</span>));

        <span class="keyword">const</span> <span class="type"><a href="./qlowenergycharacteristic.htm" translate="no">QLowEnergyCharacteristic</a></span> hrChar <span class="operator">=</span> m_service<span class="operator">-</span><span class="operator">&gt;</span>characteristic(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span>(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span><span class="operator">::</span>HeartRateMeasurement));
        <span class="keyword">if</span> (<span class="operator">!</span>hrChar<span class="operator">.</span>isValid()) {
            setError(<span class="string">"HR Data not found."</span>);
            <span class="keyword">break</span>;
        }

        m_notificationDesc <span class="operator">=</span> hrChar<span class="operator">.</span>descriptor(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span><span class="operator">::</span>ClientCharacteristicConfiguration);
        <span class="keyword">if</span> (m_notificationDesc<span class="operator">.</span>isValid())
            m_service<span class="operator">-</span><span class="operator">&gt;</span>writeDescriptor(m_notificationDesc<span class="operator">,</span> <span class="type"><a href="./qbytearray.htm" translate="no">QByteArray</a></span><span class="operator">::</span>fromHex(<span class="string">"0100"</span>));

        <span class="keyword">break</span>;
    }
    <span class="keyword">default</span>:
        <span class="comment">//nothing for now</span>
        <span class="keyword">break</span>;
    }

    <span class="keyword">emit</span> aliveChanged();
}</pre></div>
<a name="interaction-with-the-peripheral-device"></a>
<h3 id="interaction-with-the-peripheral-device">Interaction with the Peripheral Device<a class="plink" href="#interaction-with-the-peripheral-device" title="Direct link to this headline"></a></h3>
<p>In the code example above, the desired characteristic is of type <a href="./qbluetoothuuid.htm#CharacteristicType-enum" translate="no">HeartRateMeasurement</a>. Since the application measures the heart rate changes, it must enable change notifications for the characteristic. Note that not all characteristics provide change notifications. Since the HeartRate characteristic has been standardized it is possible to assume that notifications can be received. Ultimately <a href="./qlowenergycharacteristic.htm#properties" translate="no">QLowEnergyCharacteristic::properties</a>() must have the <a href="./qlowenergycharacteristic.htm#PropertyType-enum" translate="no">QLowEnergyCharacteristic::Notify</a> flag set and a descriptor of type <a href="./qbluetoothuuid.htm#DescriptorType-enum" translate="no">QBluetoothUuid::ClientCharacteristicConfiguration</a> must exist to confirm the availability of an appropriate notification.</p>
<p>Finally, we process the value of the HeartRate characteristic, as per Bluetooth Low Energy standard:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> DeviceHandler<span class="operator">::</span>updateHeartRateValue(<span class="keyword">const</span> <span class="type"><a href="./qlowenergycharacteristic.htm" translate="no">QLowEnergyCharacteristic</a></span> <span class="operator">&amp;</span>c<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qbytearray.htm" translate="no">QByteArray</a></span> <span class="operator">&amp;</span>value)
{
    <span class="comment">// ignore any other characteristic change -&gt; shouldn't really happen though</span>
    <span class="keyword">if</span> (c<span class="operator">.</span>uuid() <span class="operator">!</span><span class="operator">=</span> <span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span>(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span><span class="operator">::</span>HeartRateMeasurement))
        <span class="keyword">return</span>;

    <span class="keyword">auto</span> data <span class="operator">=</span> <span class="keyword">reinterpret_cast</span><span class="operator">&lt;</span><span class="keyword">const</span> <span class="type"><a href="./qtglobal.htm#quint8-typedef" translate="no">quint8</a></span> <span class="operator">*</span><span class="operator">&gt;</span>(value<span class="operator">.</span>constData());
    <span class="type"><a href="./qtglobal.htm#quint8-typedef" translate="no">quint8</a></span> flags <span class="operator">=</span> <span class="operator">*</span>data;

    <span class="comment">//Heart Rate</span>
    <span class="type">int</span> hrvalue <span class="operator">=</span> <span class="number">0</span>;
    <span class="keyword">if</span> (flags <span class="operator">&amp;</span> <span class="number">0x1</span>) <span class="comment">// HR 16 bit? otherwise 8 bit</span>
        hrvalue <span class="operator">=</span> <span class="keyword">static_cast</span><span class="operator">&lt;</span><span class="type">int</span><span class="operator">&gt;</span>(<a href="./qtendian.htm#qFromLittleEndian" translate="no">qFromLittleEndian</a><span class="operator">&lt;</span><span class="type"><a href="./qtglobal.htm#quint16-typedef" translate="no">quint16</a></span><span class="operator">&gt;</span>(data<span class="operator">[</span><span class="number">1</span><span class="operator">]</span>));
    <span class="keyword">else</span>
        hrvalue <span class="operator">=</span> <span class="keyword">static_cast</span><span class="operator">&lt;</span><span class="type">int</span><span class="operator">&gt;</span>(data<span class="operator">[</span><span class="number">1</span><span class="operator">]</span>);

    addMeasurement(hrvalue);
}</pre></div>
<p>In general a characteristic value is a series of bytes. The precise interpretation of those bytes depends on the characteristic type and value structure. A significant number has been standardized by the <a href="https://developer.bluetooth.org/gatt/services/Pages/ServicesHome.aspx" translate="no">Bluetooth SIG</a> whereas others may follow a custom protocol. The above code snippet demonstrates how to the read the standardized HeartRate value.</p>
<a name="advertising-services"></a>
<h3 id="advertising-services">Advertising Services<a class="plink" href="#advertising-services" title="Direct link to this headline"></a></h3>
<p>If we are implementing a GATT server application on a peripheral device, we need to define the services we want to offer to central devices and advertise them:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type"><a href="./qlowenergyadvertisingdata.htm" translate="no">QLowEnergyAdvertisingData</a></span> advertisingData;
advertisingData<span class="operator">.</span>setDiscoverability(<span class="type"><a href="./qlowenergyadvertisingdata.htm" translate="no">QLowEnergyAdvertisingData</a></span><span class="operator">::</span>DiscoverabilityGeneral);
advertisingData<span class="operator">.</span>setIncludePowerLevel(<span class="keyword">true</span>);
advertisingData<span class="operator">.</span>setLocalName(<span class="string">"HeartRateServer"</span>);
advertisingData<span class="operator">.</span>setServices(<span class="type"><a href="./qlist.htm" translate="no">QList</a></span><span class="operator">&lt;</span><span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span><span class="operator">&gt;</span>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span><span class="operator">::</span>HeartRate);
<span class="keyword">const</span> <span class="type"><a href="./qscopedpointer.htm" translate="no">QScopedPointer</a></span><span class="operator">&lt;</span><span class="type"><a href="./qlowenergycontroller.htm" translate="no">QLowEnergyController</a></span><span class="operator">&gt;</span> leController(<span class="type"><a href="./qlowenergycontroller.htm" translate="no">QLowEnergyController</a></span><span class="operator">::</span>createPeripheral());
<span class="type"><a href="./qscopedpointer.htm" translate="no">QScopedPointer</a></span><span class="operator">&lt;</span><span class="type"><a href="./qlowenergyservice.htm" translate="no">QLowEnergyService</a></span><span class="operator">&gt;</span> service(leController<span class="operator">-</span><span class="operator">&gt;</span>addService(serviceData));
leController<span class="operator">-</span><span class="operator">&gt;</span>startAdvertising(<span class="type"><a href="./qlowenergyadvertisingparameters.htm" translate="no">QLowEnergyAdvertisingParameters</a></span>()<span class="operator">,</span> advertisingData<span class="operator">,</span>
                               advertisingData);</pre></div>
<p>Now potential clients can connect to our device, discover the provided service and register themselves to get notified of changes to the characteristic value. This part of the API was already covered by the above sections.</p>
<a name="implementing-a-service-on-the-peripheral-device"></a>
<h3 id="implementing-a-service-on-the-peripheral-device">Implementing a Service on the Peripheral Device<a class="plink" href="#implementing-a-service-on-the-peripheral-device" title="Direct link to this headline"></a></h3>
<p>The first step is to define the service, its characteristics and descriptors. This is achieved using the <a href="./qlowenergyservicedata.htm" translate="no">QLowEnergyServiceData</a>, <a href="./qlowenergycharacteristicdata.htm" translate="no">QLowEnergyCharacteristicData</a> and <a href="./qlowenergydescriptordata.htm" translate="no">QLowEnergyDescriptorData</a> classes. These classes act as containers or building blocks for the essential information that comprises the to-be-defined Bluetooth Low Energy service. The code snippet below defines a simple HeartRate service which publishes the measured beats per minute. An example where such a service could be used is a wrist watch.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type"><a href="./qlowenergycharacteristicdata.htm" translate="no">QLowEnergyCharacteristicData</a></span> charData;
charData<span class="operator">.</span>setUuid(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span><span class="operator">::</span>HeartRateMeasurement);
charData<span class="operator">.</span>setValue(<span class="type"><a href="./qbytearray.htm" translate="no">QByteArray</a></span>(<span class="number">2</span><span class="operator">,</span> <span class="number">0</span>));
charData<span class="operator">.</span>setProperties(<span class="type"><a href="./qlowenergycharacteristic.htm" translate="no">QLowEnergyCharacteristic</a></span><span class="operator">::</span>Notify);
<span class="keyword">const</span> <span class="type"><a href="./qlowenergydescriptordata.htm" translate="no">QLowEnergyDescriptorData</a></span> clientConfig(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span><span class="operator">::</span>ClientCharacteristicConfiguration<span class="operator">,</span>
                                            <span class="type"><a href="./qbytearray.htm" translate="no">QByteArray</a></span>(<span class="number">2</span><span class="operator">,</span> <span class="number">0</span>));
charData<span class="operator">.</span>addDescriptor(clientConfig);

<span class="type"><a href="./qlowenergyservicedata.htm" translate="no">QLowEnergyServiceData</a></span> serviceData;
serviceData<span class="operator">.</span>setType(<span class="type"><a href="./qlowenergyservicedata.htm" translate="no">QLowEnergyServiceData</a></span><span class="operator">::</span>ServiceTypePrimary);
serviceData<span class="operator">.</span>setUuid(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span><span class="operator">::</span>HeartRate);
serviceData<span class="operator">.</span>addCharacteristic(charData);</pre></div>
<p>The resulting <code translate="no">serviceData</code> object can be published as described in the <a href="./qtbluetooth-le-overview.htm#advertising-services" translate="no">Advertising Services</a> section above. Despite the partial information overlap between the information wrapped by <a href="./qlowenergyservicedata.htm" translate="no">QLowEnergyServiceData</a> and <a href="./qlowenergyadvertisingdata.htm" translate="no">QLowEnergyAdvertisingData</a> the two classes serve two very different tasks. The advertising data is published to nearby devices and often limited in scope due to its size restriction of 29 bytes. Therefore they are not always 100% complete. By comparison the service data contained inside of <a href="./qlowenergyservicedata.htm" translate="no">QLowEnergyServiceData</a> provides the complete set of service data and only becomes visible to the connecting client when a connection with an active service discovery has been performed.</p>
<p>The next section demonstrates how the service can update the heart rate value. Depending on the nature of the service it may have to comply with the official service definition as defined on <a href="https://www.bluetooth.org" translate="no">https://www.bluetooth.org</a>. Other services may be completely custom. The heart rate service was adopted and its specification can be found under <a href="https://www.bluetooth.com/specifications/adopted-specifications" translate="no">https://www.bluetooth.com/specifications/adopted-specifications</a>.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type"><a href="./qtimer.htm" translate="no">QTimer</a></span> heartbeatTimer;
<span class="type"><a href="./qtglobal.htm#quint8-typedef" translate="no">quint8</a></span> currentHeartRate <span class="operator">=</span> <span class="number">60</span>;
<span class="keyword">enum</span> ValueChange { ValueUp<span class="operator">,</span> ValueDown } valueChange <span class="operator">=</span> ValueUp;
<span class="keyword">const</span> <span class="keyword">auto</span> heartbeatProvider <span class="operator">=</span> <span class="operator">[</span><span class="operator">&amp;</span>service<span class="operator">,</span> <span class="operator">&amp;</span>currentHeartRate<span class="operator">,</span> <span class="operator">&amp;</span>valueChange<span class="operator">]</span>() {
    <span class="type"><a href="./qbytearray.htm" translate="no">QByteArray</a></span> value;
    value<span class="operator">.</span>append(<span class="type">char</span>(<span class="number">0</span>)); <span class="comment">// Flags that specify the format of the value.</span>
    value<span class="operator">.</span>append(<span class="type">char</span>(currentHeartRate)); <span class="comment">// Actual value.</span>
    <span class="type"><a href="./qlowenergycharacteristic.htm" translate="no">QLowEnergyCharacteristic</a></span> characteristic
            <span class="operator">=</span> service<span class="operator">-</span><span class="operator">&gt;</span>characteristic(<span class="type"><a href="./qbluetoothuuid.htm" translate="no">QBluetoothUuid</a></span><span class="operator">::</span>HeartRateMeasurement);
    Q_ASSERT(characteristic<span class="operator">.</span>isValid());
    service<span class="operator">-</span><span class="operator">&gt;</span>writeCharacteristic(characteristic<span class="operator">,</span> value); <span class="comment">// Potentially causes notification.</span>
    <span class="keyword">if</span> (currentHeartRate <span class="operator">=</span><span class="operator">=</span> <span class="number">60</span>)
        valueChange <span class="operator">=</span> ValueUp;
    <span class="keyword">else</span> <span class="keyword">if</span> (currentHeartRate <span class="operator">=</span><span class="operator">=</span> <span class="number">100</span>)
        valueChange <span class="operator">=</span> ValueDown;
    <span class="keyword">if</span> (valueChange <span class="operator">=</span><span class="operator">=</span> ValueUp)
        <span class="operator">+</span><span class="operator">+</span>currentHeartRate;
    <span class="keyword">else</span>
        <span class="operator">-</span><span class="operator">-</span>currentHeartRate;
};
<span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="operator">&amp;</span>heartbeatTimer<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qtimer.htm" translate="no">QTimer</a></span><span class="operator">::</span>timeout<span class="operator">,</span> heartbeatProvider);
heartbeatTimer<span class="operator">.</span>start(<span class="number">1000</span>);</pre></div>
<p>In general characteristic and descriptor value updates on the peripheral device use the same methods as connecting Bluetooth Low Energy devices.</p>
<div class="admonition note">
<p><b>Note: </b>To use <a href="./qtbluetooth-qmlmodule.htm" translate="no">QtBluetooth</a> (in both central and peripheral roles) on iOS, you have to provide an Info.plist file containing the usage description. According to the CoreBluetooth's documentation:</p>
</div>
<p>"Important</p>
<p>Your app will crash if its Info.plist doesn’t include usage description keys for the types of data it needs to access. To access Core Bluetooth APIs on apps linked on or after iOS 13, include the NSBluetoothAlwaysUsageDescription key. In iOS 12 and earlier, include NSBluetoothPeripheralUsageDescription to access Bluetooth peripheral data."</p>
</div>
<!-- @@@qtbluetooth-le-overview.html -->
</div>
<p class="copy-notice">
<acronym title="Copyright">©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>