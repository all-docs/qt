<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Custom Input Example | Qt Data Visualization</title>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="./index.htm" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtdatavisualization-index.htm" translate="no">Qt Data Visualization</a></li>
                            <li class="last"><a>Custom Input Example</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">Custom Input Example</h1>
<span class="subtitle"></span>
<!-- $$$custominput-brief -->
<p>Implementing custom input handler in a widget application.</p>
<!-- @@@custominput -->
<!-- $$$custominput-description -->
<div class="descr"> <a name="details"></a>
<p>The Custom Input example shows how to customize the 3D graph controls in a widget application using a custom graph input handler to capture and process mouse events. The code in this example shows also how the camera is controlled by using <a href="./qpropertyanimation.htm" translate="no">QPropertyAnimation</a> to animate the camera and item selection is done on mouseover rather than clicking any mouse buttons. Also the code shows how to implement similar zoom with mouse wheel functionality as the default input handler implements.</p>
<p class="centerAlign"><img alt="" src="./images/custominput-example.png"></p><a name="running-the-example"></a>
<h4 id="running-the-example">Running the Example<a class="plink" href="#running-the-example" title="Direct link to this headline"></a></h4>
<p>To run the example from <a href="http://doc.qt.io/qtcreator/index.html" translate="no">Qt Creator</a>, open the <b>Welcome</b> mode and select the example from <b>Examples</b>. For more information, visit <a href="https://doc.qt.io/qtcreator/creator-build-example-application.html" translate="no">Building and Running an Example</a>.</p>
<a name="replacing-default-input-handling"></a>
<h4 id="replacing-default-input-handling">Replacing Default Input Handling<a class="plink" href="#replacing-default-input-handling" title="Direct link to this headline"></a></h4>
<p>The default input handling mechanism is replaced by setting the active input handler of <a href="./q3dscatter.htm" translate="no">Q3DScatter</a> to <code translate="no">CustomInputHandler</code> that implements the custom behavior.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">m_graph<span class="operator">-</span><span class="operator">&gt;</span>setActiveInputHandler(m_inputHandler);</pre></div>
<a name="implementing-custom-selection-handling"></a>
<h4 id="implementing-custom-selection-handling">Implementing Custom Selection Handling<a class="plink" href="#implementing-custom-selection-handling" title="Direct link to this headline"></a></h4>
<p>The on mouseover selection handling is implemented in the <code translate="no">CustomInputHandler</code> that captures the mouse events. It then stores the last known coordinates to the <a href="./qabstract3dinputhandler.htm#inputPosition-prop" translate="no">QAbstract3DInputHandler::inputPosition</a> property.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> CustomInputHandler<span class="operator">::</span>mouseMoveEvent(<span class="type"><a href="./qmouseevent.htm" translate="no">QMouseEvent</a></span> <span class="operator">*</span>event<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qpoint.htm" translate="no">QPoint</a></span> <span class="operator">&amp;</span>mousePos)
{
    Q_UNUSED(event)
    setInputPosition(mousePos);
}</pre></div>
<p>As the selection is one shot, and is cleared each time a 3D frame is rendered, a timer is setup to retrigger selection so that the selection moves to the item currently under the mouse cursor as the camera animates around the graph even when the mouse cursor is not moving.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">m_selectionTimer <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qtimer.htm" translate="no">QTimer</a></span>(<span class="keyword">this</span>);
m_selectionTimer<span class="operator">-</span><span class="operator">&gt;</span>setInterval(<span class="number">10</span>);
m_selectionTimer<span class="operator">-</span><span class="operator">&gt;</span>setSingleShot(<span class="keyword">false</span>);
<span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(m_selectionTimer<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qtimer.htm" translate="no">QTimer</a></span><span class="operator">::</span>timeout<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span>
                 <span class="operator">&amp;</span>ScatterDataModifier<span class="operator">::</span>triggerSelection);
m_selectionTimer<span class="operator">-</span><span class="operator">&gt;</span>start();</pre></div>
<a name="implementing-custom-zoom-handling"></a>
<h4 id="implementing-custom-zoom-handling">Implementing Custom Zoom Handling<a class="plink" href="#implementing-custom-zoom-handling" title="Direct link to this headline"></a></h4>
<p>The camera has a zoom factor that represents amount of zoom in percentages. In this example the zoom range is limited between 10% and 500%. This range is then divided to four subranges where <code translate="no">angleDelta</code> is scaled to different amount of zoom change based on the current subrange.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> CustomInputHandler<span class="operator">::</span>wheelEvent(<span class="type"><a href="./qwheelevent.htm" translate="no">QWheelEvent</a></span> <span class="operator">*</span>event)
{
    <span class="comment">// Adjust zoom level based on what zoom range we're in.</span>
    <span class="type">int</span> zoomLevel <span class="operator">=</span> scene()<span class="operator">-</span><span class="operator">&gt;</span>activeCamera()<span class="operator">-</span><span class="operator">&gt;</span>zoomLevel();
    <span class="keyword">if</span> (zoomLevel <span class="operator">&gt;</span> <span class="number">100</span>)
        zoomLevel <span class="operator">+</span><span class="operator">=</span> event<span class="operator">-</span><span class="operator">&gt;</span>angleDelta()<span class="operator">.</span>y() <span class="operator">/</span> <span class="number">12</span>;
    <span class="keyword">else</span> <span class="keyword">if</span> (zoomLevel <span class="operator">&gt;</span> <span class="number">50</span>)
        zoomLevel <span class="operator">+</span><span class="operator">=</span> event<span class="operator">-</span><span class="operator">&gt;</span>angleDelta()<span class="operator">.</span>y() <span class="operator">/</span> <span class="number">60</span>;
    <span class="keyword">else</span>
        zoomLevel <span class="operator">+</span><span class="operator">=</span> event<span class="operator">-</span><span class="operator">&gt;</span>angleDelta()<span class="operator">.</span>y() <span class="operator">/</span> <span class="number">120</span>;
    <span class="keyword">if</span> (zoomLevel <span class="operator">&gt;</span> <span class="number">500</span>)
        zoomLevel <span class="operator">=</span> <span class="number">500</span>;
    <span class="keyword">else</span> <span class="keyword">if</span> (zoomLevel <span class="operator">&lt;</span> <span class="number">10</span>)
        zoomLevel <span class="operator">=</span> <span class="number">10</span>;

    scene()<span class="operator">-</span><span class="operator">&gt;</span>activeCamera()<span class="operator">-</span><span class="operator">&gt;</span>setZoomLevel(zoomLevel);
}</pre></div>
<a name="implementing-custom-camera-handling"></a>
<h4 id="implementing-custom-camera-handling">Implementing Custom Camera Handling<a class="plink" href="#implementing-custom-camera-handling" title="Direct link to this headline"></a></h4>
<p>The camera is animated to constantly rotate around the graph with two animations. The rotation around the graph is done with a simple <a href="./qpropertyanimation.htm" translate="no">QPropertyAnimation</a> that just increments during 20 seconds from 0 degrees to 360 degrees and sets the <a href="./q3dcamera.htm#xRotation-prop" translate="no">Q3DCamera::xRotation</a> property.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">m_animationCameraX <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qpropertyanimation.htm" translate="no">QPropertyAnimation</a></span>(m_graph<span class="operator">-</span><span class="operator">&gt;</span>scene()<span class="operator">-</span><span class="operator">&gt;</span>activeCamera()<span class="operator">,</span> <span class="string">"xRotation"</span>);
m_animationCameraX<span class="operator">-</span><span class="operator">&gt;</span>setDuration(<span class="number">20000</span>);
m_animationCameraX<span class="operator">-</span><span class="operator">&gt;</span>setStartValue(<span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span><span class="operator">::</span>fromValue(<span class="number">0.0f</span>));
m_animationCameraX<span class="operator">-</span><span class="operator">&gt;</span>setEndValue(<span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span><span class="operator">::</span>fromValue(<span class="number">360.0f</span>));
m_animationCameraX<span class="operator">-</span><span class="operator">&gt;</span>setLoopCount(<span class="operator">-</span><span class="number">1</span>);</pre></div>
<p>The camera movement up and down is implemented with a <a href="./qsequentialanimationgroup.htm" translate="no">QSequentialAnimationGroup</a> that varies the <a href="./q3dcamera.htm#yRotation-prop" translate="no">Q3DCamera::yRotation</a> property of the camera from 5 degrees to 45 degrees and back with in and out easing.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type"><a href="./qpropertyanimation.htm" translate="no">QPropertyAnimation</a></span> <span class="operator">*</span>upAnimation <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qpropertyanimation.htm" translate="no">QPropertyAnimation</a></span>(m_graph<span class="operator">-</span><span class="operator">&gt;</span>scene()<span class="operator">-</span><span class="operator">&gt;</span>activeCamera()<span class="operator">,</span> <span class="string">"yRotation"</span>);
upAnimation<span class="operator">-</span><span class="operator">&gt;</span>setDuration(<span class="number">9000</span>);
upAnimation<span class="operator">-</span><span class="operator">&gt;</span>setStartValue(<span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span><span class="operator">::</span>fromValue(<span class="number">5.0f</span>));
upAnimation<span class="operator">-</span><span class="operator">&gt;</span>setEndValue(<span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span><span class="operator">::</span>fromValue(<span class="number">45.0f</span>));

<span class="type"><a href="./qpropertyanimation.htm" translate="no">QPropertyAnimation</a></span> <span class="operator">*</span>downAnimation <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qpropertyanimation.htm" translate="no">QPropertyAnimation</a></span>(m_graph<span class="operator">-</span><span class="operator">&gt;</span>scene()<span class="operator">-</span><span class="operator">&gt;</span>activeCamera()<span class="operator">,</span> <span class="string">"yRotation"</span>);
downAnimation<span class="operator">-</span><span class="operator">&gt;</span>setDuration(<span class="number">9000</span>);
downAnimation<span class="operator">-</span><span class="operator">&gt;</span>setStartValue(<span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span><span class="operator">::</span>fromValue(<span class="number">45.0f</span>));
downAnimation<span class="operator">-</span><span class="operator">&gt;</span>setEndValue(<span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span><span class="operator">::</span>fromValue(<span class="number">5.0f</span>));

m_animationCameraY <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qsequentialanimationgroup.htm" translate="no">QSequentialAnimationGroup</a></span>();
m_animationCameraY<span class="operator">-</span><span class="operator">&gt;</span>setLoopCount(<span class="operator">-</span><span class="number">1</span>);
m_animationCameraY<span class="operator">-</span><span class="operator">&gt;</span>addAnimation(upAnimation);
m_animationCameraY<span class="operator">-</span><span class="operator">&gt;</span>addAnimation(downAnimation);</pre></div>
<p><a href="https://code.qt.io/cgit/qt/qtdatavis3d.git/tree/examples/datavisualization/custominput?h=5.15" translate="no">Example project @ code.qt.io</a></p>
</div>
<!-- @@@custominput -->
</div>
<p class="copy-notice">
<acronym title="Copyright">Â©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>