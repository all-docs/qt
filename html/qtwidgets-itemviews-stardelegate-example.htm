<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Star Delegate Example | Qt Widgets</title>
<link rel="canonical" href="https://doc.qt.io/qt-6/qtwidgets-itemviews-stardelegate-example.html">
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="./index.htm" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtwidgets-index.htm" translate="no">Qt Widgets</a></li>
                            <li><a href="./examples-itemviews.htm" translate="no">Item Views Examples</a></li>
                            <li><a>Star Delegate Example</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">Star Delegate Example</h1>
<span class="subtitle"></span>
<!-- $$$itemviews/stardelegate-brief -->
<p>The Star Delegate example shows how to create a delegate that can paint itself and that supports editing.</p>
<!-- @@@itemviews/stardelegate -->
<!-- $$$itemviews/stardelegate-description -->
<div class="descr"> <a name="details"></a>
<p class="centerAlign"><img alt="The Star Delegate Example" src="./images/stardelegate.png"></p><p>When displaying data in a <a href="./qlistview.htm" translate="no">QListView</a>, <a href="./qtableview.htm" translate="no">QTableView</a>, or <a href="./qtreeview.htm" translate="no">QTreeView</a>, the individual items are drawn by a <a href="./model-view-programming.htm#delegate-classes" translate="no">delegate</a>. Also, when the user starts editing an item (for example, by double-clicking the item), the delegate provides an editor widget that is placed on top of the item while editing takes place.</p>
<p>Delegates are subclasses of <a href="./qabstractitemdelegate.htm" translate="no">QAbstractItemDelegate</a>. Qt provides <a href="./qstyleditemdelegate.htm" translate="no">QStyledItemDelegate</a>, which inherits <a href="./qabstractitemdelegate.htm" translate="no">QAbstractItemDelegate</a> and handles the most common data types (notably <code translate="no">int</code> and <a href="./qstring.htm" translate="no">QString</a>). If we need to support custom data types, or want to customize the rendering or the editing for existing data types, we can subclass <a href="./qabstractitemdelegate.htm" translate="no">QAbstractItemDelegate</a> or <a href="./qstyleditemdelegate.htm" translate="no">QStyledItemDelegate</a>. See <a href="./model-view-programming.htm#delegate-classes" translate="no">Delegate Classes</a> for more information about delegates, and <a href="./model-view-programming.htm" translate="no">Model/View Programming</a> if you need a high-level introduction to Qt's model/view architecture (including delegates).</p>
<p>In this example, we will see how to implement a custom delegate to render and edit a "star rating" data type, which can store values such as "1 out of 5 stars".</p>
<p>The example consists of the following classes:</p>
<ul>
<li><code translate="no">StarRating</code> is the custom data type. It stores a rating expressed as stars, such as "2 out of 5 stars" or "5 out of 6 stars".</li>
<li><code translate="no">StarDelegate</code> inherits <a href="./qstyleditemdelegate.htm" translate="no">QStyledItemDelegate</a> and provides support for <code translate="no">StarRating</code> (in addition to the data types already handled by <a href="./qstyleditemdelegate.htm" translate="no">QStyledItemDelegate</a>).</li>
<li><code translate="no">StarEditor</code> inherits <a href="./qwidget.htm" translate="no">QWidget</a> and is used by <code translate="no">StarDelegate</code> to let the user edit a star rating using the mouse.</li>
</ul>
<p>To show the <code translate="no">StarDelegate</code> in action, we will fill a <a href="./qtablewidget.htm" translate="no">QTableWidget</a> with some data and install the delegate on it.</p>
<a name="stardelegate-class-definition"></a>
<h4 id="stardelegate-class-definition">StarDelegate Class Definition<a class="plink" href="#stardelegate-class-definition" title="Direct link to this headline"></a></h4>
<p>Here's the definition of the <code translate="no">StarDelegate</code> class:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">class</span> StarDelegate : <span class="keyword">public</span> <span class="type"><a href="./qstyleditemdelegate.htm" translate="no">QStyledItemDelegate</a></span>
{
    Q_OBJECT
<span class="keyword">public</span>:
    <span class="keyword">using</span> <span class="type"><a href="./qstyleditemdelegate.htm" translate="no">QStyledItemDelegate</a></span><span class="operator">::</span><span class="type"><a href="./qstyleditemdelegate.htm" translate="no">QStyledItemDelegate</a></span>;

    <span class="type">void</span> paint(<span class="type"><a href="./qpainter.htm" translate="no">QPainter</a></span> <span class="operator">*</span>painter<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qstyleoptionviewitem.htm" translate="no">QStyleOptionViewItem</a></span> <span class="operator">&amp;</span>option<span class="operator">,</span>
               <span class="keyword">const</span> <span class="type"><a href="./qmodelindex.htm" translate="no">QModelIndex</a></span> <span class="operator">&amp;</span>index) <span class="keyword">const</span> override;
    <span class="type"><a href="./qsize.htm" translate="no">QSize</a></span> sizeHint(<span class="keyword">const</span> <span class="type"><a href="./qstyleoptionviewitem.htm" translate="no">QStyleOptionViewItem</a></span> <span class="operator">&amp;</span>option<span class="operator">,</span>
                   <span class="keyword">const</span> <span class="type"><a href="./qmodelindex.htm" translate="no">QModelIndex</a></span> <span class="operator">&amp;</span>index) <span class="keyword">const</span> override;
    <span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span> <span class="operator">*</span>createEditor(<span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span> <span class="operator">*</span>parent<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qstyleoptionviewitem.htm" translate="no">QStyleOptionViewItem</a></span> <span class="operator">&amp;</span>option<span class="operator">,</span>
                          <span class="keyword">const</span> <span class="type"><a href="./qmodelindex.htm" translate="no">QModelIndex</a></span> <span class="operator">&amp;</span>index) <span class="keyword">const</span> override;
    <span class="type">void</span> setEditorData(<span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span> <span class="operator">*</span>editor<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qmodelindex.htm" translate="no">QModelIndex</a></span> <span class="operator">&amp;</span>index) <span class="keyword">const</span> override;
    <span class="type">void</span> setModelData(<span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span> <span class="operator">*</span>editor<span class="operator">,</span> <span class="type"><a href="./qabstractitemmodel.htm" translate="no">QAbstractItemModel</a></span> <span class="operator">*</span>model<span class="operator">,</span>
                      <span class="keyword">const</span> <span class="type"><a href="./qmodelindex.htm" translate="no">QModelIndex</a></span> <span class="operator">&amp;</span>index) <span class="keyword">const</span> override;

<span class="keyword">private</span> <span class="keyword">slots</span>:
    <span class="type">void</span> commitAndCloseEditor();
};</pre></div>
<p>All public functions are reimplemented virtual functions from <a href="./qstyleditemdelegate.htm" translate="no">QStyledItemDelegate</a> to provide custom rendering and editing.</p>
<a name="stardelegate-class-implementation"></a>
<h4 id="stardelegate-class-implementation">StarDelegate Class Implementation<a class="plink" href="#stardelegate-class-implementation" title="Direct link to this headline"></a></h4>
<p>The <a href="./qabstractitemdelegate.htm#paint" translate="no">paint()</a> function is reimplemented from <a href="./qstyleditemdelegate.htm" translate="no">QStyledItemDelegate</a> and is called whenever the view needs to repaint an item:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> StarDelegate<span class="operator">::</span>paint(<span class="type"><a href="./qpainter.htm" translate="no">QPainter</a></span> <span class="operator">*</span>painter<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qstyleoptionviewitem.htm" translate="no">QStyleOptionViewItem</a></span> <span class="operator">&amp;</span>option<span class="operator">,</span>
                         <span class="keyword">const</span> <span class="type"><a href="./qmodelindex.htm" translate="no">QModelIndex</a></span> <span class="operator">&amp;</span>index) <span class="keyword">const</span>
{
    <span class="keyword">if</span> (index<span class="operator">.</span>data()<span class="operator">.</span>canConvert<span class="operator">&lt;</span>StarRating<span class="operator">&gt;</span>()) {
        StarRating starRating <span class="operator">=</span> qvariant_cast<span class="operator">&lt;</span>StarRating<span class="operator">&gt;</span>(index<span class="operator">.</span>data());

        <span class="keyword">if</span> (option<span class="operator">.</span>state <span class="operator">&amp;</span> <span class="type"><a href="./qstyle.htm" translate="no">QStyle</a></span><span class="operator">::</span>State_Selected)
            painter<span class="operator">-</span><span class="operator">&gt;</span>fillRect(option<span class="operator">.</span>rect<span class="operator">,</span> option<span class="operator">.</span>palette<span class="operator">.</span>highlight());

        starRating<span class="operator">.</span>paint(painter<span class="operator">,</span> option<span class="operator">.</span>rect<span class="operator">,</span> option<span class="operator">.</span>palette<span class="operator">,</span>
                         StarRating<span class="operator">::</span>EditMode<span class="operator">::</span>ReadOnly);
    } <span class="keyword">else</span> {
        <span class="type"><a href="./qstyleditemdelegate.htm" translate="no">QStyledItemDelegate</a></span><span class="operator">::</span>paint(painter<span class="operator">,</span> option<span class="operator">,</span> index);
    }</pre></div>
<p>The function is invoked once for each item, represented by a <a href="./qmodelindex.htm" translate="no">QModelIndex</a> object from the model. If the data stored in the item is a <code translate="no">StarRating</code>, we paint it ourselves; otherwise, we let <a href="./qstyleditemdelegate.htm" translate="no">QStyledItemDelegate</a> paint it for us. This ensures that the <code translate="no">StarDelegate</code> can handle the most common data types.</p>
<p>If the item is a <code translate="no">StarRating</code>, we draw the background if the item is selected, and we draw the item using <code translate="no">StarRating::paint()</code>, which we will review later.</p>
<p><code translate="no">StartRating</code>s can be stored in a <a href="./qvariant.htm" translate="no">QVariant</a> thanks to the <a href="./qmetatype.htm#Q_DECLARE_METATYPE" translate="no">Q_DECLARE_METATYPE</a>() macro appearing in <code translate="no">starrating.h</code>. More on this later.</p>
<p>The <a href="./qabstractitemdelegate.htm#createEditor" translate="no">createEditor()</a> function is called when the user starts editing an item:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span> <span class="operator">*</span>StarDelegate<span class="operator">::</span>createEditor(<span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span> <span class="operator">*</span>parent<span class="operator">,</span>
                                    <span class="keyword">const</span> <span class="type"><a href="./qstyleoptionviewitem.htm" translate="no">QStyleOptionViewItem</a></span> <span class="operator">&amp;</span>option<span class="operator">,</span>
                                    <span class="keyword">const</span> <span class="type"><a href="./qmodelindex.htm" translate="no">QModelIndex</a></span> <span class="operator">&amp;</span>index) <span class="keyword">const</span>

{
    <span class="keyword">if</span> (index<span class="operator">.</span>data()<span class="operator">.</span>canConvert<span class="operator">&lt;</span>StarRating<span class="operator">&gt;</span>()) {
        StarEditor <span class="operator">*</span>editor <span class="operator">=</span> <span class="keyword">new</span> StarEditor(parent);
        connect(editor<span class="operator">,</span> <span class="operator">&amp;</span>StarEditor<span class="operator">::</span>editingFinished<span class="operator">,</span>
                <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>StarDelegate<span class="operator">::</span>commitAndCloseEditor);
        <span class="keyword">return</span> editor;
    }
    <span class="keyword">return</span> <span class="type"><a href="./qstyleditemdelegate.htm" translate="no">QStyledItemDelegate</a></span><span class="operator">::</span>createEditor(parent<span class="operator">,</span> option<span class="operator">,</span> index);
}</pre></div>
<p>If the item is a <code translate="no">StarRating</code>, we create a <code translate="no">StarEditor</code> and connect its <code translate="no">editingFinished()</code> signal to our <code translate="no">commitAndCloseEditor()</code> slot, so we can update the model when the editor closes.</p>
<p>Here's the implementation of <code translate="no">commitAndCloseEditor()</code>:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> StarDelegate<span class="operator">::</span>commitAndCloseEditor()
{
    StarEditor <span class="operator">*</span>editor <span class="operator">=</span> qobject_cast<span class="operator">&lt;</span>StarEditor <span class="operator">*</span><span class="operator">&gt;</span>(sender());
    <span class="keyword">emit</span> commitData(editor);
    <span class="keyword">emit</span> closeEditor(editor);
}</pre></div>
<p>When the user is done editing, we emit <a href="./qabstractitemdelegate.htm#commitData" translate="no">commitData()</a> and <a href="./qabstractitemdelegate.htm#closeEditor" translate="no">closeEditor()</a> (both declared in <a href="./qabstractitemdelegate.htm" translate="no">QAbstractItemDelegate</a>), to tell the model that there is edited data and to inform the view that the editor is no longer needed.</p>
<p>The <a href="./qabstractitemdelegate.htm#setEditorData" translate="no">setEditorData()</a> function is called when an editor is created to initialize it with data from the model:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> StarDelegate<span class="operator">::</span>setEditorData(<span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span> <span class="operator">*</span>editor<span class="operator">,</span>
                                 <span class="keyword">const</span> <span class="type"><a href="./qmodelindex.htm" translate="no">QModelIndex</a></span> <span class="operator">&amp;</span>index) <span class="keyword">const</span>
{
    <span class="keyword">if</span> (index<span class="operator">.</span>data()<span class="operator">.</span>canConvert<span class="operator">&lt;</span>StarRating<span class="operator">&gt;</span>()) {
        StarRating starRating <span class="operator">=</span> qvariant_cast<span class="operator">&lt;</span>StarRating<span class="operator">&gt;</span>(index<span class="operator">.</span>data());
        StarEditor <span class="operator">*</span>starEditor <span class="operator">=</span> qobject_cast<span class="operator">&lt;</span>StarEditor <span class="operator">*</span><span class="operator">&gt;</span>(editor);
        starEditor<span class="operator">-</span><span class="operator">&gt;</span>setStarRating(starRating);
    } <span class="keyword">else</span> {
        <span class="type"><a href="./qstyleditemdelegate.htm" translate="no">QStyledItemDelegate</a></span><span class="operator">::</span>setEditorData(editor<span class="operator">,</span> index);
    }
}</pre></div>
<p>We simply call <code translate="no">setStarRating()</code> on the editor.</p>
<p>The <a href="./qabstractitemdelegate.htm#setModelData" translate="no">setModelData()</a> function is called to commit data from the editor to the model when editing is finished:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> StarDelegate<span class="operator">::</span>setModelData(<span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span> <span class="operator">*</span>editor<span class="operator">,</span> <span class="type"><a href="./qabstractitemmodel.htm" translate="no">QAbstractItemModel</a></span> <span class="operator">*</span>model<span class="operator">,</span>
                                <span class="keyword">const</span> <span class="type"><a href="./qmodelindex.htm" translate="no">QModelIndex</a></span> <span class="operator">&amp;</span>index) <span class="keyword">const</span>
{
    <span class="keyword">if</span> (index<span class="operator">.</span>data()<span class="operator">.</span>canConvert<span class="operator">&lt;</span>StarRating<span class="operator">&gt;</span>()) {
        StarEditor <span class="operator">*</span>starEditor <span class="operator">=</span> qobject_cast<span class="operator">&lt;</span>StarEditor <span class="operator">*</span><span class="operator">&gt;</span>(editor);
        model<span class="operator">-</span><span class="operator">&gt;</span>setData(index<span class="operator">,</span> <span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span><span class="operator">::</span>fromValue(starEditor<span class="operator">-</span><span class="operator">&gt;</span>starRating()));
    } <span class="keyword">else</span> {
        <span class="type"><a href="./qstyleditemdelegate.htm" translate="no">QStyledItemDelegate</a></span><span class="operator">::</span>setModelData(editor<span class="operator">,</span> model<span class="operator">,</span> index);
    }
}</pre></div>
<p>The <code translate="no">sizeHint()</code> function returns an item's preferred size:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type"><a href="./qsize.htm" translate="no">QSize</a></span> StarDelegate<span class="operator">::</span>sizeHint(<span class="keyword">const</span> <span class="type"><a href="./qstyleoptionviewitem.htm" translate="no">QStyleOptionViewItem</a></span> <span class="operator">&amp;</span>option<span class="operator">,</span>
                             <span class="keyword">const</span> <span class="type"><a href="./qmodelindex.htm" translate="no">QModelIndex</a></span> <span class="operator">&amp;</span>index) <span class="keyword">const</span>
{
    <span class="keyword">if</span> (index<span class="operator">.</span>data()<span class="operator">.</span>canConvert<span class="operator">&lt;</span>StarRating<span class="operator">&gt;</span>()) {
        StarRating starRating <span class="operator">=</span> qvariant_cast<span class="operator">&lt;</span>StarRating<span class="operator">&gt;</span>(index<span class="operator">.</span>data());
        <span class="keyword">return</span> starRating<span class="operator">.</span>sizeHint();
    }
    <span class="keyword">return</span> <span class="type"><a href="./qstyleditemdelegate.htm" translate="no">QStyledItemDelegate</a></span><span class="operator">::</span>sizeHint(option<span class="operator">,</span> index);
}</pre></div>
<p>We simply forward the call to <code translate="no">StarRating</code>.</p>
<a name="stareditor-class-definition"></a>
<h4 id="stareditor-class-definition">StarEditor Class Definition<a class="plink" href="#stareditor-class-definition" title="Direct link to this headline"></a></h4>
<p>The <code translate="no">StarEditor</code> class was used when implementing <code translate="no">StarDelegate</code>. Here's the class definition:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">class</span> StarEditor : <span class="keyword">public</span> <span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span>
{
    Q_OBJECT
<span class="keyword">public</span>:
    StarEditor(<span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span> <span class="operator">*</span>parent <span class="operator">=</span> nullptr);

    <span class="type"><a href="./qsize.htm" translate="no">QSize</a></span> sizeHint() <span class="keyword">const</span> override;
    <span class="type">void</span> setStarRating(<span class="keyword">const</span> StarRating <span class="operator">&amp;</span>starRating) {
        myStarRating <span class="operator">=</span> starRating;
    }
    StarRating starRating() { <span class="keyword">return</span> myStarRating; }

<span class="keyword">signals</span>:
    <span class="type">void</span> editingFinished();

<span class="keyword">protected</span>:
    <span class="type">void</span> paintEvent(<span class="type"><a href="./qpaintevent.htm" translate="no">QPaintEvent</a></span> <span class="operator">*</span>event) override;
    <span class="type">void</span> mouseMoveEvent(<span class="type"><a href="./qmouseevent.htm" translate="no">QMouseEvent</a></span> <span class="operator">*</span>event) override;
    <span class="type">void</span> mouseReleaseEvent(<span class="type"><a href="./qmouseevent.htm" translate="no">QMouseEvent</a></span> <span class="operator">*</span>event) override;

<span class="keyword">private</span>:
    <span class="type">int</span> starAtPosition(<span class="type">int</span> x) <span class="keyword">const</span>;

    StarRating myStarRating;
};</pre></div>
<p>The class lets the user edit a <code translate="no">StarRating</code> by moving the mouse over the editor. It emits the <code translate="no">editingFinished()</code> signal when the user clicks on the editor.</p>
<p>The protected functions are reimplemented from <a href="./qwidget.htm" translate="no">QWidget</a> to handle mouse and paint events. The private function <code translate="no">starAtPosition()</code> is a helper function that returns the number of the star under the mouse pointer.</p>
<a name="stareditor-class-implementation"></a>
<h4 id="stareditor-class-implementation">StarEditor Class Implementation<a class="plink" href="#stareditor-class-implementation" title="Direct link to this headline"></a></h4>
<p>Let's start with the constructor:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">StarEditor<span class="operator">::</span>StarEditor(<span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span> <span class="operator">*</span>parent)
    : <span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span>(parent)
{
    setMouseTracking(<span class="keyword">true</span>);
    setAutoFillBackground(<span class="keyword">true</span>);
}</pre></div>
<p>We enable <a href="./qwidget.htm#mouseTracking-prop" translate="no">mouse tracking</a> on the widget so we can follow the cursor even when the user doesn't hold down any mouse button. We also turn on <a href="./qwidget.htm" translate="no">QWidget</a>'s <a href="./qwidget.htm#autoFillBackground-prop" translate="no">auto-fill background</a> feature to obtain an opaque background. (Without the call, the view's background would shine through the editor.)</p>
<p>The <a href="./qwidget.htm#paintEvent" translate="no">paintEvent()</a> function is reimplemented from <a href="./qwidget.htm" translate="no">QWidget</a>:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> StarEditor<span class="operator">::</span>paintEvent(<span class="type"><a href="./qpaintevent.htm" translate="no">QPaintEvent</a></span> <span class="operator">*</span>)
{
    <span class="type"><a href="./qpainter.htm" translate="no">QPainter</a></span> painter(<span class="keyword">this</span>);
    myStarRating<span class="operator">.</span>paint(<span class="operator">&amp;</span>painter<span class="operator">,</span> rect()<span class="operator">,</span> palette()<span class="operator">,</span>
                       StarRating<span class="operator">::</span>EditMode<span class="operator">::</span>Editable);
}</pre></div>
<p>We simply call <code translate="no">StarRating::paint()</code> to draw the stars, just like we did when implementing <code translate="no">StarDelegate</code>.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> StarEditor<span class="operator">::</span>mouseMoveEvent(<span class="type"><a href="./qmouseevent.htm" translate="no">QMouseEvent</a></span> <span class="operator">*</span>event)
{
    <span class="keyword">const</span> <span class="type">int</span> star <span class="operator">=</span> starAtPosition(event<span class="operator">-</span><span class="operator">&gt;</span>x());

    <span class="keyword">if</span> (star <span class="operator">!</span><span class="operator">=</span> myStarRating<span class="operator">.</span>starCount() <span class="operator">&amp;</span><span class="operator">&amp;</span> star <span class="operator">!</span><span class="operator">=</span> <span class="operator">-</span><span class="number">1</span>) {
        myStarRating<span class="operator">.</span>setStarCount(star);
        update();
    }
    <span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span><span class="operator">::</span>mouseMoveEvent(event);
}</pre></div>
<p>In the mouse event handler, we call <code translate="no">setStarCount()</code> on the private data member <code translate="no">myStarRating</code> to reflect the current cursor position, and we call <a href="./qwidget.htm#update" translate="no">QWidget::update</a>() to force a repaint.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> StarEditor<span class="operator">::</span>mouseReleaseEvent(<span class="type"><a href="./qmouseevent.htm" translate="no">QMouseEvent</a></span> <span class="operator">*</span>event)
{
    <span class="keyword">emit</span> editingFinished();
    <span class="type"><a href="./qwidget.htm" translate="no">QWidget</a></span><span class="operator">::</span>mouseReleaseEvent(event);
}</pre></div>
<p>When the user releases a mouse button, we simply emit the <code translate="no">editingFinished()</code> signal.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">int</span> StarEditor<span class="operator">::</span>starAtPosition(<span class="type">int</span> x) <span class="keyword">const</span>
{
    <span class="keyword">const</span> <span class="type">int</span> star <span class="operator">=</span> (x <span class="operator">/</span> (myStarRating<span class="operator">.</span>sizeHint()<span class="operator">.</span>width()
                           <span class="operator">/</span> myStarRating<span class="operator">.</span>maxStarCount())) <span class="operator">+</span> <span class="number">1</span>;
    <span class="keyword">if</span> (star <span class="operator">&lt;</span><span class="operator">=</span> <span class="number">0</span> <span class="operator">|</span><span class="operator">|</span> star <span class="operator">&gt;</span> myStarRating<span class="operator">.</span>maxStarCount())
        <span class="keyword">return</span> <span class="operator">-</span><span class="number">1</span>;

    <span class="keyword">return</span> star;
}</pre></div>
<p>The <code translate="no">starAtPosition()</code> function uses basic linear algebra to find out which star is under the cursor.</p>
<a name="starrating-class-definition"></a>
<h4 id="starrating-class-definition">StarRating Class Definition<a class="plink" href="#starrating-class-definition" title="Direct link to this headline"></a></h4>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">class</span> StarRating
{
<span class="keyword">public</span>:
    <span class="keyword">enum</span> <span class="keyword">class</span> EditMode { Editable<span class="operator">,</span> ReadOnly };

    <span class="keyword">explicit</span> StarRating(<span class="type">int</span> starCount <span class="operator">=</span> <span class="number">1</span><span class="operator">,</span> <span class="type">int</span> maxStarCount <span class="operator">=</span> <span class="number">5</span>);

    <span class="type">void</span> paint(<span class="type"><a href="./qpainter.htm" translate="no">QPainter</a></span> <span class="operator">*</span>painter<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qrect.htm" translate="no">QRect</a></span> <span class="operator">&amp;</span>rect<span class="operator">,</span>
               <span class="keyword">const</span> <span class="type"><a href="./qpalette.htm" translate="no">QPalette</a></span> <span class="operator">&amp;</span>palette<span class="operator">,</span> EditMode mode) <span class="keyword">const</span>;
    <span class="type"><a href="./qsize.htm" translate="no">QSize</a></span> sizeHint() <span class="keyword">const</span>;
    <span class="type">int</span> starCount() <span class="keyword">const</span> { <span class="keyword">return</span> myStarCount; }
    <span class="type">int</span> maxStarCount() <span class="keyword">const</span> { <span class="keyword">return</span> myMaxStarCount; }
    <span class="type">void</span> setStarCount(<span class="type">int</span> starCount) { myStarCount <span class="operator">=</span> starCount; }
    <span class="type">void</span> setMaxStarCount(<span class="type">int</span> maxStarCount) { myMaxStarCount <span class="operator">=</span> maxStarCount; }

<span class="keyword">private</span>:
    <span class="type"><a href="./qpolygonf.htm" translate="no">QPolygonF</a></span> starPolygon;
    <span class="type"><a href="./qpolygonf.htm" translate="no">QPolygonF</a></span> diamondPolygon;
    <span class="type">int</span> myStarCount;
    <span class="type">int</span> myMaxStarCount;
};

Q_DECLARE_METATYPE(StarRating)</pre></div>
<p>The <code translate="no">StarRating</code> class represents a rating as a number of stars. In addition to holding the data, it is also capable of painting the stars on a <a href="./qpaintdevice.htm" translate="no">QPaintDevice</a>, which in this example is either a view or an editor. The <code translate="no">myStarCount</code> member variable stores the current rating, and <code translate="no">myMaxStarCount</code> stores the highest possible rating (typically 5).</p>
<p>The <code translate="no">Q_DECLARE_METATYPE()</code> macro makes the type <code translate="no">StarRating</code> known to <a href="./qvariant.htm" translate="no">QVariant</a>, making it possible to store <code translate="no">StarRating</code> values in <a href="./qvariant.htm" translate="no">QVariant</a>.</p>
<a name="starrating-class-implementation"></a>
<h4 id="starrating-class-implementation">StarRating Class Implementation<a class="plink" href="#starrating-class-implementation" title="Direct link to this headline"></a></h4>
<p>The constructor initializes <code translate="no">myStarCount</code> and <code translate="no">myMaxStarCount</code>, and sets up the polygons used to draw stars and diamonds:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">StarRating<span class="operator">::</span>StarRating(<span class="type">int</span> starCount<span class="operator">,</span> <span class="type">int</span> maxStarCount)
    : myStarCount(starCount)<span class="operator">,</span>
      myMaxStarCount(maxStarCount)
{
    starPolygon <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="type"><a href="./qpointf.htm" translate="no">QPointF</a></span>(<span class="number">1.0</span><span class="operator">,</span> <span class="number">0.5</span>);
    <span class="keyword">for</span> (<span class="type">int</span> i <span class="operator">=</span> <span class="number">1</span>; i <span class="operator">&lt;</span> <span class="number">5</span>; <span class="operator">+</span><span class="operator">+</span>i)
        starPolygon <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="type"><a href="./qpointf.htm" translate="no">QPointF</a></span>(<span class="number">0.5</span> <span class="operator">+</span> <span class="number">0.5</span> <span class="operator">*</span> std<span class="operator">::</span>cos(<span class="number">0.8</span> <span class="operator">*</span> i <span class="operator">*</span> <span class="number">3.14</span>)<span class="operator">,</span>
                               <span class="number">0.5</span> <span class="operator">+</span> <span class="number">0.5</span> <span class="operator">*</span> std<span class="operator">::</span>sin(<span class="number">0.8</span> <span class="operator">*</span> i <span class="operator">*</span> <span class="number">3.14</span>));

    diamondPolygon <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="type"><a href="./qpointf.htm" translate="no">QPointF</a></span>(<span class="number">0.4</span><span class="operator">,</span> <span class="number">0.5</span>) <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="type"><a href="./qpointf.htm" translate="no">QPointF</a></span>(<span class="number">0.5</span><span class="operator">,</span> <span class="number">0.4</span>)
                   <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="type"><a href="./qpointf.htm" translate="no">QPointF</a></span>(<span class="number">0.6</span><span class="operator">,</span> <span class="number">0.5</span>) <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="type"><a href="./qpointf.htm" translate="no">QPointF</a></span>(<span class="number">0.5</span><span class="operator">,</span> <span class="number">0.6</span>)
                   <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="type"><a href="./qpointf.htm" translate="no">QPointF</a></span>(<span class="number">0.4</span><span class="operator">,</span> <span class="number">0.5</span>);
}</pre></div>
<p>The <code translate="no">paint()</code> function paints the stars in this <code translate="no">StarRating</code> object on a paint device:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> StarRating<span class="operator">::</span>paint(<span class="type"><a href="./qpainter.htm" translate="no">QPainter</a></span> <span class="operator">*</span>painter<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qrect.htm" translate="no">QRect</a></span> <span class="operator">&amp;</span>rect<span class="operator">,</span>
                       <span class="keyword">const</span> <span class="type"><a href="./qpalette.htm" translate="no">QPalette</a></span> <span class="operator">&amp;</span>palette<span class="operator">,</span> EditMode mode) <span class="keyword">const</span>
{
    painter<span class="operator">-</span><span class="operator">&gt;</span>save();

    painter<span class="operator">-</span><span class="operator">&gt;</span>setRenderHint(<span class="type"><a href="./qpainter.htm" translate="no">QPainter</a></span><span class="operator">::</span>Antialiasing<span class="operator">,</span> <span class="keyword">true</span>);
    painter<span class="operator">-</span><span class="operator">&gt;</span>setPen(<span class="type"><a href="./qt.htm" translate="no">Qt</a></span><span class="operator">::</span>NoPen);
    painter<span class="operator">-</span><span class="operator">&gt;</span>setBrush(mode <span class="operator">=</span><span class="operator">=</span> EditMode<span class="operator">::</span>Editable <span class="operator">?</span>
                          palette<span class="operator">.</span>highlight() :
                          palette<span class="operator">.</span>windowText());

    <span class="keyword">const</span> <span class="type">int</span> yOffset <span class="operator">=</span> (rect<span class="operator">.</span>height() <span class="operator">-</span> PaintingScaleFactor) <span class="operator">/</span> <span class="number">2</span>;
    painter<span class="operator">-</span><span class="operator">&gt;</span>translate(rect<span class="operator">.</span>x()<span class="operator">,</span> rect<span class="operator">.</span>y() <span class="operator">+</span> yOffset);
    painter<span class="operator">-</span><span class="operator">&gt;</span>scale(PaintingScaleFactor<span class="operator">,</span> PaintingScaleFactor);

    <span class="keyword">for</span> (<span class="type">int</span> i <span class="operator">=</span> <span class="number">0</span>; i <span class="operator">&lt;</span> myMaxStarCount; <span class="operator">+</span><span class="operator">+</span>i) {
        <span class="keyword">if</span> (i <span class="operator">&lt;</span> myStarCount)
            painter<span class="operator">-</span><span class="operator">&gt;</span>drawPolygon(starPolygon<span class="operator">,</span> <span class="type"><a href="./qt.htm" translate="no">Qt</a></span><span class="operator">::</span>WindingFill);
        <span class="keyword">else</span> <span class="keyword">if</span> (mode <span class="operator">=</span><span class="operator">=</span> EditMode<span class="operator">::</span>Editable)
            painter<span class="operator">-</span><span class="operator">&gt;</span>drawPolygon(diamondPolygon<span class="operator">,</span> <span class="type"><a href="./qt.htm" translate="no">Qt</a></span><span class="operator">::</span>WindingFill);
        painter<span class="operator">-</span><span class="operator">&gt;</span>translate(<span class="number">1.0</span><span class="operator">,</span> <span class="number">0.0</span>);
    }

    painter<span class="operator">-</span><span class="operator">&gt;</span>restore();
}</pre></div>
<p>We first set the pen and brush we will use for painting. The <code translate="no">mode</code> parameter can be either <code translate="no">Editable</code> or <code translate="no">ReadOnly</code>. If <code translate="no">mode</code> is editable, we use the <a href="./qpalette.htm#ColorRole-enum" translate="no">Highlight</a> color instead of the <a href="./qpalette.htm#ColorRole-enum" translate="no">Foreground</a> color to draw the stars.</p>
<p>Then we draw the stars. If we are in <code translate="no">Edit</code> mode, we paint diamonds in place of stars if the rating is less than the highest rating.</p>
<p>The <code translate="no">sizeHint()</code> function returns the preferred size for an area to paint the stars on:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type"><a href="./qsize.htm" translate="no">QSize</a></span> StarRating<span class="operator">::</span>sizeHint() <span class="keyword">const</span>
{
    <span class="keyword">return</span> PaintingScaleFactor <span class="operator">*</span> <span class="type"><a href="./qsize.htm" translate="no">QSize</a></span>(myMaxStarCount<span class="operator">,</span> <span class="number">1</span>);
}</pre></div>
<p>The preferred size is just enough to paint the maximum number of stars. The function is called by both <code translate="no">StarDelegate::sizeHint()</code> and <code translate="no">StarEditor::sizeHint()</code>.</p>
<a name="the-main-function"></a>
<h4 id="the-main-function">The <code translate="no">main()</code> Function<a class="plink" href="#the-main-function" title="Direct link to this headline"></a></h4>
<p>Here's the program's <code translate="no">main()</code> function:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">int</span> main(<span class="type">int</span> argc<span class="operator">,</span> <span class="type">char</span> <span class="operator">*</span>argv<span class="operator">[</span><span class="operator">]</span>)
{
    <span class="type"><a href="./qapplication.htm" translate="no">QApplication</a></span> app(argc<span class="operator">,</span> argv);

    <span class="type"><a href="./qtablewidget.htm" translate="no">QTableWidget</a></span> tableWidget(<span class="number">4</span><span class="operator">,</span> <span class="number">4</span>);
    tableWidget<span class="operator">.</span>setItemDelegate(<span class="keyword">new</span> StarDelegate);
    tableWidget<span class="operator">.</span>setEditTriggers(<span class="type"><a href="./qabstractitemview.htm" translate="no">QAbstractItemView</a></span><span class="operator">::</span>DoubleClicked
                                <span class="operator">|</span> <span class="type"><a href="./qabstractitemview.htm" translate="no">QAbstractItemView</a></span><span class="operator">::</span>SelectedClicked);
    tableWidget<span class="operator">.</span>setSelectionBehavior(<span class="type"><a href="./qabstractitemview.htm" translate="no">QAbstractItemView</a></span><span class="operator">::</span>SelectRows);
    tableWidget<span class="operator">.</span>setHorizontalHeaderLabels({<span class="string">"Title"</span><span class="operator">,</span> <span class="string">"Genre"</span><span class="operator">,</span> <span class="string">"Artist"</span><span class="operator">,</span> <span class="string">"Rating"</span>});

    populateTableWidget(<span class="operator">&amp;</span>tableWidget);

    tableWidget<span class="operator">.</span>resizeColumnsToContents();
    tableWidget<span class="operator">.</span>resize(<span class="number">500</span><span class="operator">,</span> <span class="number">300</span>);
    tableWidget<span class="operator">.</span>show();

    <span class="keyword">return</span> app<span class="operator">.</span>exec();
}</pre></div>
<p>The <code translate="no">main()</code> function creates a <a href="./qtablewidget.htm" translate="no">QTableWidget</a> and sets a <code translate="no">StarDelegate</code> on it. <a href="./qabstractitemview.htm#EditTrigger-enum" translate="no">DoubleClicked</a> and <a href="./qabstractitemview.htm#EditTrigger-enum" translate="no">SelectedClicked</a> are set as <a href="./qabstractitemview.htm#editTriggers-prop" translate="no">edit triggers</a>, so that the editor is opened with a single click when the star rating item is selected.</p>
<p>The <code translate="no">populateTableWidget()</code> function fills the <a href="./qtablewidget.htm" translate="no">QTableWidget</a> with data:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> populateTableWidget(<span class="type"><a href="./qtablewidget.htm" translate="no">QTableWidget</a></span> <span class="operator">*</span>tableWidget)
{
    <span class="keyword">static</span> constexpr <span class="keyword">struct</span> {
        <span class="keyword">const</span> <span class="type">char</span> <span class="operator">*</span>title;
        <span class="keyword">const</span> <span class="type">char</span> <span class="operator">*</span>genre;
        <span class="keyword">const</span> <span class="type">char</span> <span class="operator">*</span>artist;
        <span class="type">int</span> rating;
    } staticData<span class="operator">[</span><span class="operator">]</span> <span class="operator">=</span> {
        { <span class="string">"Mass in B-Minor"</span><span class="operator">,</span> <span class="string">"Baroque"</span><span class="operator">,</span> <span class="string">"J.S. Bach"</span><span class="operator">,</span> <span class="number">5</span> }<span class="operator">,</span>
    ...
        { nullptr<span class="operator">,</span> nullptr<span class="operator">,</span> nullptr<span class="operator">,</span> <span class="number">0</span> }
    };

    <span class="keyword">for</span> (<span class="type">int</span> row <span class="operator">=</span> <span class="number">0</span>; staticData<span class="operator">[</span>row<span class="operator">]</span><span class="operator">.</span>title <span class="operator">!</span><span class="operator">=</span> nullptr; <span class="operator">+</span><span class="operator">+</span>row) {
        <span class="type"><a href="./qtablewidgetitem.htm" translate="no">QTableWidgetItem</a></span> <span class="operator">*</span>item0 <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qtablewidgetitem.htm" translate="no">QTableWidgetItem</a></span>(staticData<span class="operator">[</span>row<span class="operator">]</span><span class="operator">.</span>title);
        <span class="type"><a href="./qtablewidgetitem.htm" translate="no">QTableWidgetItem</a></span> <span class="operator">*</span>item1 <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qtablewidgetitem.htm" translate="no">QTableWidgetItem</a></span>(staticData<span class="operator">[</span>row<span class="operator">]</span><span class="operator">.</span>genre);
        <span class="type"><a href="./qtablewidgetitem.htm" translate="no">QTableWidgetItem</a></span> <span class="operator">*</span>item2 <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qtablewidgetitem.htm" translate="no">QTableWidgetItem</a></span>(staticData<span class="operator">[</span>row<span class="operator">]</span><span class="operator">.</span>artist);
        <span class="type"><a href="./qtablewidgetitem.htm" translate="no">QTableWidgetItem</a></span> <span class="operator">*</span>item3 <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qtablewidgetitem.htm" translate="no">QTableWidgetItem</a></span>;
        item3<span class="operator">-</span><span class="operator">&gt;</span>setData(<span class="number">0</span><span class="operator">,</span>
                       <span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span><span class="operator">::</span>fromValue(StarRating(staticData<span class="operator">[</span>row<span class="operator">]</span><span class="operator">.</span>rating)));

        tableWidget<span class="operator">-</span><span class="operator">&gt;</span>setItem(row<span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> item0);
        tableWidget<span class="operator">-</span><span class="operator">&gt;</span>setItem(row<span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> item1);
        tableWidget<span class="operator">-</span><span class="operator">&gt;</span>setItem(row<span class="operator">,</span> <span class="number">2</span><span class="operator">,</span> item2);
        tableWidget<span class="operator">-</span><span class="operator">&gt;</span>setItem(row<span class="operator">,</span> <span class="number">3</span><span class="operator">,</span> item3);
    }
}</pre></div>
<p>Notice the call to <a href="./qvariant.htm#fromValue" translate="no">QVariant::fromValue</a> to convert a <code translate="no">StarRating</code> to a <a href="./qvariant.htm" translate="no">QVariant</a>.</p>
<a name="possible-extensions-and-suggestions"></a>
<h4 id="possible-extensions-and-suggestions">Possible Extensions and Suggestions<a class="plink" href="#possible-extensions-and-suggestions" title="Direct link to this headline"></a></h4>
<p>There are many ways to customize Qt's <a href="./model-view-programming.htm" translate="no">model/view framework</a>. The approach used in this example is appropriate for most custom delegates and editors. Examples of possibilities not used by the star delegate and star editor are:</p>
<ul>
<li>It is possible to open editors programmatically by calling <a href="./qabstractitemview.htm#edit" translate="no">QAbstractItemView::edit</a>(), instead of relying on edit triggers. This could be used to support other edit triggers than those offered by the <a href="./qabstractitemview.htm#EditTrigger-enum" translate="no">QAbstractItemView::EditTrigger</a> enum. For example, in the Star Delegate example, hovering over an item with the mouse might make sense as a way to pop up an editor.</li>
<li>By reimplementing <a href="./qabstractitemdelegate.htm#editorEvent" translate="no">QAbstractItemDelegate::editorEvent</a>(), it is possible to implement the editor directly in the delegate, instead of creating a separate <a href="./qwidget.htm" translate="no">QWidget</a> subclass.</li>
</ul>
<p><a href="https://code.qt.io/cgit/qt/qtbase.git/tree/examples/widgets/itemviews/stardelegate?h=5.15" translate="no">Example project @ code.qt.io</a></p>
</div>
<!-- @@@itemviews/stardelegate -->
</div>
<p class="copy-notice">
<acronym title="Copyright"></acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>