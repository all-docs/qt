<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Qt JNI Music List | Qt Android Extras</title>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="./index.htm" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtandroidextras-index.htm" translate="no">Qt Android Extras</a></li>
                            <li><a href="./examples-qtandroidextras.htm" translate="no">Qt Android Extras Examples</a></li>
                            <li><a>Qt JNI Music List</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">Qt JNI Music List</h1>
<span class="subtitle"></span>
<!-- $$$musiclist-brief -->
<p>Demonstrates how to exchange data from complex Java objects.</p>
<!-- @@@musiclist -->
<!-- $$$musiclist-description -->
<div class="descr"> <a name="details"></a>
<p class="centerAlign"><img alt="" src="./images/musiclist.png"></p><p>This example demonstrates how to move around data from a Java ArrayList of objects over to Qt. The example uses Android APIs to retrieve a list of music tracks, and displays some information about them with QML.</p>
<p>When the application starts, it displays a list of music tracks, showing the track name, artist, and duration.</p>
<a name="running-the-example"></a>
<h4 id="running-the-example">Running the Example<a class="plink" href="#running-the-example" title="Direct link to this headline"></a></h4>
<p>To run the example from <a href="https://doc.qt.io/qtcreator/index.html" translate="no">Qt Creator</a>, open the <b>Welcome</b> mode and select the example from <b>Examples</b>. For more information, visit <a href="https://doc.qt.io/qtcreator/creator-build-example-application.html" translate="no">Building and Running an Example</a>.</p>
<a name="create-the-music-classes"></a>
<h4 id="create-the-music-classes">Create the Music Classes<a class="plink" href="#create-the-music-classes" title="Direct link to this headline"></a></h4>
<p>Let's create a Java class, <code translate="no">MusicTrack</code>, that defines some of the basic information about a track. In the Java side, create the following:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">class MusicTrack {

    private String title;
    private String artist;
    private long duration;

    MusicTrack (String title, String artist, long duration) {
       this.title = title;
       this.artist = artist;
       this.duration = duration;
    }

   public String getTitle() { return title; }

   public String getArtist() { return artist; }

   public long getDuration() { return duration;  }
}</pre></div>
<p>Create another class with the same variables or information on the C++ side. The definition for <code translate="no">MusicTrack</code> class is the following:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">class</span> MusicTrack : <span class="keyword">public</span> <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span>
{
    Q_OBJECT
    Q_PROPERTY(<span class="type"><a href="./qstring.htm" translate="no">QString</a></span> title READ title CONSTANT)
    Q_PROPERTY(<span class="type"><a href="./qstring.htm" translate="no">QString</a></span> artist READ artist CONSTANT)
    Q_PROPERTY(<span class="type">long</span> duration READ duration CONSTANT)

<span class="keyword">public</span>:
    MusicTrack(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> title<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> artist<span class="operator">,</span> <span class="keyword">const</span> <span class="type">long</span> duration<span class="operator">,</span> <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span> <span class="operator">*</span>parent <span class="operator">=</span> nullptr)
        : <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span>(parent)<span class="operator">,</span> m_title(title)<span class="operator">,</span> m_artist(artist)<span class="operator">,</span> m_duration(duration) {}

    <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> title() <span class="keyword">const</span> { <span class="keyword">return</span> m_title; }
    <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> artist() <span class="keyword">const</span> { <span class="keyword">return</span> m_artist; }
    <span class="type">long</span> duration() <span class="keyword">const</span> { <span class="keyword">return</span> m_duration; }

<span class="keyword">private</span>:
    <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> m_title;
    <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> m_artist;
    <span class="type">long</span> m_duration;
};</pre></div>
<div class="admonition note">
<p><b>Note: </b>The <code translate="no">MusicTrack</code> class must be a <a href="./qobject.htm" translate="no">QObject</a>-derived class to be used with as a QML context property. For more information, see <a href="./qtqml-cppintegration-overview.htm" translate="no">QML and C++ Integration</a>.</p>
</div>
<a name="fetch-the-music-list"></a>
<h4 id="fetch-the-music-list">Fetch the Music List<a class="plink" href="#fetch-the-music-list" title="Direct link to this headline"></a></h4>
<p>To retrieve the music list, the Android APIs are used. Add the following method to find music tracks that are available on the system. This method returns an ArrayList of <code translate="no">MusicTrack</code>.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">package org.qtproject.example.musiclist;

import android.content.ContentResolver;
import android.content.Context;
import android.database.Cursor;
import android.net.Uri;
import android.provider.MediaStore;
import java.util.ArrayList;

public class MusicList {

   static ArrayList&lt;MusicTrack&gt; fetchMusicList(Context context) {
        ArrayList&lt;MusicTrack&gt; musicList = new ArrayList&lt;MusicTrack&gt;();
        Cursor songCursor;

        try {
            ContentResolver contentResolver = context.getContentResolver();
            Uri songUri = MediaStore.Audio.Media.EXTERNAL_CONTENT_URI;
            songCursor = contentResolver.query(songUri, null, null, null, null);
        } catch (SecurityException e) {
            e.printStackTrace();
            return musicList;
        }

        if (songCursor != null &amp;&amp; songCursor.moveToFirst())
        {
            int title = songCursor.getColumnIndexOrThrow(MediaStore.Audio.Media.TITLE);
            int artist = songCursor.getColumnIndexOrThrow(MediaStore.Audio.Media.ARTIST);
            int duration = duration = songCursor.getColumnIndexOrThrow(MediaStore.Audio.Media.DURATION);

            do {
                String currentTitle = songCursor.getString(title);
                String currentArtist = songCursor.getString(artist);
                long currentDuration = songCursor.getLong(duration);
                musicList.add(new MusicTrack(currentTitle, currentArtist, currentDuration));
            } while (songCursor.moveToNext());
        }

        if (songCursor != null)
            songCursor.close();

        return musicList;
    }
}</pre></div>
<p>Using the JNI helpers provided with Qt, call the previous method to first get an <a href="./qandroidjniobject.htm" translate="no">QAndroidJniObject</a> containing an ArrayList of objects. In the C++ code, you need to go through the Java ArrayList and create a parallel list on C++. Add the following lines to do that:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    <span class="type"><a href="./qandroidjniobject.htm" translate="no">QAndroidJniObject</a></span> musicList <span class="operator">=</span> <span class="type"><a href="./qandroidjniobject.htm" translate="no">QAndroidJniObject</a></span><span class="operator">::</span>callStaticObjectMethod(
        <span class="string">"org/qtproject/example/musiclist/MusicList"</span><span class="operator">,</span>
        <span class="string">"fetchMusicList"</span><span class="operator">,</span>
        <span class="string">"(Landroid/content/Context;)Ljava/util/ArrayList;"</span><span class="operator">,</span>
        <span class="type"><a href="./qtandroid.htm" translate="no">QtAndroid</a></span><span class="operator">::</span>androidContext()<span class="operator">.</span>object());

    <span class="keyword">for</span> (<span class="type">int</span> i <span class="operator">=</span> <span class="number">0</span>; i <span class="operator">&lt;</span> musicList<span class="operator">.</span>callMethod<span class="operator">&lt;</span>jint<span class="operator">&gt;</span>(<span class="string">"size"</span>); <span class="operator">+</span><span class="operator">+</span>i) {
        <span class="type"><a href="./qandroidjniobject.htm" translate="no">QAndroidJniObject</a></span> track <span class="operator">=</span> musicList<span class="operator">.</span>callObjectMethod(<span class="string">"get"</span><span class="operator">,</span> <span class="string">"(I)Ljava/lang/Object;"</span><span class="operator">,</span> i);
        <span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> title <span class="operator">=</span> track<span class="operator">.</span>callObjectMethod(<span class="string">"getTitle"</span><span class="operator">,</span> <span class="string">"()Ljava/lang/String;"</span>)<span class="operator">.</span>toString();
        <span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> artist <span class="operator">=</span> track<span class="operator">.</span>callObjectMethod(<span class="string">"getArtist"</span><span class="operator">,</span> <span class="string">"()Ljava/lang/String;"</span>)<span class="operator">.</span>toString();
        <span class="keyword">const</span> <span class="type">long</span> duration <span class="operator">=</span> track<span class="operator">.</span>callMethod<span class="operator">&lt;</span>jlong<span class="operator">&gt;</span>(<span class="string">"getDuration"</span>);
        m_assembledMusicList<span class="operator">.</span>append(<span class="keyword">new</span> MusicTrack(title<span class="operator">,</span> artist<span class="operator">,</span> duration<span class="operator">,</span> <span class="keyword">this</span>));
    }</pre></div>
<p>Then, add a function to return the resulted <a href="./qlist.htm" translate="no">QList</a>:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type"><a href="./qlist.htm" translate="no">QList</a></span><span class="operator">&lt;</span>MusicTrack <span class="operator">*</span><span class="operator">&gt;</span> MusicList<span class="operator">::</span>assembledMusicList() <span class="keyword">const</span>
{
    <span class="keyword">return</span> m_assembledMusicList;
}</pre></div>
<p>To display the music list, create a <a href="./qml-qtquick-listview.htm" translate="no">ListView</a> that uses the <a href="./qlist.htm" translate="no">QList</a> as a property. Register the property as follows:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    MusicList <span class="operator">*</span>musicList <span class="operator">=</span> <span class="keyword">new</span> MusicList(<span class="operator">&amp;</span>app);
    engine<span class="operator">.</span>rootContext()<span class="operator">-</span><span class="operator">&gt;</span>setContextProperty(QLatin1String(<span class="string">"musiclist"</span>)<span class="operator">,</span>
                                             <span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span><span class="operator">::</span>fromValue(musicList<span class="operator">-</span><span class="operator">&gt;</span>assembledMusicList()));</pre></div>
<p>In the QML code, define the model of the <a href="./qml-qtquick-listview.htm" translate="no">ListView</a> as follows:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">        <span class="name">model</span>: <span class="name">musiclist</span></pre></div>
<p><a href="https://code.qt.io/cgit/qt/qtandroidextras.git/tree/examples/androidextras/musiclist?h=5.15" translate="no">Example project @ code.qt.io</a></p>
</div>
<p><b>See also </b><a href="./android.htm" translate="no">Qt for Android</a> and <a href="./qtandroidextras-index.htm" translate="no">Qt Android Extras</a>.</p>
<!-- @@@musiclist -->
</div>
<p class="copy-notice">
<acronym title="Copyright">Â©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>