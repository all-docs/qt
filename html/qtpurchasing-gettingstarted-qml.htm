<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Getting Started with Qt Purchasing in QML | Qt Purchasing</title>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="./index.htm" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtpurchasing-index.htm" translate="no">Qt Purchasing</a></li>
                            <li><a>Getting Started with Qt Purchasing in QML</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">Getting Started with Qt Purchasing in QML</h1>
<span class="subtitle"></span>
<!-- $$$qtpurchasing-gettingstarted-qml.html-description -->
<div class="descr"> <a name="details"></a>
<p>This guide assumes that you have registered the in-app products for your application in the external store. For more information about registering products, see <a href="./qtpurchasing-googleplay.htm" translate="no">Registering Products in Google Play</a> and <a href="./qtpurchasing-appstore.htm" translate="no">Registering Products in App Store</a></p>
<a name="preparing-the-application"></a>
<h2 id="preparing-the-application">Preparing The Application<a class="plink" href="#preparing-the-application" title="Direct link to this headline"></a></h2>
<p>Use the following <code translate="no">import</code> statement in the QML files to access the Qt Purchasing QML types:</p>
<div class="pre"><pre class="qml prettyprint" translate="no">import QtPurchasing 1.15</pre></div>
<p>Add the following statement to your <code translate="no">.pro</code> file to link against the Qt Purchasing library:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">QT <span class="operator">+</span><span class="operator">=</span> purchasing</pre></div>
<a name="registering-products"></a>
<h2 id="registering-products">Registering Products<a class="plink" href="#registering-products" title="Direct link to this headline"></a></h2>
<p>Before you can operate on the products in your code, they must be registered in the QML graph. You start by making a <a href="./qml-qtpurchasing-store.htm" translate="no">Store</a> item, and then create each product as a child of this.</p>
<div class="pre"><pre class="qml prettyprint" translate="no"><span class="type"><a href="./qml-qtpurchasing-store.htm" translate="no">Store</a></span> {
    <span class="type"><a href="./qml-qtpurchasing-product.htm" translate="no">Product</a></span> {
        <span class="name">identifier</span>: <span class="string">"consumableProduct"</span>
        <span class="name">type</span>: <span class="name">Product</span>.<span class="name">Consumable</span>

        <span class="comment">// ...</span>
    }

    <span class="type"><a href="./qml-qtpurchasing-product.htm" translate="no">Product</a></span> {
        <span class="name">identifier</span>: <span class="string">"unlockableProduct"</span>
        <span class="name">type</span>: <span class="name">Product</span>.<span class="name">Unlockable</span>

        <span class="comment">// ...</span>
    }
}</pre></div>
<p>As you can see, there are consumable products and unlockable products. The former can be purchased any number of times by the same user, while the latter can only be purchased once.</p>
<a name="the-product-declaration"></a>
<h2 id="the-product-declaration">The Product Declaration<a class="plink" href="#the-product-declaration" title="Direct link to this headline"></a></h2>
<p>For each product you must fill out the <code translate="no">identifier</code>, before the product can be queried from the external store. You should also always add a <a href="./qml-qtpurchasing-product.htm#onPurchaseSucceeded-signal" translate="no">onPurchaseSucceeded</a> and a <a href="./qml-qtpurchasing-product.htm#onPurchaseFailed-signal" translate="no">onPurchaseFailed</a> handler if you intend to provide the option to purchase the products. If you are also using the restore functionality, you should add a <a href="./qml-qtpurchasing-product.htm#onPurchaseRestored-signal" translate="no">onPurchaseRestored</a> handler to your unlockable products.</p>
<p>The signal handlers should handle the incoming transaction. Once the transaction has been handled appropriately, it should be finalized. For instance, when a purchase has succeeded, it's appropriate to save information about the purchased product in persistent storage, so that this product can still be available the next time the application launches.</p>
<p>The following example calls custom methods to save data about a succeeded purchase so that it survives across application runs. After verifying that the data has been stored, it finalizes the transaction. When the transaction has failed, it displays information about the failure to the user and finalizes the transaction.</p>
<div class="pre"><pre class="qml prettyprint" translate="no"><span class="type"><a href="./qml-qtpurchasing-store.htm" translate="no">Store</a></span> {
    <span class="name">id</span>: <span class="name">store</span>
    <span class="type"><a href="./qml-qtpurchasing-product.htm" translate="no">Product</a></span> {
        <span class="name">id</span>: <span class="name">healthPotionProduct</span>
        <span class="name">identifier</span>: <span class="string">"healthPotion"</span>
        <span class="name">type</span>: <span class="name">Product</span>.<span class="name">Consumable</span>

        property <span class="type"><a href="./qml-bool.htm" translate="no">bool</a></span> <span class="name">purchasing</span>: <span class="number">false</span>

        <span class="name">onPurchaseSucceeded</span>: {
            <span class="keyword">if</span> (!<span class="name">hasAlreadyStoredTransaction</span>(<span class="name">transaction</span>.<span class="name">orderId</span>)) {
                ++<span class="name">healthPotions</span>
                <span class="keyword">if</span> (!<span class="name">addHealthPotionToPersistentStorage</span>(<span class="name">transaction</span>.<span class="name">orderId</span>)) {
                    <span class="name">popupErrorDialog</span>(<span class="name">qsTr</span>(<span class="string">"Unable to write to persistent storage. Please make sure there is sufficient space and restart."</span>))
                } <span class="keyword">else</span> {
                    <span class="name">transaction</span>.<span class="name">finalize</span>()
                }
            }

            <span class="comment">// Reset purchasing flag</span>
            <span class="name">purchasing</span> <span class="operator">=</span> <span class="number">false</span>
        }

        <span class="name">onPurchaseFailed</span>: {
            <span class="name">popupErrorDialog</span>(<span class="name">qsTr</span>(<span class="string">"Purchase not completed."</span>))
            <span class="name">transaction</span>.<span class="name">finalize</span>()

            <span class="comment">// Reset purchasing flag</span>
            <span class="name">purchasing</span> <span class="operator">=</span> <span class="number">false</span>
        }
    }
}</pre></div>
<p>If a transaction is not finalized, it will be called again for the same transaction the next time the application starts up, providing another chance to store the data. The transaction for a consumable product has to be finalized before the product can be purchased again.</p>
<a name="purchasing-a-product"></a>
<h2 id="purchasing-a-product">Purchasing A Product<a class="plink" href="#purchasing-a-product" title="Direct link to this headline"></a></h2>
<p>In order to purchase a product, call the object's purchase() method. This launches a platform-specific, asynchronous process to purchase the product, for example by requesting the user's password and confirmation of the purchase. In most cases, you should make sure that the application UI is not accepting input while the purchasing request is being processed, as this is not handled automatically on all platforms.</p>
<p>The following example adds a button to be used with the example product in the previous section:</p>
<div class="pre"><pre class="qml prettyprint" translate="no"><span class="type"><a href="./qml-qtquick-rectangle.htm" translate="no">Rectangle</a></span> {
    <span class="name">id</span>: <span class="name">button</span>
    <span class="name">width</span>: <span class="number">100</span>
    <span class="name">height</span>: <span class="number">50</span>

    <span class="type"><a href="./qml-qtquick-text.htm" translate="no">Text</a></span> {
        <span class="name">anchors</span>.centerIn: <span class="name">parent</span>
        <span class="name">text</span>: <span class="name">qsTr</span>(<span class="string">"Buy health potion for only "</span> <span class="operator">+</span> <span class="name">healthPotionProduct</span>.<span class="name">price</span> <span class="operator">+</span> <span class="string">"!"</span>)
    }

    <span class="type"><a href="./qml-qtquick-mousearea.htm" translate="no">MouseArea</a></span> {
        <span class="name">enabled</span>: !<span class="name">healthPotionProduct</span>.<span class="name">purchasing</span> <span class="operator">&amp;&amp;</span> <span class="name">healthPotionProduct</span>.<span class="name">status</span> <span class="operator">===</span> <span class="name">Product</span>.<span class="name">Registered</span>
        <span class="name">anchors</span>.fill: <span class="name">parent</span>
        <span class="name">onClicked</span>: {
            <span class="name">healthPotionProduct</span>.<span class="name">purchasing</span> <span class="operator">=</span> <span class="number">true</span>
            <span class="name">healthPotionProduct</span>.<span class="name">purchase</span>()
        }
    }
}</pre></div>
<p>When the button is clicked, the purchase process is started. At some point in the future, either the <a href="./qml-qtpurchasing-product.htm#onPurchaseFailed-signal" translate="no">onPurchaseFailed</a> handler will be called (for example if the user cancels the transaction), or the <a href="./qml-qtpurchasing-product.htm#onPurchaseSucceeded-signal" translate="no">onPurchaseSucceeded</a> handler will be called.</p>
<div class="admonition note">
<p><b>Note: </b>The button is only enabled if the product's status is set to Registered. The registration process for a product is asynchronous, so purchases attempted on a product before it has been successfully registered will always fail.</p>
</div>
<a name="restoring-previously-purchased-products"></a>
<h2 id="restoring-previously-purchased-products">Restoring Previously Purchased Products<a class="plink" href="#restoring-previously-purchased-products" title="Direct link to this headline"></a></h2>
<p>If the application is uninstalled and subsequently reinstalled (or installed by the same user on a different device) you should provide a way to restore the previously purchased unlockable products in the external market place.</p>
<p>To start the process of restoring purchases, you should call the restorePurchases() method in the <a href="./qml-qtpurchasing-store.htm" translate="no">Store</a> object. This will cause the onPurchaseRestored handler to be called in each of the application's unlockable products that has previously been purchased by the current user.</p>
<p>Continuing on the example from before, which could be some sort of role-playing computer game, lets imagine that the game has downloadable content that you can buy to expand the game further. This should be an unlockable product, because the user should not have to purchase it more than once.</p>
<div class="pre"><pre class="qml prettyprint" translate="no"><span class="type"><a href="./qml-qtpurchasing-store.htm" translate="no">Store</a></span> {
    <span class="name">id</span>: <span class="name">store</span>

    <span class="comment">// ... other products</span>

    <span class="type"><a href="./qml-qtpurchasing-product.htm" translate="no">Product</a></span> {
        <span class="name">id</span>: <span class="name">dlcForestOfFooBarProduct</span>
        <span class="name">identifier</span>: <span class="string">"dlcForestOfFooBar"</span>
        <span class="name">type</span>: <span class="name">Product</span>.<span class="name">Unlockable</span>

        property <span class="type"><a href="./qml-bool.htm" translate="no">bool</a></span> <span class="name">purchasing</span>: <span class="number">false</span>

        <span class="name">onPurchaseSucceeded</span>: {
            <span class="keyword">if</span> (!<span class="name">hasMap</span>(<span class="string">"forestOfFooBar.map"</span>)) {
                <span class="keyword">if</span> (!<span class="name">downloadExtraMap</span>(<span class="string">"forestOfFooBar.map"</span>)) {
                    <span class="name">popupErrorDialog</span>(<span class="name">qsTr</span>(<span class="string">"Unable to download The Forest of FooBar map. Please make sure there is sufficient space and restart."</span>))
                } <span class="keyword">else</span> {
                    <span class="name">transaction</span>.<span class="name">finalize</span>()
                }
            }

            <span class="comment">// Reset purchasing flag</span>
            <span class="name">purchasing</span> <span class="operator">=</span> <span class="number">false</span>
        }

        <span class="name">onPurchaseFailed</span>: {
            <span class="name">popupErrorDialog</span>(<span class="name">qsTr</span>(<span class="string">"Purchase not completed."</span>))
            <span class="name">transaction</span>.<span class="name">finalize</span>()

            <span class="comment">// Reset purchasing flag</span>
            <span class="name">purchasing</span> <span class="operator">=</span> <span class="number">false</span>
        }

        <span class="name">onPurchaseRestored</span>: {
            <span class="keyword">if</span> (!<span class="name">hasMap</span>(<span class="string">"forestOfFooBar.map"</span>)) {
                <span class="keyword">if</span> (!<span class="name">downloadExtraMap</span>(<span class="string">"forestOfFooBar.map"</span>)) {
                    <span class="name">popupErrorDialog</span>(<span class="name">qsTr</span>(<span class="string">"Unable to download The Forest of FooBar map. Please make sure there is sufficient space and restart."</span>))
                } <span class="keyword">else</span> {
                    <span class="name">transaction</span>.<span class="name">finalize</span>()
                }
            }
        }
    }
}</pre></div>
<p>If a user buys the downloadable content and later either installs the game on another device or uninstalls and reinstalls the game, you can provide a way to restore the purchase, such as the following button:</p>
<div class="pre"><pre class="qml prettyprint" translate="no"><span class="type"><a href="./qml-qtquick-rectangle.htm" translate="no">Rectangle</a></span> {
    <span class="name">id</span>: <span class="name">restoreButton</span>
    <span class="name">width</span>: <span class="number">100</span>
    <span class="name">height</span>: <span class="number">50</span>

    <span class="type"><a href="./qml-qtquick-text.htm" translate="no">Text</a></span> {
        <span class="name">anchors</span>.centerIn: <span class="name">parent</span>
        <span class="name">text</span>: <span class="string">"Restore previously purchased content"</span>
    }

    <span class="type"><a href="./qml-qtquick-mousearea.htm" translate="no">MouseArea</a></span> {
        <span class="name">anchors</span>.fill: <span class="name">parent</span>
        <span class="name">onClicked</span>: {
            <span class="name">store</span>.<span class="name">restorePurchases</span>()
        }
    }
}</pre></div>
<p>Restoring purchases should always be done as a reaction to user input, as it may present a password dialog on some platforms. Calling the restorePurchases() method launches the restore process asynchronously. At some point in the future the onPurchaseRestored handler will be called if the product has previously been purchased.</p>
<div class="admonition note">
<p><b>Note: </b>While the function behaves as documented on Android, this functionality is technically not needed there. The reason for this is that the Android device manages all unlockable purchases with no intervention from the application. If an application is uninstalled and reinstalled (or installed on a different device) on Android, then onPurchaseSucceeded will be called for each previously purchased, unlockable product when the application starts up.</p>
</div>
</div>
<!-- @@@qtpurchasing-gettingstarted-qml.html -->
</div>
<p class="copy-notice">
<acronym title="Copyright">Â©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>