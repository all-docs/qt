<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Android Service with QAndroidBinder | Qt Android Extras</title>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="./index.htm" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtandroidextras-index.htm" translate="no">Qt Android Extras</a></li>
                            <li><a href="./examples-qtandroidextras.htm" translate="no">Qt Android Extras Examples</a></li>
                            <li><a>Android Service with QAndroidBinder</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">Android Service with QAndroidBinder</h1>
<span class="subtitle"></span>
<!-- $$$services/servicebinder-brief -->
<p>Demonstrates how to run an Android service in a separate process, and how to communicate between the service process and the main process using <a href="./qandroidbinder.htm" translate="no">QAndroidBinder</a>.</p>
<!-- @@@services/servicebinder -->
<!-- $$$services/servicebinder-description -->
<div class="descr"> <a name="details"></a>
<p class="centerAlign"><img alt="" src="./images/androidservices.png"></p><p>This example demonstrates how to create and run an Android service in a separate process and using a separate <code translate="no">.so</code> lib file, and then exchange data between the two processes using <a href="./qandroidbinder.htm" translate="no">QAndroidBinder</a>.</p>
<p>When clicking the <b translate="no">Send to Service</b> button, the name entered in the QML view, Qt, in this case, is sent to the Android service. Then, the service replies back with the message <code translate="no">Hello Qt</code> which is printed in the QML view.</p>
<a name="running-the-example"></a>
<h4 id="running-the-example">Running the Example<a class="plink" href="#running-the-example" title="Direct link to this headline"></a></h4>
<p>To run the example from <a href="https://doc.qt.io/qtcreator/index.html" translate="no">Qt Creator</a>, open the <b>Welcome</b> mode and select the example from <b>Examples</b>. For more information, visit <a href="https://doc.qt.io/qtcreator/creator-build-example-application.html" translate="no">Building and Running an Example</a>.</p>
<a name="create-the-service"></a>
<h4 id="create-the-service">Create the Service<a class="plink" href="#create-the-service" title="Direct link to this headline"></a></h4>
<p>To start a service in its own process, extend the <code translate="no">QtService</code> class for your service. Extending <code translate="no">QtService</code> allows the service to load the necessary Qt libraries used for Qt.</p>
<p>Start by creating the Java service class. The following class extends <code translate="no">QtService</code> and acts as your service entry point:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">package org.qtproject.example.qtandroidservice;

import android.content.Context;
import android.content.Intent;
import org.qtproject.qt5.android.bindings.QtService;
import android.util.Log;

public class QtAndroidService extends QtService {

    private static final String TAG = "QtAndroidService";

    @Override
    public void onCreate() {
        super.onCreate();
        Log.i(TAG, "Creating Service");
    }

    @Override
    public void onDestroy() {
        super.onDestroy();
        Log.i(TAG, "Destroying Service");
    }
}</pre></div>
<p>This class can have any logic you want using Java code. However, you don't need any logic to communicate with Qt as that will be done using <a href="./qandroidbinder.htm" translate="no">QAndroidBinder</a>.</p>
<a name="manage-the-androidmanifest-xml-file"></a>
<h4 id="manage-the-androidmanifest-xml-file">Manage the AndroidManifest.xml File<a class="plink" href="#manage-the-androidmanifest-xml-file" title="Direct link to this headline"></a></h4>
<p>To use the service, it must be declared in the <code translate="no">AndroidManifest.xml</code> file as follows:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">&lt;service android:process=":qt_service" android:name=".QtAndroidService"&gt;

        &lt;meta-data android:name="android.app.lib_name" android:value="service"/&gt;
        &lt;meta-data android:name="android.app.qt_sources_resource_id" android:resource="@array/qt_sources"/&gt;
        &lt;meta-data android:name="android.app.repository" android:value="default"/&gt;
        &lt;meta-data android:name="android.app.qt_libs_resource_id" android:resource="@array/qt_libs"/&gt;
        &lt;meta-data android:name="android.app.bundled_libs_resource_id" android:resource="@array/bundled_libs"/&gt;
        &lt;!-- Deploy Qt libs as part of package --&gt;
        &lt;meta-data android:name="android.app.bundle_local_qt_libs" android:value="-- %%BUNDLE_LOCAL_QT_LIBS%% --"/&gt;

        &lt;!-- Run with local libs --&gt;
        &lt;meta-data android:name="android.app.use_local_qt_libs" android:value="-- %%USE_LOCAL_QT_LIBS%% --"/&gt;
        &lt;meta-data android:name="android.app.libs_prefix" android:value="/data/local/tmp/qt/"/&gt;
        &lt;meta-data android:name="android.app.load_local_libs_resource_id" android:resource="@array/load_local_libs"/&gt;
        &lt;meta-data android:name="android.app.load_local_jars" android:value="-- %%INSERT_LOCAL_JARS%% --"/&gt;
        &lt;meta-data android:name="android.app.static_init_classes" android:value="-- %%INSERT_INIT_CLASSES%% --"/&gt;
        &lt;!-- Run with local libs --&gt;

        &lt;!-- Background running --&gt;
        &lt;meta-data android:name="android.app.background_running" android:value="true"/&gt;
        &lt;!-- Background running --&gt;
    &lt;/service&gt;</pre></div>
<p>The important part of this service declaration is the <code translate="no">lib_name</code> part. It will ensure that the service is run by the service's own lib file:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">        &lt;meta-data android:name="android.app.lib_name" android:value="service"/&gt;</pre></div>
<a name="handle-the-service-start"></a>
<h4 id="handle-the-service-start">Handle the Service Start<a class="plink" href="#handle-the-service-start" title="Direct link to this headline"></a></h4>
<p>Create a sub-project for the service, as follows:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">TEMPLATE = lib
TARGET = service
CONFIG += dll
QT += core androidextras

HEADERS += androidbinder.h

SOURCES += \
    service_main.cpp \
    androidbinder.cpp</pre></div>
<p>In <code translate="no">androidbinder.cpp</code>, implement a class that inherits <a href="./qandroidbinder.htm" translate="no">QAndroidBinder</a>. This is the binder that the main application will use to connect to the service by binding to it. <a href="./qandroidbinder.htm#onTransact" translate="no">QAndroidBinder::onTransact</a>() uses a <code translate="no">code</code> integer to differentiate between actions. Use a <code translate="no">switch</code> case or <code translate="no">if</code> conditions to handle all expected actions that the binder could expect:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">bool AndroidBinder<span class="operator">::</span>onTransact(<span class="type">int</span> code<span class="operator">,</span>
                               <span class="keyword">const</span> <span class="type"><a href="./qandroidparcel.htm" translate="no">QAndroidParcel</a></span> <span class="operator">&amp;</span>data<span class="operator">,</span>
                               <span class="keyword">const</span> <span class="type"><a href="./qandroidparcel.htm" translate="no">QAndroidParcel</a></span> <span class="operator">&amp;</span>reply<span class="operator">,</span>
                               <span class="type"><a href="./qandroidbinder.htm" translate="no">QAndroidBinder</a></span><span class="operator">::</span>CallType flags)
{
    <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> TAG <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">": onTransact(), code "</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> code <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">", flags "</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="type">int</span>(flags);

    <span class="keyword">switch</span> (code) {
    <span class="keyword">case</span> <span class="number">1</span>: {
        <span class="type"><a href="./qandroidbinder.htm" translate="no">QAndroidBinder</a></span> binder <span class="operator">=</span> data<span class="operator">.</span>readBinder();

        <span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> name(data<span class="operator">.</span>readData());
        <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> TAG <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">": onTransact() received name "</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> name;

        reply<span class="operator">.</span>writeVariant(<span class="string">"Hello "</span> <span class="operator">+</span> name);
    } <span class="keyword">break</span>;
    <span class="keyword">default</span>:
        <span class="type"><a href="./qandroidbinder.htm" translate="no">QAndroidBinder</a></span> binder <span class="operator">=</span> data<span class="operator">.</span>readBinder();

        <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> TAG <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">": onTransact() received non-name data"</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> data<span class="operator">.</span>readVariant();
        reply<span class="operator">.</span>writeVariant(<span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span>(<span class="string">"Cannot process this!"</span>));

        <span class="comment">// send back message</span>
        <span class="type"><a href="./qandroidparcel.htm" translate="no">QAndroidParcel</a></span> sendData<span class="operator">,</span> replyData;
        sendData<span class="operator">.</span>writeVariant(<span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span>(<span class="string">"Send me only names!"</span>));
        binder<span class="operator">.</span>transact(<span class="number">0</span><span class="operator">,</span> sendData<span class="operator">,</span> <span class="operator">&amp;</span>replyData);
        <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> TAG <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">": onTransact() received "</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> replyData<span class="operator">.</span>readData();

        <span class="keyword">break</span>;
    }
    <span class="keyword">return</span> <span class="keyword">true</span>;
}</pre></div>
<p>In the service's <code translate="no">main()</code>, start the <a href="./qandroidbinder.htm" translate="no">QAndroidBinder</a> along with <a href="./qandroidservice.htm" translate="no">QAndroidService</a>:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">int</span> main(<span class="type">int</span> argc<span class="operator">,</span> <span class="type">char</span> <span class="operator">*</span>argv<span class="operator">[</span><span class="operator">]</span>)
{
    <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Starting service process from C++"</span>;
    <span class="type"><a href="./qandroidservice.htm" translate="no">QAndroidService</a></span> app(argc<span class="operator">,</span> argv<span class="operator">,</span> <span class="operator">[</span><span class="operator">]</span>(<span class="keyword">const</span> <span class="type"><a href="./qandroidintent.htm" translate="no">QAndroidIntent</a></span> <span class="operator">&amp;</span>) {
        <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Android service onBind()"</span>;
        <span class="keyword">return</span> <span class="keyword">new</span> AndroidBinder{};
    });

    <span class="keyword">return</span> app<span class="operator">.</span>exec();
}</pre></div>
<a name="handle-the-application-start"></a>
<h4 id="handle-the-application-start">Handle the Application Start<a class="plink" href="#handle-the-application-start" title="Direct link to this headline"></a></h4>
<p>In the main application side, a <a href="./qandroidserviceconnection.htm" translate="no">QAndroidServiceConnection</a> implementation is required to bind to the service and exchange data with it. Implement the functions <a href="./qandroidserviceconnection.htm#onServiceConnected" translate="no">QAndroidServiceConnection::onServiceConnected</a>() and <a href="./qandroidserviceconnection.htm#onServiceDisconnected" translate="no">QAndroidServiceConnection::onServiceDisconnected</a>():</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> AndroidServiceConnection<span class="operator">::</span>onServiceConnected(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>name<span class="operator">,</span>
                                                  <span class="keyword">const</span> <span class="type"><a href="./qandroidbinder.htm" translate="no">QAndroidBinder</a></span> <span class="operator">&amp;</span>serviceBinder)
{
    <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> TAG <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">": onServiceConnected() "</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> name;
    m_servieBinder <span class="operator">=</span> serviceBinder;
}

<span class="type">void</span> AndroidServiceConnection<span class="operator">::</span>onServiceDisconnected(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>name)
{
    <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> TAG <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">": onServiceDisconnected() "</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> name;
}</pre></div>
<p>Then, create a function to explicitly send messages to the service:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> AndroidServiceConnection<span class="operator">::</span>sendToService(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>name)
{
    <span class="comment">// send name</span>
    <span class="type"><a href="./qandroidparcel.htm" translate="no">QAndroidParcel</a></span> sendData<span class="operator">,</span> replyData;
    sendData<span class="operator">.</span>writeBinder(m_servieBinder);
    sendData<span class="operator">.</span>writeData(name<span class="operator">.</span>toUtf8());
    m_servieBinder<span class="operator">.</span>transact(<span class="number">1</span><span class="operator">,</span> sendData<span class="operator">,</span> <span class="operator">&amp;</span>replyData);
    <span class="keyword">const</span> <span class="type"><a href="./qvariant.htm" translate="no">QVariant</a></span> received(replyData<span class="operator">.</span>readVariant());
    <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> received;
    <span class="keyword">emit</span> <span class="type">QtAndroidService</span><span class="operator">::</span>instance()<span class="operator">-</span><span class="operator">&gt;</span>messageFromService(received<span class="operator">.</span>toString());
}</pre></div>
<p>Once you have all that ready, it's time to start the service and bind to it as follows:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">QtAndroidService</span><span class="operator">::</span><span class="type">QtAndroidService</span>(<span class="type"><a href="./qobject.htm" translate="no">QObject</a></span> <span class="operator">*</span>parent) : <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span>(parent)
{
    m_instance <span class="operator">=</span> <span class="keyword">this</span>;

    <span class="type"><a href="./qandroidintent.htm" translate="no">QAndroidIntent</a></span> serviceIntent(<span class="type"><a href="./qtandroid.htm" translate="no">QtAndroid</a></span><span class="operator">::</span>androidActivity()<span class="operator">,</span>
                                 <span class="string">"org.qtproject.example.qtandroidservice.QtAndroidService"</span>);

    <span class="keyword">const</span> bool bindResult <span class="operator">=</span> <span class="type"><a href="./qtandroid.htm" translate="no">QtAndroid</a></span><span class="operator">::</span>bindService(serviceIntent<span class="operator">,</span>
                                                   m_serviceConnection<span class="operator">,</span>
                                                   <span class="type"><a href="./qtandroid.htm" translate="no">QtAndroid</a></span><span class="operator">::</span>BindFlag<span class="operator">::</span>AutoCreate);
    <a href="./qtglobal.htm#qDebug" translate="no">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Binding to the service..."</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> bindResult;
}</pre></div>
<p>The <a href="./qtandroid.htm#bindService" translate="no">QtAndroid::bindService</a>() is called using <a href="./qtandroid.htm#BindFlag-enum" translate="no">QtAndroid::AutoCreate</a> which starts the service if it's not already running.</p>
<div class="admonition note">
<p><b>Note: </b>To receive data explicitly sent from the service (i.e. not just a reply), implement <a href="./qandroidbinder.htm" translate="no">QAndroidBinder</a> in the main application the same way it's done on the service. Once you have that, the service could initially send a message.</p>
</div>
<p>Then, create an instance for the custom <a href="./qandroidserviceconnection.htm" translate="no">QAndroidServiceConnection</a> class and connect it to QML. Add the following in <code translate="no">main.cpp</code>:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    <span class="type">QtAndroidService</span> <span class="operator">*</span>qtAndroidService <span class="operator">=</span> <span class="keyword">new</span> <span class="type">QtAndroidService</span>(<span class="operator">&amp;</span>app);
    engine<span class="operator">.</span>rootContext()<span class="operator">-</span><span class="operator">&gt;</span>setContextProperty(QLatin1String(<span class="string">"qtAndroidService"</span>)<span class="operator">,</span> qtAndroidService);</pre></div>
<p>Then, add a <a href="./qml-qtqml-connections.htm" translate="no">Connections</a> element to watch for the incoming messages from the service in <code translate="no">main.qml</code>:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    <span class="type"><a href="./qml-qtqml-connections.htm" translate="no">Connections</a></span> {
        <span class="name">target</span>: <span class="name">qtAndroidService</span>
        <span class="keyword">function </span><span class="name">onMessageFromService</span>(message) {
            <span class="name">pongText</span>.<span class="name">text</span> <span class="operator">=</span> <span class="name">message</span>
        }
    }</pre></div>
<p>And set the <code translate="no">onClicked</code> for the sending button to:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">        <span class="name">onClicked</span>: <span class="name">qtAndroidService</span>.<span class="name">sendToService</span>(<span class="name">pingText</span>.<span class="name">text</span>)</pre></div>
<p><a href="https://code.qt.io/cgit/qt/qtandroidextras.git/tree/examples/androidextras/services/servicebinder?h=5.15" translate="no">Example project @ code.qt.io</a></p>
</div>
<p><b>See also </b><a href="./android-services.htm" translate="no">Android Services</a>, <a href="./android.htm" translate="no">Qt for Android</a>, and <a href="./qtandroidextras-index.htm" translate="no">Qt Android Extras</a>.</p>
<!-- @@@services/servicebinder -->
</div>
<p class="copy-notice">
<acronym title="Copyright">Â©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>