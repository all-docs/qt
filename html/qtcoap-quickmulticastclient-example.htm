<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Quick CoAP Multicast Discovery Example | Qt CoAP</title>
<link rel="canonical" href="https://doc.qt.io/qt-6/qtcoap-quickmulticastclient-example.html">
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="http://doc.qt.io/QtForAutomation/index.html" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtcoap-index.htm" translate="no">Qt CoAP</a></li>
                            <li><a href="./qtcoap-examples.htm" translate="no">Qt CoAP Examples</a></li>
                            <li><a>Quick CoAP Multicast Discovery Example</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">Quick CoAP Multicast Discovery Example</h1>
<span class="subtitle"></span>
<!-- $$$quickmulticastclient-brief -->
<p>Using the CoAP client for a multicast resource discovery with a Qt Quick user interface.</p>
<!-- @@@quickmulticastclient -->
<!-- $$$quickmulticastclient-description -->
<div class="descr"> <a name="details"></a>
<p class="centerAlign"><img alt="" src="./images/quickmulticastclient.png"></p><p>The <i>Quick CoAP Multicast Discovery Example</i> demonstrates how to register <a href="./qcoapclient.htm" translate="no">QCoapClient</a> as a QML type and use it in a Qt Quick application for CoAP multicast resource discovery.</p>
<div class="admonition note">
<p><b>Note: </b>Qt CoAP does not provide a QML API in its current version. However, you can make the C++ classes of the module available to QML as shown in this example.</p>
</div>
<a name="running-the-example"></a>
<h4 id="running-the-example">Running the Example<a class="plink" href="#running-the-example" title="Direct link to this headline"></a></h4>
<p>To run the example application, you first need to set up and start at least one CoAP server supporting multicast resource discovery. You have the following options:</p>
<ul>
<li>Manually build and run CoAP servers using <a href="https://github.com/obgm/libcoap" translate="no">libcoap</a>, <a href="https://github.com/eclipse/californium/" translate="no">Californium</a>, or any other CoAP server implementation, which supports multicast and resource discovery features.</li>
<li>Use the ready Docker image available at Docker Hub, which builds and starts CoAP server based on Californium's <a href="https://github.com/eclipse/californium/tree/2.0.x/demo-apps/cf-helloworld-server" translate="no">multicast server example</a>.</li>
</ul>
<a name="using-the-docker-based-test-server"></a>
<h5 id="using-the-docker-based-test-server">Using the Docker-based Test Server<a class="plink" href="#using-the-docker-based-test-server" title="Direct link to this headline"></a></h5>
<p>The following command pulls the docker container for the CoAP server from the Docker Hub and starts it:</p>
<div class="pre"><pre class="cpp plain" translate="no">docker run --name coap-multicast-server -d --rm --net=host sokurazy/coap-multicast-test-server:californium.2.0.x</pre></div>
<div class="admonition note">
<p><b>Note: </b>You can run more than one multicast CoAP servers (on the same host or other hosts in the network) by passing a different <code translate="no">--name</code> to the command above.</p>
</div>
<a name="creating-a-client-and-using-it-with-qml"></a>
<h4 id="creating-a-client-and-using-it-with-qml">Creating a Client and Using It with QML<a class="plink" href="#creating-a-client-and-using-it-with-qml" title="Direct link to this headline"></a></h4>
<p>We create the <code translate="no">QmlCoapMulticastClient</code> class with the <a href="./qcoapclient.htm" translate="no">QCoapClient</a> class as a base class:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">class</span> QmlCoapMulticastClient : <span class="keyword">public</span> <span class="type"><a href="./qcoapclient.htm" translate="no">QCoapClient</a></span>
{
    Q_OBJECT

<span class="keyword">public</span>:
    QmlCoapMulticastClient(<span class="type"><a href="./qobject.htm" translate="no">QObject</a></span> <span class="operator">*</span>parent <span class="operator">=</span> nullptr);

    Q_INVOKABLE <span class="type">void</span> discover(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>host<span class="operator">,</span> <span class="type">int</span> port<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>discoveryPath);
    Q_INVOKABLE <span class="type">void</span> discover(<span class="type"><a href="./qtcoap-module.htm" translate="no">QtCoap</a></span><span class="operator">::</span>MulticastGroup group<span class="operator">,</span> <span class="type">int</span> port<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>discoveryPath);

Q_SIGNALS:
    <span class="type">void</span> discovered(<span class="keyword">const</span> QmlCoapResource <span class="operator">&amp;</span>resource);
    <span class="type">void</span> finished(<span class="type">int</span> error);

<span class="keyword">public</span> <span class="keyword">slots</span>:
    <span class="type">void</span> onDiscovered(<span class="type"><a href="./qcoapresourcediscoveryreply.htm" translate="no">QCoapResourceDiscoveryReply</a></span> <span class="operator">*</span>reply<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qvector.htm" translate="no">QVector</a></span><span class="operator">&lt;</span><span class="type"><a href="./qcoapresource.htm" translate="no">QCoapResource</a></span><span class="operator">&gt;</span> <span class="operator">&amp;</span>resources);
};</pre></div>
<p>In the main.cpp file, we register the <code translate="no">QmlCoapMulticastClient</code> class as a QML type:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    qmlRegisterType<span class="operator">&lt;</span>QmlCoapMulticastClient<span class="operator">&gt;</span>(<span class="string">"CoapMulticastClient"</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="string">"CoapMulticastClient"</span>);</pre></div>
<p>We also register the <a href="./qtcoap-module.htm" translate="no">QtCoap</a> namespace, to be able to use it in QML code:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    qmlRegisterUncreatableMetaObject(<span class="type"><a href="./qtcoap-module.htm" translate="no">QtCoap</a></span><span class="operator">::</span>staticMetaObject<span class="operator">,</span> <span class="string">"qtcoap.example.namespace"</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span>
                                     <span class="string">"QtCoap"</span><span class="operator">,</span> <span class="string">"Access to enums is read-only"</span>);</pre></div>
<p>Now in the QML code, we can import and use these types:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    ...
import CoapMulticastClient 1.0
import qtcoap.example.namespace 1.0
    ...
    <span class="type">CoapMulticastClient</span> {
        <span class="name">id</span>: <span class="name">client</span>
        <span class="name">onDiscovered</span>: <span class="name">addResource</span>(<span class="name">resource</span>)

        <span class="name">onFinished</span>: {
            <span class="name">statusLabel</span>.<span class="name">text</span> <span class="operator">=</span> (<span class="name">error</span> <span class="operator">===</span> <span class="name">QtCoap</span>.<span class="name">Error</span>.<span class="name">Ok</span>)
                    ? <span class="name">qsTr</span>(<span class="string">"Finished resource discovery."</span>)
                    : <span class="name">qsTr</span>(<span class="string">"Resource discovery failed with error code: %1"</span>).<span class="name">arg</span>(<span class="name">error</span>)
        }

        <span class="name">onError</span>:
            <span class="name">statusLabel</span>.<span class="name">text</span> <span class="operator">=</span> <span class="name">qsTr</span>(<span class="string">"Resource discovery failed with error code: %1"</span>).<span class="name">arg</span>(<span class="name">error</span>)
    }
    ...</pre></div>
<p>The <code translate="no">QCoapClient::error()</code> signal triggers the <code translate="no">onError</code> signal handler of <code translate="no">CoapMulticastClient</code>, and the <code translate="no">QmlCoapMulticastClient::finished()</code> signal triggers the <code translate="no">onFinished</code> signal handler, to show the request's status in the UI. Note that we are not using the <code translate="no">QCoapClient::finished()</code> signal directly, because it takes a <code translate="no">QCoapReply</code> as a parameter (which is not a QML type), and we are interested only in the error code.</p>
<p>In the <code translate="no">QmlCoapMulticastClient</code>'s constructor, we arrange for the <code translate="no">QCoapClient::finished()</code> signal to be forwarded to the <code translate="no">QmlCoapMulticastClient::finished()</code> signal:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">QmlCoapMulticastClient<span class="operator">::</span>QmlCoapMulticastClient(<span class="type"><a href="./qobject.htm" translate="no">QObject</a></span> <span class="operator">*</span>parent)
    : <span class="type"><a href="./qcoapclient.htm" translate="no">QCoapClient</a></span>(<span class="type"><a href="./qtcoap-module.htm" translate="no">QtCoap</a></span><span class="operator">::</span>SecurityMode<span class="operator">::</span>NoSecurity<span class="operator">,</span> parent)
{
    connect(<span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qcoapclient.htm" translate="no">QCoapClient</a></span><span class="operator">::</span>finished<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span>
            <span class="operator">[</span><span class="keyword">this</span><span class="operator">]</span>(<span class="type"><a href="./qcoapreply.htm" translate="no">QCoapReply</a></span> <span class="operator">*</span>reply) {
                    <span class="keyword">if</span> (reply)
                        <span class="keyword">emit</span> finished(<span class="keyword">static_cast</span><span class="operator">&lt;</span><span class="type">int</span><span class="operator">&gt;</span>(reply<span class="operator">-</span><span class="operator">&gt;</span>errorReceived()));
                    <span class="keyword">else</span>
                        qCWarning(lcCoapClient<span class="operator">,</span> <span class="string">"Something went wrong, received a null reply"</span>);
            });
}</pre></div>
<p>When the <b translate="no">Discover</b> button is pressed, we invoke one of the overloaded <code translate="no">discover()</code> methods, based on the selected multicast group:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    ...
        <span class="type">Button</span> {
            <span class="name">id</span>: <span class="name">discoverButton</span>
            <span class="name">text</span>: <span class="name">qsTr</span>(<span class="string">"Discover"</span>)
            <span class="name">Layout</span>.columnSpan: <span class="number">2</span>

            <span class="name">onClicked</span>: {
                var currentGroup = <span class="name">groupComboBox</span>.<span class="name">model</span>.<span class="name">get</span>(<span class="name">groupComboBox</span>.<span class="name">currentIndex</span>).<span class="name">value</span>;

                var path = <span class="string">""</span>;
                <span class="keyword">if</span> (<span class="name">currentGroup</span> <span class="operator">!==</span> - <span class="number">1</span>) {
                    <span class="name">client</span>.<span class="name">discover</span>(<span class="name">currentGroup</span>, <span class="name">parseInt</span>(<span class="name">portField</span>.<span class="name">text</span>),
                                    <span class="name">discoveryPathField</span>.<span class="name">text</span>);
                    <span class="name">path</span> <span class="operator">=</span> <span class="name">groupComboBox</span>.<span class="name">currentText</span>;
                } <span class="keyword">else</span> {
                    <span class="name">client</span>.<span class="name">discover</span>(<span class="name">customGroupField</span>.<span class="name">text</span>, <span class="name">parseInt</span>(<span class="name">portField</span>.<span class="name">text</span>),
                                    <span class="name">discoveryPathField</span>.<span class="name">text</span>);
                    <span class="name">path</span> <span class="operator">=</span> <span class="name">customGroupField</span>.<span class="name">text</span> <span class="operator">+</span> <span class="name">discoveryPathField</span>.<span class="name">text</span>;
                }
                <span class="name">statusLabel</span>.<span class="name">text</span> <span class="operator">=</span> <span class="name">qsTr</span>(<span class="string">"Discovering resources at %1..."</span>).<span class="name">arg</span>(<span class="name">path</span>);
            }
        }
    ...</pre></div>
<p>This overload is called when a custom multicast group or a host address is selected:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> QmlCoapMulticastClient<span class="operator">::</span>discover(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>host<span class="operator">,</span> <span class="type">int</span> port<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>discoveryPath)
{
    <span class="type"><a href="./qurl.htm" translate="no">QUrl</a></span> url;
    url<span class="operator">.</span>setHost(host);
    url<span class="operator">.</span>setPort(port);

    <span class="type"><a href="./qcoapresourcediscoveryreply.htm" translate="no">QCoapResourceDiscoveryReply</a></span> <span class="operator">*</span>discoverReply <span class="operator">=</span> <span class="type"><a href="./qcoapclient.htm" translate="no">QCoapClient</a></span><span class="operator">::</span>discover(url<span class="operator">,</span> discoveryPath);
    <span class="keyword">if</span> (discoverReply) {
        connect(discoverReply<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qcoapresourcediscoveryreply.htm" translate="no">QCoapResourceDiscoveryReply</a></span><span class="operator">::</span>discovered<span class="operator">,</span>
                <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>QmlCoapMulticastClient<span class="operator">::</span>onDiscovered);
    } <span class="keyword">else</span> {
        qCWarning(lcCoapClient<span class="operator">,</span> <span class="string">"Discovery request failed."</span>);
    }
}</pre></div>
<p>And this overload is called when one of the suggested multicast groups is selected in the UI:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> QmlCoapMulticastClient<span class="operator">::</span>discover(<span class="type"><a href="./qtcoap-module.htm" translate="no">QtCoap</a></span><span class="operator">::</span>MulticastGroup group<span class="operator">,</span> <span class="type">int</span> port<span class="operator">,</span>
                                      <span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>discoveryPath)
{
    <span class="type"><a href="./qcoapresourcediscoveryreply.htm" translate="no">QCoapResourceDiscoveryReply</a></span> <span class="operator">*</span>discoverReply <span class="operator">=</span> <span class="type"><a href="./qcoapclient.htm" translate="no">QCoapClient</a></span><span class="operator">::</span>discover(group<span class="operator">,</span> port<span class="operator">,</span> discoveryPath);
    <span class="keyword">if</span> (discoverReply) {
        connect(discoverReply<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qcoapresourcediscoveryreply.htm" translate="no">QCoapResourceDiscoveryReply</a></span><span class="operator">::</span>discovered<span class="operator">,</span>
                <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>QmlCoapMulticastClient<span class="operator">::</span>onDiscovered);
    } <span class="keyword">else</span> {
        qCWarning(lcCoapClient<span class="operator">,</span> <span class="string">"Discovery request failed."</span>);
    }
}</pre></div>
<p>The <code translate="no">QCoapClient::discovered()</code> signal delivers a list of <code translate="no">QCoapResources</code>, which is not a QML type. To make the resources available in QML, we forward each resource in the list to the <code translate="no">QmlCoapMulticastClient::discovered()</code> signal, which takes a <code translate="no">QmlCoapResource</code> instead:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> QmlCoapMulticastClient<span class="operator">::</span>onDiscovered(<span class="type"><a href="./qcoapresourcediscoveryreply.htm" translate="no">QCoapResourceDiscoveryReply</a></span> <span class="operator">*</span>reply<span class="operator">,</span>
                                          <span class="keyword">const</span> <span class="type"><a href="./qvector.htm" translate="no">QVector</a></span><span class="operator">&lt;</span><span class="type"><a href="./qcoapresource.htm" translate="no">QCoapResource</a></span><span class="operator">&gt;</span> <span class="operator">&amp;</span>resources)
{
    Q_UNUSED(reply)
    <span class="keyword">for</span> (<span class="keyword">auto</span> resource : resources)
        <span class="keyword">emit</span> discovered(resource);
}</pre></div>
<p><code translate="no">QmlCoapResource</code> is a wrapper around <a href="./qcoapresource.htm" translate="no">QCoapResource</a>, to make some of its properties available in QML:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">class</span> QmlCoapResource : <span class="keyword">public</span> <span class="type"><a href="./qcoapresource.htm" translate="no">QCoapResource</a></span>
{
    Q_GADGET
    Q_PROPERTY(<span class="type"><a href="./qstring.htm" translate="no">QString</a></span> title READ title)
    Q_PROPERTY(<span class="type"><a href="./qstring.htm" translate="no">QString</a></span> host READ hostStr)
    Q_PROPERTY(<span class="type"><a href="./qstring.htm" translate="no">QString</a></span> path READ path)

<span class="keyword">public</span>:
    QmlCoapResource() : <span class="type"><a href="./qcoapresource.htm" translate="no">QCoapResource</a></span>() {}
    QmlCoapResource(<span class="keyword">const</span> <span class="type"><a href="./qcoapresource.htm" translate="no">QCoapResource</a></span> <span class="operator">&amp;</span>resource)
        : <span class="type"><a href="./qcoapresource.htm" translate="no">QCoapResource</a></span>(resource) {}

    <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> hostStr() <span class="keyword">const</span> { <span class="keyword">return</span> host()<span class="operator">.</span>toString(); }
};</pre></div>
<p>The discovered resources are added to the <code translate="no">resourceModel</code> of the list view in the UI:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    ...
    <span class="keyword">function </span><span class="name">addResource</span>(resource) {
        <span class="name">resourceModel</span>.<span class="name">insert</span>(<span class="number">0</span>, {"host" : <span class="name">resource</span>.<span class="name">host</span>,
                                 "path" : <span class="name">resource</span>.<span class="name">path</span>,
                                 "title" : <span class="name">resource</span>.<span class="name">title</span>})
    }
    ...</pre></div>
<p>Files:</p>
<ul>
<li><a href="./qtcoap-quickmulticastclient-main-cpp.htm" translate="no">quickmulticastclient/main.cpp</a></li>
<li><a href="./qtcoap-quickmulticastclient-main-qml.htm" translate="no">quickmulticastclient/main.qml</a></li>
<li><a href="./qtcoap-quickmulticastclient-qml-qrc.htm" translate="no">quickmulticastclient/qml.qrc</a></li>
<li><a href="./qtcoap-quickmulticastclient-qmlcoapmulticastclient-cpp.htm" translate="no">quickmulticastclient/qmlcoapmulticastclient.cpp</a></li>
<li><a href="./qtcoap-quickmulticastclient-qmlcoapmulticastclient-h.htm" translate="no">quickmulticastclient/qmlcoapmulticastclient.h</a></li>
<li><a href="./qtcoap-quickmulticastclient-quickmulticastclient-pro.htm" translate="no">quickmulticastclient/quickmulticastclient.pro</a></li>
</ul>
</div>
<!-- @@@quickmulticastclient -->
</div>
<p class="copy-notice">
<acronym title="Copyright">Â©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>