<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tunnel Client Example | Qt KNX</title>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="http://doc.qt.io/QtForAutomation/index.html" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtknx-index.htm" translate="no">Qt KNX</a></li>
                            <li><a href="./qtknx-examples.htm" translate="no">Qt KNX Examples</a></li>
                            <li><a>Tunnel Client Example</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">Tunnel Client Example</h1>
<span class="subtitle"></span>
<!-- $$$tunnelclient-brief -->
<p>A client that creates a tunnel connection to a KNX/netIP server.</p>
<!-- @@@tunnelclient -->
<!-- $$$tunnelclient-description -->
<div class="descr"> <a name="details"></a>
<p><i>Tunnel Client</i> shows how to create a tunnel connection to a KNX/netIP server.</p>
<a name="usage"></a>
<h4 id="usage">Usage<a class="plink" href="#usage" title="Direct link to this headline"></a></h4>
<p>Here are the parameters that the client accepts:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    Usage: <span class="operator">.</span><span class="operator">/</span>tunnelclient <span class="operator">[</span>options<span class="operator">]</span>

Options:
  <span class="operator">-</span>h<span class="operator">,</span> <span class="operator">-</span><span class="operator">-</span>help                       Displays <span class="keyword">this</span> help<span class="operator">.</span>
  <span class="operator">-</span>t<span class="operator">,</span> <span class="operator">-</span><span class="operator">-</span>timeout <span class="operator">&lt;</span>timeout<span class="operator">&gt;</span>          The heartbeat timeout in seconds<span class="operator">.</span>
  <span class="operator">-</span>n<span class="operator">,</span> <span class="operator">-</span><span class="operator">-</span>nat                        Use Network Address Translation to traverse
                                   across network routers<span class="operator">.</span>
  <span class="operator">-</span><span class="operator">-</span>localAddress <span class="operator">&lt;</span>localAddress<span class="operator">&gt;</span>    The local IP address used <span class="keyword">for</span> the control
                                   endpoint<span class="operator">.</span>
  <span class="operator">-</span><span class="operator">-</span>localPort <span class="operator">&lt;</span>localPort<span class="operator">&gt;</span>          The local UDP port used <span class="keyword">for</span> the control
                                   endpoint<span class="operator">.</span>
  <span class="operator">-</span><span class="operator">-</span>remoteAddress <span class="operator">&lt;</span>remoteAddress<span class="operator">&gt;</span>  The remote IP address used by the server the
                                   control endpoint<span class="operator">.</span>
  <span class="operator">-</span><span class="operator">-</span>remotePort <span class="operator">&lt;</span>remotePort<span class="operator">&gt;</span>        The remote UDP port used by the server the
                                   control endpoint<span class="operator">.</span></pre></div>
<p>The usual way to run the client is:</p>
<div class="pre"><pre class="cpp" translate="no">    <span class="operator">.</span><span class="operator">/</span>tunnelclient <span class="operator">-</span><span class="operator">-</span>remoteAddress <span class="number">10.9.78.81</span>  <span class="operator">-</span><span class="operator">-</span>localAddress <span class="number">10.9.78.59</span>
Sending connect request: <span class="number">0x06100205001a08010a094e3bbf0b08010a094e3bbf0b04040200</span>
Type <span class="char">'quit'</span> to stop the application<span class="operator">.</span>
Received connect response: <span class="number">0x0610020600143d0008010a094e510e5704041103</span>
Sending connection state request: <span class="number">0x0610020700103d0008010a094e3bbf0b</span>
Received connection state response: <span class="number">0x0610020800083d00</span></pre></div>
<p>This is the initial state of the client. The client pauses indefinitely waiting for keyboard interaction. The user can then send KNX frames by pasting the stream of bytes directly into the terminal. Pressing <b>Enter</b> will notify the client to encapsulate the stream of bytes in a KNX tunneling request and send it to the KNX server throughout the tunnel. This can be seen below:</p>
<div class="pre"><pre class="cpp" translate="no"><span class="number">1100b4e000000002010000</span>
Sending tunneling request:<span class="number">0x061004200015043d00001100b4e000000002010000</span>
Received tunneling acknowledge: <span class="number">0x06100421000a043d0000</span>
Received tunneling request: <span class="number">0x061004200015043d00002e00b4e011030002010000</span>
Sending tunneling acknowledge: <span class="number">0x06100421000a043d0000</span>
Received tunneling request: <span class="number">0x061004200015043d01002900b4e011010002010040</span>
Sending tunneling acknowledge: <span class="number">0x06100421000a043d0100</span></pre></div>
<p>By typing the word <i>quit</i> in the terminal the client will disconnect and terminate.</p>
<div class="pre"><pre class="cpp" translate="no">quit
Sending disconnect request: <span class="number">0x0610020900103d0008010a094e3bbf0b</span>
Received disconnect response: <span class="number">0x0610020a00083d00</span></pre></div>
<a name="implementation"></a>
<h4 id="implementation">Implementation<a class="plink" href="#implementation" title="Direct link to this headline"></a></h4>
<p>In the main function, we create a tunnel connection by instantiating the <a href="./qknxnetiptunnel.htm" translate="no">QKnxNetIpTunnel</a> class. This class will manage the tunnel connection.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">int</span> main(<span class="type">int</span> argc<span class="operator">,</span> <span class="type">char</span> <span class="operator">*</span>argv<span class="operator">[</span><span class="operator">]</span>)
{
    ...
    tunnel<span class="operator">.</span>setLocalAddress(<span class="type"><a href="./qhostaddress.htm" translate="no">QHostAddress</a></span>(parser<span class="operator">.</span>value(<span class="string">"localAddress"</span>)));</pre></div>
<p>All of the CLI parameters are used to configure the <a href="./qknxnetiptunnel.htm" translate="no">QKnxNetIpTunnel</a> instance. A handler is installed to capture the signal <a href="./qknxnetipendpointconnection.htm#disconnected" translate="no">QKnxNetIpTunnel::disconnected</a> that will terminate the connection.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">    ...
    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="operator">&amp;</span>tunnel<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qknxnetiptunnel.htm" translate="no">QKnxNetIpTunnel</a></span><span class="operator">::</span>disconnected<span class="operator">,</span> <span class="operator">&amp;</span>app<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qcoreapplication.htm" translate="no">QCoreApplication</a></span><span class="operator">::</span>quit);</pre></div>
<p>The connection is established using the server address and port number previously provided and calling the method <a href="./qknxnetipendpointconnection.htm#connectToHost" translate="no">QKnxNetIpTunnel::connectToHost</a>.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">int</span> main(<span class="type">int</span> argc<span class="operator">,</span> <span class="type">char</span> <span class="operator">*</span>argv<span class="operator">[</span><span class="operator">]</span>)
{
    ...
    tunnel<span class="operator">.</span>connectToHost(<span class="type"><a href="./qhostaddress.htm" translate="no">QHostAddress</a></span>(parser<span class="operator">.</span>value(<span class="string">"remoteAddress"</span>))<span class="operator">,</span>
        parser<span class="operator">.</span>value(<span class="string">"remotePort"</span>)<span class="operator">.</span>toUInt());
    ...
    <span class="type"><a href="./qtextstream.htm" translate="no">QTextStream</a></span> input(stdin<span class="operator">,</span> <span class="type"><a href="./qiodevice.htm" translate="no">QIODevice</a></span><span class="operator">::</span>ReadOnly);
<span class="preprocessor">#ifdef Q_OS_WIN</span>
    <span class="type"><a href="./qwineventnotifier.htm" translate="no">QWinEventNotifier</a></span> notifier(GetStdHandle(STD_INPUT_HANDLE));
    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="operator">&amp;</span>notifier<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qwineventnotifier.htm" translate="no">QWinEventNotifier</a></span><span class="operator">::</span>activated<span class="operator">,</span> <span class="operator">[</span><span class="operator">&amp;</span><span class="operator">]</span>(HANDLE) {
<span class="preprocessor">#else</span>
    <span class="type"><a href="./qsocketnotifier.htm" translate="no">QSocketNotifier</a></span> notifier(STDIN_FILENO<span class="operator">,</span> <span class="type"><a href="./qsocketnotifier.htm" translate="no">QSocketNotifier</a></span><span class="operator">::</span>Read);
    <span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="operator">&amp;</span>notifier<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qsocketnotifier.htm" translate="no">QSocketNotifier</a></span><span class="operator">::</span>activated<span class="operator">,</span> <span class="operator">[</span><span class="operator">&amp;</span><span class="operator">]</span>(<span class="type">int</span>) {
<span class="preprocessor">#endif</span>
        <span class="keyword">auto</span> tmp <span class="operator">=</span> input<span class="operator">.</span>readLine()<span class="operator">.</span>toLatin1();
        <span class="keyword">if</span> (tmp <span class="operator">!</span><span class="operator">=</span> <span class="string">"quit"</span>) {
            <span class="keyword">const</span> <span class="keyword">auto</span> bytes <span class="operator">=</span> <span class="type"><a href="./qknxbytearray.htm" translate="no">QKnxByteArray</a></span><span class="operator">::</span>fromHex(tmp);
            <span class="keyword">auto</span> frame <span class="operator">=</span> <span class="type"><a href="./qknxlinklayerframe.htm" translate="no">QKnxLinkLayerFrame</a></span><span class="operator">::</span>builder()
                <span class="operator">.</span>setData(bytes)
                <span class="operator">.</span>setMedium(<span class="type"><a href="./qknx.htm" translate="no">QKnx</a></span><span class="operator">::</span>MediumType<span class="operator">::</span>NetIP)
                <span class="operator">.</span>createFrame();
            tunnel<span class="operator">.</span>sendFrame(frame);
        } <span class="keyword">else</span> {
            tunnel<span class="operator">.</span>disconnectFromHost();
        }
    });

    <span class="keyword">if</span> (tunnel<span class="operator">.</span>error() <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="./qknxnetiptunnel.htm" translate="no">QKnxNetIpTunnel</a></span><span class="operator">::</span>Error<span class="operator">::</span>None) {
        <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">"Type 'quit' to stop the application."</span>;
        app<span class="operator">.</span>exec();
    } <span class="keyword">else</span> {
        <a href="./qtglobal.htm#qInfo" translate="no">qInfo</a>()<span class="operator">.</span>noquote() <span class="operator">&lt;</span><span class="operator">&lt;</span> tunnel<span class="operator">.</span>error() <span class="operator">&lt;</span><span class="operator">&lt;</span> tunnel<span class="operator">.</span>errorString();
    }

    <span class="keyword">return</span> <span class="number">0</span>;
}</pre></div>
<p>The signals <a href="./qwineventnotifier.htm#activated" translate="no">QWinEventNotifier::activated</a> (from Windows) and <a href="./qsocketnotifier.htm#activated" translate="no">QSocketNotifier::activated</a> (from other platforms) are used for detecting user data ready to be read from the terminal. The stream of bytes is captured by a <a href="./qtextstream.htm" translate="no">QTextStream</a> instance. Then, a KNX link layer frame is built from it and sent over the tunnel connection.</p>
<p>Files:</p>
<ul>
<li><a href="./qtknx-tunnelclient-main-cpp.htm" translate="no">tunnelclient/main.cpp</a></li>
<li><a href="./qtknx-tunnelclient-tunnelclient-pro.htm" translate="no">tunnelclient/tunnelclient.pro</a></li>
</ul>
</div>
<!-- @@@tunnelclient -->
</div>
<p class="copy-notice">
<acronym title="Copyright">Â©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>