<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Qt Quick Local Storage QML Types | Qt Quick</title>
<link rel="canonical" href="https://doc.qt.io/qt-6/qtquick-localstorage-qmlmodule.html">
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="./index.htm" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtquick-index.htm" translate="no">Qt Quick</a></li>
                            <li><a>Qt Quick Local Storage QML Types</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title" translate="no">Qt Quick Local Storage QML Types</h1>
<span class="subtitle" translate="no"></span>
<!-- $$$QtQuick.LocalStorage-description -->
<div class="descr"> <a name="details"></a>
<p>This is a singleton type for reading and writing to <a href="./qtsql-attribution-sqlite.htm#sqlite" translate="no">SQLite</a> databases.</p>
<a name="methods"></a>
<h2 id="methods">Methods<a class="plink" href="#methods" title="Direct link to this headline"></a></h2>
<ul>
<li>object <b><a href="./qtquick-localstorage-qmlmodule.htm#opendatabasesync" translate="no">openDatabaseSync</a></b>(string name, string version, string description, int estimated_size, jsobject callback(db))</li>
</ul>
<a name="detailed-description"></a>
<h2 id="detailed-description">Detailed Description<a class="plink" href="#detailed-description" title="Direct link to this headline"></a></h2>
<p>To use the types in this module, import the module and call the relevant functions using the <code translate="no">LocalStorage</code> type:</p>
<div class="pre"><pre class="qml prettyprint" translate="no">import QtQuick 2.15
import QtQuick.LocalStorage 2.15

Item {
    Component.onCompleted: {
        var db = LocalStorage.openDatabaseSync(...)
    }
}</pre></div>
<p>These databases are user-specific and QML-specific, but accessible to all QML applications. They are stored in the <code translate="no">Databases</code> subdirectory of <a href="./qqmlengine.htm#offlineStoragePath-prop" translate="no">QQmlEngine::offlineStoragePath</a>(), currently as <a href="./qtsql-attribution-sqlite.htm#sqlite" translate="no">SQLite</a> databases.</p>
<p>Database connections are automatically closed during Javascript garbage collection.</p>
<p>The API can be used from JavaScript functions in your QML:</p>
<div class="pre"><pre class="qml prettyprint" translate="no">import QtQuick 2.0

<span class="type"><a href="./qml-qtquick-rectangle.htm" translate="no">Rectangle</a></span> {
    <span class="name">color</span>: <span class="string">"white"</span>
    <span class="name">width</span>: <span class="number">200</span>
    <span class="name">height</span>: <span class="number">100</span>

    <span class="type"><a href="./qml-qtquick-text.htm" translate="no">Text</a></span> {
        <span class="name">text</span>: <span class="string">"?"</span>
        <span class="name">anchors</span>.horizontalCenter: <span class="name">parent</span>.<span class="name">horizontalCenter</span>
        <span class="keyword">function </span><span class="name">findGreetings</span>() {
            var db = <span class="name">openDatabaseSync</span>(<span class="string">"QDeclarativeExampleDB"</span>, <span class="string">"1.0"</span>, <span class="string">"The Example QML SQL!"</span>, <span class="number">1000000</span>);

            <span class="name">db</span>.<span class="name">transaction</span>(
                <span class="keyword">function</span>(tx) {
                    <span class="comment">// Create the database if it doesn't already exist</span>
                    <span class="name">tx</span>.<span class="name">executeSql</span>(<span class="string">'CREATE TABLE IF NOT EXISTS Greeting(salutation TEXT, salutee TEXT)'</span>);

                    <span class="comment">// Add (another) greeting row</span>
                    <span class="name">tx</span>.<span class="name">executeSql</span>(<span class="string">'INSERT INTO Greeting VALUES(?, ?)'</span>, [ <span class="string">'hello'</span>, <span class="string">'world'</span> ]);

                    <span class="comment">// Show all added greetings</span>
                    var rs = <span class="name">tx</span>.<span class="name">executeSql</span>(<span class="string">'SELECT * FROM Greeting'</span>);

                    var r = <span class="string">""</span>
                    <span class="keyword">for</span> (var i = 0; <span class="name">i</span> <span class="operator">&lt;</span> <span class="name">rs</span>.<span class="name">rows</span>.<span class="name">length</span>; i++) {
                        <span class="name">r</span> <span class="operator">+=</span> <span class="name">rs</span>.<span class="name">rows</span>.<span class="name">item</span>(<span class="name">i</span>).<span class="name">salutation</span> <span class="operator">+</span> <span class="string">", "</span> <span class="operator">+</span> <span class="name">rs</span>.<span class="name">rows</span>.<span class="name">item</span>(<span class="name">i</span>).<span class="name">salutee</span> <span class="operator">+</span> <span class="string">"\n"</span>
                    }
                    <span class="name">text</span> <span class="operator">=</span> <span class="name">r</span>
                }
            )
        }
        <span class="name">Component</span>.onCompleted: <span class="name">findGreetings</span>()
    }
}</pre></div>
<p>The API conforms to the Synchronous API of the HTML5 Web Database API, <a href="http://www.w3.org/TR/2009/WD-webdatabase-20091029/" translate="no">W3C Working Draft 29 October 2009</a>.</p>
<p>The <a href="./qtquick-localstorage-example.htm" translate="no">SQL Local Storage example</a> demonstrates the basics of using the Offline Storage API.</p>
<a name="open-or-create-a-database"></a>
<h4 id="open-or-create-a-database">Open or Create a Database<a class="plink" href="#open-or-create-a-database" title="Direct link to this headline"></a></h4>
<div class="pre"><pre class="qml prettyprint" translate="no">import QtQuick.LocalStorage 2.15 as Sql

db = Sql.openDatabaseSync(identifier, version, description, estimated_size, callback(db))</pre></div>
<p>The above code returns the database identified by <i>identifier</i>. If the database does not already exist, it is created, and the function <i>callback</i> is called with the database as a parameter. <i>identifier</i> is the name of the physical file (with or without full path) containing the database. <i>description</i> and <i>estimated_size</i> are written to the INI file (described below), but are currently unused.</p>
<p>May throw exception with code property SQLException.DATABASE_ERR, or SQLException.VERSION_ERR.</p>
<p>When a database is first created, an INI file is also created specifying its characteristics:</p>
<div class="table"><table class="generic">
<thead><tr class="qt-style"><th><b>Key</b></th><th><b>Value</b></th></tr></thead>
<tbody><tr class="odd" valign="top"><td>Identifier</td><td>The name of the database passed to <code translate="no">openDatabase()</code></td></tr>
<tr class="even" valign="top"><td>Version</td><td>The version of the database passed to <code translate="no">openDatabase()</code></td></tr>
<tr class="odd" valign="top"><td>Description</td><td>The description of the database passed to <code translate="no">openDatabase()</code></td></tr>
<tr class="even" valign="top"><td>EstimatedSize</td><td>The estimated size (in bytes) of the database passed to <code translate="no">openDatabase()</code></td></tr>
<tr class="odd" valign="top"><td>Driver</td><td>Currently "QSQLITE"</td></tr>
</tbody></table></div>
<p>This data can be used by application tools.</p>
<a name="db-changeversion-from-to-callback-tx"></a>
<h4 id="db-changeversion-from-to-callback-tx">db.changeVersion(from, to, callback(tx))<a class="plink" href="#db-changeversion-from-to-callback-tx" title="Direct link to this headline"></a></h4>
<p>This method allows you to perform a <i>Scheme Upgrade</i>. If it succeeds it returns a new database object of version <i>to</i>. Otherwise it returns <i>undefined</i>.</p>
<p>If the current version of <i>db</i> is not <i>from</i>, then an exception is thrown.</p>
<p>Otherwise, a database transaction is created and passed to <i>callback</i>. In this function, you can call <i>executeSql</i> on <i>tx</i> to upgrade the database.</p>
<p>May throw exception with code property SQLException.DATABASE_ERR or SQLException.UNKNOWN_ERR.</p>
<p>See example below.</p>
<div class="pre"><pre class="cpp plain" translate="no">var db = LocalStorage.openDatabaseSync("ActivityTrackDB", "", "Database tracking sports activities", 1000000);
if (db.version == "0.1") {
    db.changeVersion("0.1", "0.2", function(tx) {
        tx.executeSql("INSERT INTO trip_log VALUES(?, ?, ?)",
                    [ "01/10/2016","Sylling - Vikersund", "53" ]);
    }
});</pre></div>
<a name="db-transaction-callback-tx"></a>
<h4 id="db-transaction-callback-tx">db.transaction(callback(tx))<a class="plink" href="#db-transaction-callback-tx" title="Direct link to this headline"></a></h4>
<p>This method creates a read/write transaction and passed to <i>callback</i>. In this function, you can call <i>executeSql</i> on <i>tx</i> to read and modify the database.</p>
<p>If the callback throws exceptions, the transaction is rolled back. Below you will find an example of a database transaction which catches exceptions.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">{
    var db = <span class="name">LocalStorage</span>.<span class="name">openDatabaseSync</span>(<span class="string">"Activity_Tracker_DB"</span>, <span class="string">""</span>, <span class="string">"Track exercise"</span>, <span class="number">1000000</span>)
    <span class="keyword">try</span> {
        <span class="name">db</span>.<span class="name">transaction</span>(<span class="keyword">function </span>(tx) {
            <span class="name">tx</span>.<span class="name">executeSql</span>(<span class="string">'CREATE TABLE IF NOT EXISTS trip_log (date text,trip_desc text,distance numeric)'</span>)
        })
    } <span class="keyword">catch</span> (<span class="name">err</span>) {
        console.log("Error creating table in database: " + err)
    };
}</pre></div>
<p>In the example you can see an <code translate="no">insert</code> statement where values are assigned to the fields, and the record is written into the table. That is an <code translate="no">insert</code> statement with a syntax that is usual for a relational database. It is however also possible to work with JSON objects and store them in a table.</p>
<p>Let's suppose a simple example where we store trips in JSON format using <code translate="no">date</code> as the unique key. An example of a table that could be used for that purpose:</p>
<div class="pre"><pre class="cpp plain" translate="no">create table trip_log(date text, data text)</pre></div>
<p>The assignment of values to a JSON object:</p>
<div class="pre"><pre class="cpp plain" translate="no">var obj = {description = "Vikersund - Noresund", distance = "60"}</pre></div>
<p>In that case, the data could be saved in the following way:</p>
<div class="pre"><pre class="cpp plain" translate="no">db.transaction(function(tx) {
    result = tx.executeSQL("insert into trip_log values (?,?)",
                           ["01/11/2016", JSON.stringify(obj)])</pre></div>
<a name="db-readtransaction-callback-tx"></a>
<h4 id="db-readtransaction-callback-tx">db.readTransaction(callback(tx))<a class="plink" href="#db-readtransaction-callback-tx" title="Direct link to this headline"></a></h4>
<p>This method creates a read-only transaction and passed to <i>callback</i>. In this function, you can call <i>executeSql</i> on <i>tx</i> to read the database (with <code translate="no">select</code> statements).</p>
<a name="results-tx-executesql-statement-values"></a>
<h4 id="results-tx-executesql-statement-values">results = tx.executeSql(statement, values)<a class="plink" href="#results-tx-executesql-statement-values" title="Direct link to this headline"></a></h4>
<p>This method executes an SQL <i>statement</i>, binding the list of <i>values</i> to SQL positional parameters ("?").</p>
<p>It returns a results object, with the following properties:</p>
<div class="table"><table class="generic">
<thead><tr class="qt-style"><th><b>Type</b></th><th><b>Property</b></th><th><b>Value</b></th><th><b>Applicability</b></th></tr></thead>
<tbody><tr class="odd" valign="top"><td>int</td><td>rows.length</td><td>The number of rows in the result</td><td>SELECT</td></tr>
<tr class="even" valign="top"><td>var</td><td>rows.item(i)</td><td>Function that returns row <i>i</i> of the result</td><td>SELECT</td></tr>
<tr class="odd" valign="top"><td>int</td><td>rowsAffected</td><td>The number of rows affected by a modification</td><td>UPDATE, DELETE</td></tr>
<tr class="even" valign="top"><td>string</td><td>insertId</td><td>The id of the row inserted</td><td>INSERT</td></tr>
</tbody></table></div>
<p>May throw exception with code property SQLException.DATABASE_ERR, SQLException.SYNTAX_ERR, or SQLException.UNKNOWN_ERR.</p>
<p>See below for an example:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">function </span><span class="name">dbReadAll</span>()
{
    var db = <span class="name">dbGetHandle</span>()
    <span class="name">db</span>.<span class="name">transaction</span>(<span class="keyword">function </span>(tx) {
        var results = <span class="name">tx</span>.<span class="name">executeSql</span>(
                    <span class="string">'SELECT rowid,date,trip_desc,distance FROM trip_log order by rowid desc'</span>)
        <span class="keyword">for</span> (var i = 0; <span class="name">i</span> <span class="operator">&lt;</span> <span class="name">results</span>.<span class="name">rows</span>.<span class="name">length</span>; i++) {
            <span class="name">listModel</span>.<span class="name">append</span>({
                                 id: <span class="name">results</span>.<span class="name">rows</span>.<span class="name">item</span>(<span class="name">i</span>).<span class="name">rowid</span>,
                                 checked: <span class="string">" "</span>,
                                 date: <span class="name">results</span>.<span class="name">rows</span>.<span class="name">item</span>(<span class="name">i</span>).<span class="name">date</span>,
                                 trip_desc: <span class="name">results</span>.<span class="name">rows</span>.<span class="name">item</span>(<span class="name">i</span>).<span class="name">trip_desc</span>,
                                 distance: <span class="name">results</span>.<span class="name">rows</span>.<span class="name">item</span>(<span class="name">i</span>).<span class="name">distance</span>
                             })
        }
    })
}</pre></div>
<a name="method-documentation"></a>
<h2 id="method-documentation">Method Documentation<a class="plink" href="#method-documentation" title="Direct link to this headline"></a></h2>
<a name="opendatabasesync"></a><div class="pre"><pre class="cpp prettyprint" translate="no">object openDatabaseSync(string name<span class="operator">,</span> string version<span class="operator">,</span> string description<span class="operator">,</span> <span class="type"><a href="./qml-int.htm" translate="no">int</a></span> estimated_size<span class="operator">,</span> jsobject callback(db))</pre></div>
<p>Opens or creates a local storage sql database by the given parameters.</p>
<ul>
<li><code translate="no">name</code> is the database name</li>
<li><code translate="no">version</code> is the database version</li>
<li><code translate="no">description</code> is the database display name</li>
<li><code translate="no">estimated_size</code> is the database's estimated size, in bytes</li>
<li><code translate="no">callback</code> is an optional parameter, which is invoked if the database has not yet been created.</li>
</ul>
<p>Returns the created database object.</p>
</div>
<!-- @@@QtQuick.LocalStorage -->
</div>
<p class="copy-notice">
<acronym title="Copyright">Â©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>