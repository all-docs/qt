<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Qt Remote Objects - External QIODevices | Qt Remote Objects</title>
<link rel="canonical" href="https://doc.qt.io/qt-6/qtremoteobjects-external-schemas.html">
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="./index.htm" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtremoteobjects-index.htm" translate="no">Qt Remote Objects</a></li>
                            <li><a>Qt Remote Objects - External QIODevices</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">Qt Remote Objects - External QIODevices</h1>
<span class="subtitle"></span>
<!-- $$$qtremoteobjects-external-schemas.html-description -->
<div class="descr"> <a name="details"></a>
<a name="external-qiodevices"></a>
<h2 id="external-qiodevices">External QIODevices<a class="plink" href="#external-qiodevices" title="Direct link to this headline"></a></h2>
<p>Qt Remote Objects supports several communications channels out-of-the-box, such as the <a href="./qtcpserver.htm" translate="no">QTcpServer</a> and <a href="./qtcpsocket.htm" translate="no">QTcpSocket</a> pair. Given the desired <a href="./qurl.htm" translate="no">QUrl</a> for tcp, or the desired name (for the <a href="./qlocalserver.htm" translate="no">QLocalServer</a> and <a href="./qlocalsocket.htm" translate="no">QLocalSocket</a> pair), the code needed to listen and connect are boilerplate and handled internally by Qt. Qt Remote Objects supports other types of <a href="./qiodevice.htm" translate="no">QIODevice</a> as well, and the <a href="./qremoteobjectnode.htm" translate="no">QRemoteObjectNode</a> classes provide additional methods to support cases where custom code is needed.</p>
<p>A contrived example with TCP/IP is shown below. A more realistic example would use an SSL connection, which would require configuration of certificates, etc.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="comment">// Create the server and listen outside of QtRO</span>
<span class="type"><a href="./qtcpserver.htm" translate="no">QTcpServer</a></span> tcpServer;
tcpServer<span class="operator">.</span>listen(<span class="type"><a href="./qhostaddress.htm" translate="no">QHostAddress</a></span>(<span class="type"><a href="./qstring.htm#QStringLiteral" translate="no">QStringLiteral</a></span>(<span class="string">"127.0.0.1"</span>))<span class="operator">,</span> <span class="number">65213</span>);

<span class="comment">// Create the host node.  We don't need a hostUrl unless we want to take</span>
<span class="comment">// advantage of external schemas (see next example).</span>
<span class="type"><a href="./qremoteobjecthost.htm" translate="no">QRemoteObjectHost</a></span> srcNode;

<span class="comment">// Make sure any connections are handed to QtRO</span>
<span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(<span class="operator">&amp;</span>tcpServer<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qtcpserver.htm" translate="no">QTcpServer</a></span><span class="operator">::</span>newConnection<span class="operator">,</span> <span class="operator">&amp;</span>srcNode<span class="operator">,</span>
                 <span class="operator">[</span><span class="operator">&amp;</span>srcNode<span class="operator">,</span> <span class="operator">&amp;</span>tcpServer<span class="operator">]</span>() {
    srcNode<span class="operator">.</span>addHostSideConnection(tcpServer<span class="operator">.</span>nextPendingConnection());
});</pre></div>
<p>The Replica side code needs to manually connect to the Host</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type"><a href="./qremoteobjectnode.htm" translate="no">QRemoteObjectNode</a></span> repNode;
<span class="type"><a href="./qtcpsocket.htm" translate="no">QTcpSocket</a></span> <span class="operator">*</span>socket <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qtcpsocket.htm" translate="no">QTcpSocket</a></span>(<span class="operator">&amp;</span>repNode);
<span class="type"><a href="./qobject.htm" translate="no">QObject</a></span><span class="operator">::</span>connect(socket<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qtcpsocket.htm" translate="no">QTcpSocket</a></span><span class="operator">::</span>connected<span class="operator">,</span> <span class="operator">&amp;</span>repNode<span class="operator">,</span>
        <span class="operator">[</span>socket<span class="operator">,</span> <span class="operator">&amp;</span>repNode<span class="operator">]</span>() {
    repNode<span class="operator">.</span>addClientSideConnection(socket);
});
socket<span class="operator">-</span><span class="operator">&gt;</span>connectToHost(<span class="type"><a href="./qhostaddress.htm" translate="no">QHostAddress</a></span>(<span class="type"><a href="./qstring.htm#QStringLiteral" translate="no">QStringLiteral</a></span>(<span class="string">"127.0.0.1"</span>))<span class="operator">,</span> <span class="number">65213</span>);</pre></div>
<a name="external-schemas"></a>
<h2 id="external-schemas">External Schemas<a class="plink" href="#external-schemas" title="Direct link to this headline"></a></h2>
<p>It is possible to create each side of the <a href="./qiodevice.htm" translate="no">QIODevice</a> and call <a href="./qremoteobjectnode.htm#addClientSideConnection" translate="no">QRemoteObjectNode::addClientSideConnection</a>(QIODevice *ioDevice) and <a href="./qremoteobjecthostbase.htm#addHostSideConnection" translate="no">QRemoteObjectHostBase::addHostSideConnection</a>(QIODevice *ioDevice) as shown above. This is fully supported, but requires the client know how to establish the connection or have a way to discover that information. This is exactly the problem the registry was designed to solve.</p>
<p>Qt Remote Objects also allows "External Schemas" to be used with the registry, which helps with connection setup. On the <a href="./qremoteobjecthost.htm" translate="no">QRemoteObjectHost</a> side, the user must set the hostUrl with the desired schema.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="comment">// Use standard tcp url for the registry</span>
<span class="keyword">const</span> <span class="type"><a href="./qurl.htm" translate="no">QUrl</a></span> registryUrl <span class="operator">=</span> <span class="type"><a href="./qurl.htm" translate="no">QUrl</a></span>(<span class="type"><a href="./qstring.htm#QStringLiteral" translate="no">QStringLiteral</a></span>(<span class="string">"tcp://127.0.0.1:65212"</span>));
<span class="comment">// Use "exttcp" for the "external" interface</span>
<span class="keyword">const</span> <span class="type"><a href="./qurl.htm" translate="no">QUrl</a></span> extUrl <span class="operator">=</span> <span class="type"><a href="./qurl.htm" translate="no">QUrl</a></span>(<span class="type"><a href="./qstring.htm#QStringLiteral" translate="no">QStringLiteral</a></span>(<span class="string">"exttcp://127.0.0.1:65213"</span>));

<span class="comment">// Create the server and listen outside of QtRO</span>
<span class="type"><a href="./qtcpserver.htm" translate="no">QTcpServer</a></span> tcpServer;
tcpServer<span class="operator">.</span>listen(<span class="type"><a href="./qhostaddress.htm" translate="no">QHostAddress</a></span>(extUrl<span class="operator">.</span>host())<span class="operator">,</span> extUrl<span class="operator">.</span>port());

<span class="comment">// We need a registry for everyone to connect to</span>
<span class="type"><a href="./qremoteobjectregistryhost.htm" translate="no">QRemoteObjectRegistryHost</a></span> registry(registryUrl);

<span class="comment">// Finally, we create our host node and register "exttcp" as our schema.</span>
<span class="comment">// We need the AllowExternalRegistration parameter to prevent the node from</span>
<span class="comment">// setting a hostUrlInvalid error.</span>
<span class="type"><a href="./qremoteobjecthost.htm" translate="no">QRemoteObjectHost</a></span> srcNode(extUrl<span class="operator">,</span> registryUrl<span class="operator">,</span> <span class="type"><a href="./qremoteobjecthost.htm" translate="no">QRemoteObjectHost</a></span><span class="operator">::</span>AllowExternalRegistration);
<span class="comment">// From now on, when we call enableRemoting() from this node, the registry</span>
<span class="comment">// will be updated to show the Source object at extUrl.</span></pre></div>
<p>On the <a href="./qtremoteobjects-replica.htm#replica" translate="no">Replica</a> side, the <a href="./qremoteobjectnode.htm" translate="no">QRemoteObjectNode</a> needs to register a callback to be used when the external schema is detected. The callback must be a <a href="./qremoteobjectnode.htm#RemoteObjectSchemaHandler-typedef" translate="no">RemoteObjectSchemaHandler</a>.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="comment">// Use standard tcp url for the registry</span>
<span class="keyword">const</span> <span class="type"><a href="./qurl.htm" translate="no">QUrl</a></span> registryUrl <span class="operator">=</span> <span class="type"><a href="./qurl.htm" translate="no">QUrl</a></span>(<span class="type"><a href="./qstring.htm#QStringLiteral" translate="no">QStringLiteral</a></span>(<span class="string">"tcp://127.0.0.1:65212"</span>));

<span class="comment">// This time create the node connected to the registry</span>
<span class="type"><a href="./qremoteobjectnode.htm" translate="no">QRemoteObjectNode</a></span> repNode(registryUrl);

<span class="comment">// Create the RemoteObjectSchemaHandler callback</span>
<span class="type"><a href="./qremoteobjectnode.htm" translate="no">QRemoteObjectNode</a></span><span class="operator">::</span>RemoteObjectSchemaHandler setupTcp <span class="operator">=</span> <span class="operator">[</span><span class="operator">&amp;</span>repNode<span class="operator">]</span>(<span class="type"><a href="./qurl.htm" translate="no">QUrl</a></span> url) {
    <span class="type"><a href="./qtcpsocket.htm" translate="no">QTcpSocket</a></span> <span class="operator">*</span>socket <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="./qtcpsocket.htm" translate="no">QTcpSocket</a></span>(<span class="operator">&amp;</span>repNode);
    connect(socket<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qtcpsocket.htm" translate="no">QTcpSocket</a></span><span class="operator">::</span>connected<span class="operator">,</span>
            <span class="operator">[</span>socket<span class="operator">,</span> <span class="operator">&amp;</span>repNode<span class="operator">]</span>() {
        repNode<span class="operator">.</span>addClientSideConnection(socket);
    });
    connect(socket<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="./qsslsocket.htm" translate="no">QSslSocket</a></span><span class="operator">::</span>errorOccurred<span class="operator">,</span>
            <span class="operator">[</span>socket<span class="operator">]</span>(<span class="type"><a href="./qabstractsocket.htm" translate="no">QAbstractSocket</a></span><span class="operator">::</span>SocketError error) {
        <span class="keyword">delete</span> socket;
    });
    socket<span class="operator">-</span><span class="operator">&gt;</span>connectToHost(url<span class="operator">.</span>host()<span class="operator">,</span> url<span class="operator">.</span>port());
};

<span class="comment">// Once we call registerExternalSchema, the above method will be called</span>
<span class="comment">// whenever the registry sees an object we are interested in on "exttcp"</span>
repNode<span class="operator">.</span>registerExternalSchema(<span class="type"><a href="./qstring.htm#QStringLiteral" translate="no">QStringLiteral</a></span>(<span class="string">"exttcp"</span>)<span class="operator">,</span> setupTcp);</pre></div>
</div>
<!-- @@@qtremoteobjects-external-schemas.html -->
</div>
<p class="copy-notice">
<acronym title="Copyright">Â©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>