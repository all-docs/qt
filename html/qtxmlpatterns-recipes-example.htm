<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Recipes Example | Qt XML Patterns</title>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- Google Tag Manager -->
    
  <!-- End Google Tag Manager -->
  
  
</head>
<body class="qt-design-system" style="background:var(--content-bg-color)" onload="prettyPrint()">

<div data-global-resource-path="qt-design-system/components/b-sidebar.html">
    <div class="b-sidebar b-sidebar--full-width">
        
        <div class="b-sidebar__content">
            <div class="b-sidebar__topbar" data-margin-bottom="sm">
                <div class="b-topbar">
                                        <div class="b-topbar__breadcrump" translate="no">
                        <ul class="c-breadcrump">
                            <li><a href="./index.htm" translate="no">Qt 5.15</a></li>
                            <li><a href="./qtxmlpatterns-index.htm" translate="no">Qt XML Patterns</a></li>
                            <li><a href="./xmlpattern-examples.htm" translate="no">Qt XML Patterns Examples</a></li>
                            <li><a>Recipes Example</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="b-sidebar__content__wrapper">
                <article class="b-sidebar__content__left">
                    <div class="context mainContent" style="margin: 0;padding: 0; background: 0;">
                    

<div class="context">
<h1 class="title">Recipes Example</h1>
<span class="subtitle"></span>
<!-- $$$recipes-brief -->
<p>Using Qt XML Patterns to query XML data loaded from a file.</p>
<!-- @@@recipes -->
<!-- $$$recipes-description -->
<div class="descr"> <a name="details"></a>
<p>The Recipes example shows how to use Qt XML Patterns to query XML data loaded from a file.</p>
<a name="introduction"></a>
<h4 id="introduction">Introduction<a class="plink" href="#introduction" title="Direct link to this headline"></a></h4>
<p>In this case, the XML data represents a cookbook, <code translate="no">cookbook.xml</code>, which contains <code translate="no">&lt;cookbook&gt;</code> as its document element, which in turn contains a sequence of <code translate="no">&lt;recipe&gt;</code> elements. This XML data is searched using queries stored in <a href="./xmlprocessing.htm" translate="no">XQuery</a> files (<code translate="no">*.xq</code>).</p>
<a name="the-user-interface"></a>
<h5 id="the-user-interface">The User Interface<a class="plink" href="#the-user-interface" title="Direct link to this headline"></a></h5>
<p>The UI for this example was created using <a href="./qtdesigner-manual.htm" translate="no">Qt Designer</a>:</p>
<p class="centerAlign"><img alt="" src="./images/recipes-example.png"></p><p>The UI consists of three <a href="./qgroupbox.htm" translate="no">group boxes</a> arranged vertically. The top one contains a <a href="./qtextedit.htm" translate="no">text viewer</a> that displays the XML text from the cookbook file. The middle group box contains a <a href="./qcombobox.htm" translate="no">combo box</a> for choosing the <a href="./xquery-introduction.htm" translate="no">XQuery</a> to run and a <a href="./qtextedit.htm" translate="no">text viewer</a> for displaying the text of the selected <a href="./xmlprocessing.htm" translate="no">XQuery</a>. The <code translate="no">.xq</code> files in the file list above are shown in the combo box menu. Choosing an <a href="./xmlprocessing.htm" translate="no">XQuery</a> loads, parses, and runs the selected <a href="./xmlprocessing.htm" translate="no">XQuery</a>. The query result is shown in the bottom group box's <a href="./qtextedit.htm" translate="no">text viewer</a>.</p>
<a name="running-your-own-xqueries"></a>
<h5 id="running-your-own-xqueries">Running your own XQueries<a class="plink" href="#running-your-own-xqueries" title="Direct link to this headline"></a></h5>
<p>You can write your own <a href="./xmlprocessing.htm" translate="no">XQuery</a> files and run them in the example program. The file <code translate="no">xmlpatterns/recipes/recipes.qrc</code> is the <a href="./resources.htm" translate="no">resource file</a> for this example. It is used in <code translate="no">main.cpp</code> (<code translate="no">Q_INIT_RESOURCE(recipes);</code>). It lists the <a href="./xmlprocessing.htm" translate="no">XQuery</a> files (<code translate="no">.xq</code>) that can be selected in the combobox.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">&lt;!DOCTYPE RCC&gt;&lt;RCC version="1.0"&gt;
&lt;qresource&gt;
    &lt;file&gt;files/cookbook.xml&lt;/file&gt;
    &lt;file&gt;files/allRecipes.xq&lt;/file&gt;
    &lt;file&gt;files/liquidIngredientsInSoup.xq&lt;/file&gt;
    &lt;file&gt;files/mushroomSoup.xq&lt;/file&gt;
    &lt;file&gt;files/preparationLessThan30.xq&lt;/file&gt;
    &lt;file&gt;files/preparationTimes.xq&lt;/file&gt;
&lt;/qresource&gt;
&lt;/RCC&gt;</pre></div>
<p>To add your own queries to the example's combobox, store your <code translate="no">.xq</code> files in the <code translate="no">examples/xmlpatterns/recipes/files</code> directory and add them to <code translate="no">recipes.qrc</code> as shown above.</p>
<a name="code-walk-through"></a>
<h4 id="code-walk-through">Code Walk-Through<a class="plink" href="#code-walk-through" title="Direct link to this headline"></a></h4>
<p>The example's main() function creates the standard instance of <a href="./qapplication.htm" translate="no">QApplication</a>. Then it creates an instance of the UI class, shows it, and starts the Qt event loop:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">int</span> main(<span class="type">int</span> argc<span class="operator">,</span> <span class="type">char</span><span class="operator">*</span> argv<span class="operator">[</span><span class="operator">]</span>)
{
    Q_INIT_RESOURCE(recipes);
    <span class="type"><a href="./qapplication.htm" translate="no">QApplication</a></span> app(argc<span class="operator">,</span> argv);
    QueryMainWindow<span class="operator">*</span> <span class="keyword">const</span> queryWindow <span class="operator">=</span> <span class="keyword">new</span> QueryMainWindow;
    queryWindow<span class="operator">-</span><span class="operator">&gt;</span>show();
    <span class="keyword">return</span> app<span class="operator">.</span>exec();
}</pre></div>
<a name="the-ui-class-querymainwindow"></a>
<h5 id="the-ui-class-querymainwindow">The UI Class: QueryMainWindow<a class="plink" href="#the-ui-class-querymainwindow" title="Direct link to this headline"></a></h5>
<p>The example's UI is a conventional Qt GUI application inheriting <a href="./qmainwindow.htm" translate="no">QMainWindow</a> and the class generated by <a href="./qtdesigner-manual.htm" translate="no">Qt Designer</a>:</p>
<div class="pre"><pre class="cpp prettyprint" translate="no"><span class="keyword">class</span> QueryMainWindow : <span class="keyword">public</span> <span class="type"><a href="./qmainwindow.htm" translate="no">QMainWindow</a></span><span class="operator">,</span>
                        <span class="keyword">private</span> Ui<span class="operator">::</span>QueryWidget
{
    Q_OBJECT

<span class="keyword">public</span>:
    QueryMainWindow();

<span class="keyword">public</span> <span class="keyword">slots</span>:
    <span class="type">void</span> displayQuery(<span class="type">int</span> index);

<span class="keyword">private</span>:
    <span class="type"><a href="./qcombobox.htm" translate="no">QComboBox</a></span> <span class="operator">*</span>ui_defaultQueries <span class="operator">=</span> nullptr;

    <span class="type">void</span> evaluate(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>str);
    <span class="type">void</span> loadInputFile();
};</pre></div>
<p>The constructor finds the window's <a href="./qcombobox.htm" translate="no">combo box</a> child widget and connects its <a href="./qcombobox.htm#currentIndexChanged" translate="no">currentIndexChanged()</a> signal to the window's <code translate="no">displayQuery()</code> slot. It then calls <code translate="no">loadInputFile()</code> to load <code translate="no">cookbook.xml</code> and display its contents in the top group box's <a href="./qtextedit.htm" translate="no">text viewer</a> . Finally, it finds the <a href="./xmlprocessing.htm" translate="no">XQuery</a> files (<code translate="no">.xq</code>) and adds each one to the <a href="./qcombobox.htm" translate="no">combo box</a> menu.</p>
<div class="pre"><pre class="cpp prettyprint" translate="no">QueryMainWindow<span class="operator">::</span>QueryMainWindow()
{
    setupUi(<span class="keyword">this</span>);

    <span class="keyword">new</span> XmlSyntaxHighlighter(findChild<span class="operator">&lt;</span><span class="type"><a href="./qtextedit.htm" translate="no">QTextEdit</a></span><span class="operator">*</span><span class="operator">&gt;</span>(<span class="string">"inputTextEdit"</span>)<span class="operator">-</span><span class="operator">&gt;</span>document());
    <span class="keyword">new</span> XmlSyntaxHighlighter(findChild<span class="operator">&lt;</span><span class="type"><a href="./qtextedit.htm" translate="no">QTextEdit</a></span><span class="operator">*</span><span class="operator">&gt;</span>(<span class="string">"outputTextEdit"</span>)<span class="operator">-</span><span class="operator">&gt;</span>document());

    ui_defaultQueries <span class="operator">=</span> findChild<span class="operator">&lt;</span><span class="type"><a href="./qcombobox.htm" translate="no">QComboBox</a></span><span class="operator">*</span><span class="operator">&gt;</span>(<span class="string">"defaultQueries"</span>);
    <span class="type"><a href="./qmetaobject.htm" translate="no">QMetaObject</a></span><span class="operator">::</span>connectSlotsByName(<span class="keyword">this</span>);

    connect(ui_defaultQueries<span class="operator">,</span> <span class="type">QOverload</span><span class="operator">&lt;</span><span class="type">int</span><span class="operator">&gt;</span><span class="operator">::</span>of(<span class="operator">&amp;</span><span class="type"><a href="./qcombobox.htm" translate="no">QComboBox</a></span><span class="operator">::</span>currentIndexChanged)<span class="operator">,</span>
            <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>QueryMainWindow<span class="operator">::</span>displayQuery);

    loadInputFile();
    <span class="keyword">const</span> <span class="type"><a href="./qstringlist.htm" translate="no">QStringList</a></span> queries(<span class="type"><a href="./qdir.htm" translate="no">QDir</a></span>(<span class="string">":/files/"</span><span class="operator">,</span> <span class="string">"*.xq"</span>)<span class="operator">.</span>entryList());
    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> <span class="operator">&amp;</span>query : queries)
        ui_defaultQueries<span class="operator">-</span><span class="operator">&gt;</span>addItem(query);
    <span class="keyword">if</span> (queries<span class="operator">.</span>count() <span class="operator">&gt;</span> <span class="number">0</span>)
        displayQuery(<span class="number">0</span>);
}</pre></div>
<p>The work is done in the <a href="./qtxmlpatterns-recipes-example.htm#displayquery-slot" translate="no">displayQuery()</a> slot and the <a href="./qtxmlpatterns-recipes-example.htm#evaluate-function" translate="no">evaluate()</a> function it calls. <a href="./qtxmlpatterns-recipes-example.htm#displayquery-slot" translate="no">displayQuery()</a> loads and displays the selected query file and passes the <a href="./xmlprocessing.htm" translate="no">XQuery</a> text to <a href="./qtxmlpatterns-recipes-example.htm#evaluate-function" translate="no">evaluate()</a>.</p>
<a name="displayquery-slot"></a><div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> QueryMainWindow<span class="operator">::</span>displayQuery(<span class="type">int</span> index)
{
    <span class="type"><a href="./qfile.htm" translate="no">QFile</a></span> queryFile(<span class="type"><a href="./qstring.htm" translate="no">QString</a></span>(<span class="string">":files/"</span>) <span class="operator">+</span> ui_defaultQueries<span class="operator">-</span><span class="operator">&gt;</span>itemText(index));
    queryFile<span class="operator">.</span>open(<span class="type"><a href="./qiodevice.htm" translate="no">QIODevice</a></span><span class="operator">::</span>ReadOnly);
    <span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> query(<span class="type"><a href="./qstring.htm" translate="no">QString</a></span><span class="operator">::</span>fromLatin1(queryFile<span class="operator">.</span>readAll()));
    findChild<span class="operator">&lt;</span><span class="type"><a href="./qtextedit.htm" translate="no">QTextEdit</a></span><span class="operator">*</span><span class="operator">&gt;</span>(<span class="string">"queryTextEdit"</span>)<span class="operator">-</span><span class="operator">&gt;</span>setPlainText(query);

    evaluate(query);
}</pre></div>
<p><a href="./qtxmlpatterns-recipes-example.htm#evaluate-function" translate="no">evaluate()</a> demonstrates the standard Qt XML Patterns usage pattern. First, an instance of <a href="./qxmlquery.htm" translate="no">QXmlQuery</a> is created (<code translate="no">query</code>). The <code translate="no">query's</code> <a href="./qxmlquery.htm#bindVariable" translate="no">bindVariable()</a> function is then called to bind the <code translate="no">cookbook.xml</code> file to the <a href="./xmlprocessing.htm" translate="no">XQuery</a> variable <code translate="no">inputDocument</code>. <i>After</i> the variable is bound, <a href="./qxmlquery.htm#setQuery" translate="no">setQuery()</a> is called to pass the <a href="./xmlprocessing.htm" translate="no">XQuery</a> text to the <code translate="no">query</code>.</p>
<div class="admonition note">
<p><b>Note: </b><a href="./qxmlquery.htm#setQuery" translate="no">setQuery()</a> must be called <i>after</i> <a href="./qxmlquery.htm#bindVariable" translate="no">bindVariable()</a>.</p>
</div>
<p>Passing the <a href="./xmlprocessing.htm" translate="no">XQuery</a> to <a href="./qxmlquery.htm#setQuery" translate="no">setQuery()</a> causes Qt XML Patterns to parse the <a href="./xmlprocessing.htm" translate="no">XQuery</a>. <a href="./qxmlquery.htm#isValid" translate="no">QXmlQuery::isValid</a>() is called to ensure that the <a href="./xmlprocessing.htm" translate="no">XQuery</a> was correctly parsed.</p>
<a name="evaluate-function"></a><div class="pre"><pre class="cpp prettyprint" translate="no"><span class="type">void</span> QueryMainWindow<span class="operator">::</span>evaluate(<span class="keyword">const</span> <span class="type"><a href="./qstring.htm" translate="no">QString</a></span> <span class="operator">&amp;</span>str)
{
    <span class="type"><a href="./qfile.htm" translate="no">QFile</a></span> sourceDocument;
    sourceDocument<span class="operator">.</span>setFileName(<span class="string">":/files/cookbook.xml"</span>);
    sourceDocument<span class="operator">.</span>open(<span class="type"><a href="./qiodevice.htm" translate="no">QIODevice</a></span><span class="operator">::</span>ReadOnly);

    <span class="type"><a href="./qbytearray.htm" translate="no">QByteArray</a></span> outArray;
    <span class="type"><a href="./qbuffer.htm" translate="no">QBuffer</a></span> buffer(<span class="operator">&amp;</span>outArray);
    buffer<span class="operator">.</span>open(<span class="type"><a href="./qiodevice.htm" translate="no">QIODevice</a></span><span class="operator">::</span>ReadWrite);

    <span class="type"><a href="./qxmlquery.htm" translate="no">QXmlQuery</a></span> query;
    query<span class="operator">.</span>bindVariable(<span class="string">"inputDocument"</span><span class="operator">,</span> <span class="operator">&amp;</span>sourceDocument);
    query<span class="operator">.</span>setQuery(str);
    <span class="keyword">if</span> (<span class="operator">!</span>query<span class="operator">.</span>isValid())
        <span class="keyword">return</span>;

    <span class="type"><a href="./qxmlformatter.htm" translate="no">QXmlFormatter</a></span> formatter(query<span class="operator">,</span> <span class="operator">&amp;</span>buffer);
    <span class="keyword">if</span> (<span class="operator">!</span>query<span class="operator">.</span>evaluateTo(<span class="operator">&amp;</span>formatter))
        <span class="keyword">return</span>;

    buffer<span class="operator">.</span>close();
    findChild<span class="operator">&lt;</span><span class="type"><a href="./qtextedit.htm" translate="no">QTextEdit</a></span><span class="operator">*</span><span class="operator">&gt;</span>(<span class="string">"outputTextEdit"</span>)<span class="operator">-</span><span class="operator">&gt;</span>setPlainText(<span class="type"><a href="./qstring.htm" translate="no">QString</a></span><span class="operator">::</span>fromUtf8(outArray<span class="operator">.</span>constData()));

}</pre></div>
<p>If the <a href="./xmlprocessing.htm" translate="no">XQuery</a> is valid, an instance of <a href="./qxmlformatter.htm" translate="no">QXmlFormatter</a> is created to format the query result as XML into a <a href="./qbuffer.htm" translate="no">QBuffer</a>. To evaluate the <a href="./xmlprocessing.htm" translate="no">XQuery</a>, an overload of <a href="./qxmlquery.htm#evaluateTo" translate="no">evaluateTo()</a> is called that takes a <a href="./qabstractxmlreceiver.htm" translate="no">QAbstractXmlReceiver</a> for its output (<a href="./qxmlformatter.htm" translate="no">QXmlFormatter</a> inherits <a href="./qabstractxmlreceiver.htm" translate="no">QAbstractXmlReceiver</a>). Finally, the formatted XML result is displayed in the UI's bottom text view.</p>
<div class="admonition note">
<p><b>Note: </b>Each <a href="./xmlprocessing.htm" translate="no">XQuery</a> <code translate="no">.xq</code> file must declare the <code translate="no">$inputDocument</code> variable to represent the <code translate="no">cookbook.xml</code> document:</p>
</div>
<div class="pre"><pre class="cpp plain" translate="no">(: All ingredients for Mushroom Soup. :)
declare variable $inputDocument external;

doc($inputDocument)/cookbook/recipe[@xml:id = "MushroomSoup"]/ingredient/
&lt;p&gt;{@name, @quantity}&lt;/p&gt;</pre></div>
<div class="admonition note">
<p><b>Note: </b>If you add add your own query.xq files, you must declare the <code translate="no">$inputDocument</code> and use it as shown above.</p>
</div>
<p><a href="https://code.qt.io/cgit/qt/qtxmlpatterns.git/tree/examples/xmlpatterns/recipes?h=5.15" translate="no">Example project @ code.qt.io</a></p>
</div>
<!-- @@@recipes -->
</div>
<p class="copy-notice">
<acronym title="Copyright">Â©</acronym> 2025 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.     The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.     Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>

                    </div>
                </article>
                
            </div>
        </div>
    </div>
</div>
</body></html>